
<!--
 -->
<project basedir="." default="" name="balancer">


	<!-- Definitions -->
	<property environment="system" />
	<property name="jboss.home" value="${system.JBOSS_HOME}" />

	<property name="mbean.src.path" value="org/mobicents/slee/services/sip/balancer/mbean" />
	<property name="mbean.archive.name" value="SIPNodeHABean.sar" />
	<property name="balancer.archive.name" value="SipBalancer.jar" />

	<property name="balancer.src.path" value="org/mobicents/slee/services/sip/balancer" />

	<property name="balancer.ip" value="" />
	<property name="balancer.port.external" value="" />
	<property name="balancer.port.internal" value="" />
	<property name="mobicents.home" value="${ant.file.balancer}/../../../../core" />
	<!--property name="jnpHost" value="127.0.0.1" /-->
	<!-- MOBICENTS CLI -->
	<import file="${mobicents.home}/xml/ant/mobicents-ant-common-properties.xml" />




	<path id="balancer.mbean.path">
		<pathelement location="${jboss.home}/lib/jboss-system.jar" />
		<pathelement location="${jboss.home}/client/jbossall-client.jar" />
		<pathelement location="../lib/log4j.jar" />
		<pathelement location="${mobicents.home}/lib/slee_1_1.jar" />
		<!-- <pathelement location=""/> -->
	</path>


	<path id="balancer.path">
		<pathelement location="${jboss.home}/lib/jboss-system.jar" />
		<pathelement location="${jboss.home}/client/jbossall-client.jar" />
		<pathelement location="./../lib/log4j.jar" />
		<pathelement location="${mobicents.home}/lib/slee_1_1.jar" />
		<pathelement location="../lib/JainSipApi1.2.jar" />
		<pathelement location="../lib/JainSipRi1.2.jar" />
		<pathelement location="./jars/${balancer.archive.name}" />
	</path>

	<target name="compile" description="--> Compiles sar files">
		<mkdir dir="classes/${mbean.archive.name}" />
		<javac target="1.5" srcdir="src" includes="${mbean.src.path}/**/*.java" destdir="classes/${mbean.archive.name}" classpathref="balancer.mbean.path" />
		<copy todir="classes/${mbean.archive.name}">
			<fileset dir="src">
				<include name="${mbean.src.path}/**/*.*" />
				<exclude name="${mbean.src.path}/**/*.java" />
				<exclude name="${mbean.src.path}/jboss-service.xml" />
			</fileset>
		</copy>

		<mkdir dir="classes/${balancer.archive.name}" />




		<javac target="1.5" srcdir="src" includes="${balancer.src.path}/**/*.java" destdir="classes/${balancer.archive.name}" classpathref="balancer.path" />
		<copy todir="classes/${balancer.archive.name}">
			<fileset dir="src">
				<include name="${balancer.src.path}/**/*.*" />
				<exclude name="${balancer.src.path}/**/*.java" />
				<exclude name="${balancer.src.path}/jboss-service.xml" />
			</fileset>
		</copy>


	</target>


	<!-- ================================= 
          target: clean              
         ================================= -->
	<target name="clean">

		<delete dir="classes/${mbean.archive.name}" />
		<delete dir="classes/${balancer.archive.name}" />
		<delete dir="./jars">
		</delete>
		<mkdir dir="./jars" />
	</target>


	<!-- ================================= 
          target: build-sar              
         ================================= -->
	<target name="build-sar" depends="compile" description="--> Build sar with mbean">
		<mkdir dir="classes/${mbean.archive.name}/META-INF" />
		<copy todir="classes/${mbean.archive.name}/META-INF" file="src/${mbean.src.path}/jboss-service.xml" />

		<jar destfile="./jars/${mbean.archive.name}" basedir="classes/${mbean.archive.name}" />
	</target>


	<!-- ================================= 
          target: deploy              
         ================================= -->
	<target name="deploy" depends="build-sar" description="--> Deploys mbean archive">
		<copy file="jars/${mbean.archive.name}" todir="${jboss.home}/server/${node}/deploy">
		</copy>
	</target>

	<!-- ================================= 
          target: undeploy              
         ================================= -->
	<target name="undeploy" description="--> Undeploys mbea archive">
		<delete file="${jboss.home}/server/${node}/deploy/${mbean.archive.name}" />

	</target>

	<!-- ================================= 
          target: run-balancer              
         ================================= -->
	<target name="run-balancer" depends="compile" description="--> description">

		<jar destfile="./jars/${balancer.archive.name}" basedir="classes/${balancer.archive.name}">
		</jar>


		<java classpathref="balancer.path" fork="true" classname="org.mobicents.slee.services.sip.balancer.BalancerRunner">
			<arg value="127.0.0.1" />
			<arg value="5080" />
			<arg value="5070" />
			<arg value="5100" />
		</java>


	</target>



</project>

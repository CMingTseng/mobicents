<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <title>8.7. MMS Demonstration Example</title>
      <link rel="stylesheet" href="css/jbossorg.css" type="text/css"/>
      <meta name="generator" content="DocBook XSL Stylesheets V1.72.0"/>
      <link rel="start" href="index.html" title="Mobicents"/>
      <link rel="up" href="chapter-Mobicents_Media_Server.html" title="Chapter 8. Mobicents Media Server"/>
      <link rel="prev" href="section-MMS_Event_Packages.html" title="8.6. MMS Event Packages"/>
      <link rel="next" href="Mobicents_User_Guide-Revision_History.html" title="Appendix A. Revision History"/>
   </head>
   <body>
      <p id="title">
         <a href="http://www.jboss.org" class="jbossOrg_href">
            <strong>
						        JBoss.org	
						</strong>
         </a>
         <a href="http://labs.jboss.com/projects/docs" class="commDoc_href">
            <strong>
						        Community Documentation	
						</strong>
         </a>
      </p>
      <ul class="docnav">
         <li class="previous">
            <a accesskey="p" href="section-MMS_Event_Packages.html">
               <strong>Prev</strong>
            </a>
         </li>
         <li class="next">
            <a accesskey="n" href="Mobicents_User_Guide-Revision_History.html">
               <strong>Next</strong>
            </a>
         </li>
      </ul>
      <div class="section" lang="en-US">
         <div class="titlepage">
            <div>
               <div>
                  <h2 class="title">
                     <a id="section-MMS_Demonstration_Example"/>8.7. MMS Demonstration Example</h2>
               </div>
            </div>
         </div>
         <p>The motive of this example is to demonstrate the capabilities of new Media Server (MS) and Media Server Resource Adaptors (MSC-RA).</p>
         <p>The example demonstrates usage of</p>
         <div class="itemizedlist">
            <ul>
               <li>
                  <p>the Announcement Endpoint</p>
               </li>
               <li>
                  <p>the Packet Relay Endpoint</p>
               </li>
               <li>
                  <p>The Loop Endpoint</p>
               </li>
               <li>
                  <p>The Conference Endpoint</p>
               </li>
               <li>
                  <p>The IVR Endpoint</p>
               </li>
            </ul>
         </div>
         <p>For more information on each of these types of endpoints, refer to <a href="section-Mobicents_Media_Server_Architecture.html" title="8.2. Mobicents Media Server Architecture">Section 8.2, “Mobicents Media Server Architecture”</a>.	</p>
         <h5 class="formalpara">Where is the Code?</h5>
         <p class="formalpara">Check out the 'mms-demo' example from <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://mobicents.googlecode.com/svn/trunk/servers/jain-slee/examples/mms-demo">http://mobicents.googlecode.com/svn/trunk/servers/jain-slee/examples/mms-demo</a>.</p>
         <h5 class="formalpara">Install and Run</h5>
         <p class="formalpara">Start the Mobicents Server (this will also start Media Server). Make sure you have <code class="filename">server/default/deploy/mobicents.sar</code> and <code class="filename">server/default/deploy/mediaserver.sar</code> in your Mobicents Server</p>
         <h5 class="formalpara">From Binary</h5>
         <p class="formalpara">Go to <code class="filename">/examples/mms-demo</code> and call 'ant deploy-all'. This will deploy the SIP RA, MSC RA, the mms-demo example and also mms-demo-audio.war. The war file contains the audio *.wav files that are used by mms-demo example.</p>
         <h5 class="formalpara">From Source Code</h5>
         <p class="formalpara">If you are deploying from source code, you may deploy each of the resource adaptors individually</p>
         <div class="itemizedlist">
            <ul>
               <li>
                  <p>make sure <code class="envar">JBOSS_HOME</code> is set and server is running</p>
               </li>
               <li>
                  <p>Call mvn install from <code class="filename">servers/jain-slee/resources/sip</code> to deploy SIP RA </p>
               </li>
               <li>
                  <p>Call mvn install from <code class="filename">servers/jain-slee/resources/media</code> to deploy media RA</p>
               </li>
               <li>
                  <p>Call mvn install from <code class="filename">servers/jain-slee/examples/mms-demo</code> to deploy example</p>
               </li>
            </ul>
         </div>
         <p>Once the example is deployed, make a call from your SIP Phone to TBD.</p>
         <h5 class="formalpara">1010: Loop Endpoint Usage Demonstration</h5>
         <p class="formalpara">As soon as the call is established CallSbb creates a Connection using PREndpointImpl. PREndpointImpl has two Connections, one connected to calling UA by calling msConnection.modify("$", sdp). Once the connection is established CallSbb creates child LoopDemoSbb and calls startDemo() on it passing the PREndpoint name as argument. LoopDemoSbb creates child AnnouncementSbb which uses the AnnEndpointImpl to make an announcement. The other Connection of PREndpointImpl is connected to Connection from AnnEndpointImpl using the MsLink.</p>
         <pre class="programlisting">
	MsLink link = session.createLink(MsLink.MODE_FULL_DUPLEX);
....
...
link.join(userEndpoint, ANNOUNCEMENT_ENDPOINT);</pre>
         <p>Once the link is created (look at onLinkCreated() ) AnnouncementSbb creates the instance of MsSignalGenerator and attaches the AnnouncementSbb to ActivityContextInterface created passing MsSignalGenerator. MsSignalGenerator is used to play the announcement as shown below:</p>
         <pre class="programlisting">MsSignalGenerator generator = msProvider.getSignalGenerator(getAnnouncementEndpoint());
ActivityContextInterface generatorActivity = mediaAcif.getActivityContextInterface(generator);
generatorActivity.attach(sbbContext.getSbbLocalObject());
generator.apply(Announcement.PLAY, new String[]{url});</pre>
         <div class="mediaobject" align="center">
            <a id="mediaobj-untitled_digram-1.png"/>
            <img src="images/untitled_digram-1.png" align="middle"/>
            <div class="caption">
               <p/>
            </div>
         </div>
         <p>As soon as announcement is over LoopDemoSbb creates child LoopbackSbb and calls startConversation() on it passing the PREndpoint name as argument. LoopbackSbb uses MsLink to associate the other Connection of PREndpointImpl to LoopEndpointImpl. LoopEndpointImpl simply forwards the voice packet received from caller back to caller.</p>
         <pre class="programlisting">
 MsLink link = session.createLink(MsLink.MODE_FULL_DUPLEX);
.......
...
link.join(endpointName, LOOP_ENDPOINT);</pre>
         <div class="mediaobject" align="center">
            <a id="mediaobj-untitled_digram-2.png"/>
            <img src="images/untitled_digram-2.png" align="middle"/>
            <div class="caption">
               <p/>
            </div>
         </div>
         <div class="figure">
            <a id="figure-1010.PNG"/>
            <div class="figure-contents">
               <div class="mediaobject" align="center">
                  <a id="mediaobj-1010.PNG"/>
                  <img src="images/1010.PNG" align="middle" alt="The SBB Child Relation Diagram"/>
               </div>
            </div>
            <p class="title">
               <b>Figure 8.3. The SBB Child Relation Diagram</b>
            </p>
         </div>
         <br class="figure-break"/>
         <h5 class="formalpara">1011: DTMF Usage Demonstration</h5>
         <p class="formalpara">As soon as the call is established CallSbb creates a Connection using PREndpointImpl. PREndpointImpl has two Connections, one connected to calling UA by calling msConnection.modify("$", sdp). Once the connection is established CallSbb creates child DtmfDemoSbb and calls startDemo() on it passing the PREndpoint name as argument. DtmfDemoSbb creates child AnnouncementSbb which uses the AnnEndpointImpl to make an announcement. The other Connection of PREndpointImpl is connected to Connection from AnnEndpointImpl using the MsLink.</p>
         <pre class="programlisting">....
MsLink link = session.createLink(MsLink.MODE_FULL_DUPLEX);
....
...
link.join(userEndpoint, ANNOUNCEMENT_ENDPOINT);</pre>
         <p>
Once the link is created (look at onLinkCreated() ) AnnouncementSbb creates the instance of MsSignalGenerator and attaches the AnnouncementSbb to ActivityContextInterface created passing MsSignalGenerator. MsSignalGenerator is used to play the announcement as shown below.</p>
         <pre class="programlisting">MsSignalGenerator generator = msProvider.getSignalGenerator(getAnnouncementEndpoint());
ActivityContextInterface generatorActivity = mediaAcif.getActivityContextInterface(generator);
generatorActivity.attach(sbbContext.getSbbLocalObject());
generator.apply(Announcement.PLAY, new String[]{url});</pre>
         <div class="mediaobject" align="center">
            <a id="mediaobj-untitled_digram-3.png"/>
            <img src="images/untitled_digram-3.png" align="middle"/>
            <div class="caption">
               <p/>
            </div>
         </div>
         <p>As soon as announcement is over DtmfDemoSbb creates instance of MsSignalDetector and attaches the DtmfDemoSbb to ActivityContextInterface created passing MsSignalDetector. This is necessary so that DtmfDemoSbb receives the DTMF event, look at onDtmf() method. In fact the SBB needs to be attached to this ACI everytime as the activity is over as soon as the DTMf is received.</p>
         <pre class="programlisting">MsSignalDetector dtmfDetector = msProvider.getSignalDetector(this.getUserEndpoint());
ActivityContextInterface dtmfAci =
mediaAcif.getActivityContextInterface(dtmfDetector);
dtmfAci.attach(sbbContext.getSbbLocalObject());
dtmfDetector.receive(Basic.DTMF, connection, new String[]{});</pre>
         <p>On every DTMF received DtmfDemoSbb plays corresponding wav file using the AnnouncementSbb as explained above.</p>
         <div class="figure">
            <a id="figure-1011.PNG"/>
            <div class="figure-contents">
               <div class="mediaobject" align="center">
                  <a id="mediaobj-1011.PNG"/>
                  <img src="images/1011.PNG" align="middle"/>
                  <div class="caption">
                     <p>The SBB Child Relation Diagram</p>
                  </div>
               </div>
            </div>
            <p class="title">
               <b>Figure 8.4. </b>
            </p>
         </div>
         <br class="figure-break"/>
         <h5 class="formalpara">1012: ConfEndpointImpl Usage Demonstration</h5>
         <p class="formalpara">As soon as the call is established CallSbb creates a Connection using PREndpointImpl. PREndpointImpl has two Connections, one connected to calling UA by calling msConnection.modify("$", sdp). Once the connection is established CallSbb creates child ConfDemoSbb and calls startDemo() on it passing the PREndpoint name as argument. ConfDemoSbb creates child AnnouncementSbb which uses the AnnEndpointImpl to make an announcement. The other Connection of PREndpointImpl is connected to Connection from AnnEndpointImpl using the MsLink.</p>
         <pre class="programlisting">....
MsLink link = session.createLink(MsLink.MODE_FULL_DUPLEX);
....
...
link.join(userEndpoint, ANNOUNCEMENT_ENDPOINT);</pre>
         <p>Once the link is created (look at onLinkCreated() ) AnnouncementSbb creates the instance of MsSignalGenerator and attaches the AnnouncementSbb to ActivityContextInterface created passing MsSignalGenerator. MsSignalGenerator is used to play the announcement as shown below</p>
         <pre class="programlisting">MsSignalGenerator generator = msProvider.getSignalGenerator(getAnnouncementEndpoint());
ActivityContextInterface generatorActivity = mediaAcif.getActivityContextInterface(generator);
generatorActivity.attach(sbbContext.getSbbLocalObject());
generator.apply(Announcement.PLAY, new String[]{url});</pre>
         <div class="mediaobject" align="center">
            <a id="mediaobj-untitled_digram-4.png"/>
            <img src="images/untitled_digram-4.png" align="middle"/>
            <div class="caption">
               <p/>
            </div>
         </div>
         <p>As soon as announcement is over ConfDemoSbb creates child ForestSbb and calls enter() on it passing the PREndpoint name as argument. ForestSbb uses MsLink to associate the other Connection of PREndpointImpl to ConfEndpointImpl:</p>
         <pre class="programlisting">MsLink link = session.createLink(MsLink.MODE_FULL_DUPLEX);
link.join(endpointName, CNF_ENDPOINT);</pre>
         <p>Once the link is established (Look at onConfBridgeCreated() ) ForestSbb creates many child AnnouncementSbb each responsible for unique announcement (in this case playing crickets.wav and mocking.wav). So now UA is actually listening to many announcements at same go.</p>
         <div class="mediaobject" align="center">
            <a id="mediaobj-untitled_digram-5.png"/>
            <img src="images/untitled_digram-5.png" align="middle"/>
            <div class="caption">
               <p/>
            </div>
         </div>
         <div class="figure">
            <a id="figure-1012.PNG"/>
            <div class="figure-contents">
               <div class="mediaobject" align="center">
                  <a id="mediaobj-1012.PNG"/>
                  <img src="images/1012.PNG" align="middle"/>
                  <div class="caption">
                     <p>The SBB Child Relation Diagram</p>
                  </div>
               </div>
            </div>
            <p class="title">
               <b>Figure 8.5. </b>
            </p>
         </div>
         <br class="figure-break"/>
      </div>
      <ul class="docnav">
         <li class="previous">
            <a accesskey="p" href="section-MMS_Event_Packages.html">
               <strong>Prev</strong>8.6. MMS Event Packages</a>
         </li>
         <li class="up">
            <a accesskey="u" href="#">
               <strong>Top of page</strong>
            </a>
         </li>
         <li class="home">
            <a accesskey="h" href="index.html">
               <strong>Front page</strong>
            </a>
         </li>
         <li class="next">
            <a accesskey="n" href="Mobicents_User_Guide-Revision_History.html">
               <strong>Next</strong>Appendix A. Revision History</a>
         </li>
      </ul>
   </body>
</html>
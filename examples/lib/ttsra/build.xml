<?xml version="1.0" encoding="UTF-8"?>
<project name="Common_Ant_Targets_for_SLEE_Resource_Adaptors">




	<!-- LETS READ PROPS -->
	<property file="./version.properties" />



	<!--
	
	ratype-DU=...
	ra.entity=...
	ra-DU=...
	ra.id=...
	ra.version=...
	ra.props=... - this one does have to be present...
	-->
	<!-- DEPLOY & UNDEPLOY STUFF -->

	
	
	
	<available value="${ra.props}" file="${ra.props}" property="ra.entity.properties.filename"></available>
	<import file="${ant.file.Common_Ant_Targets_for_SLEE_Resource_Adaptors}/../../build.xml"/>
	
	
	<target name="create-deploy-urls" depends="management-init">
		<path id="ra.url.to.deploy.ra">
			<pathelement location="./${ra-DU}" />
		</path>
		<path id="ra.url.to.deploy.ratype">
			<pathelement location="./${ratype-DU}" />
		</path>
		<property name="ra.url.to.deploy.ra" refid="ra.url.to.deploy.ra" />
		<property name="ra.url.to.deploy.ratype" refid="ra.url.to.deploy.ratype" />
	</target>

	<target name="ra-install" depends="create-deploy-urls">
		<echo>Installing ${ra.entity}.</echo>
		<slee-management jnpport="${jnpPort}" host="${jnpHost}" user="${user}" password="${password}">
			<install url="${file_url}${ra.url.to.deploy.ratype}" />
			<install url="${file_url}${ra.url.to.deploy.ra}" />
		</slee-management>
	</target>



	<target name="ra-activate-with-properties" depends="create-deploy-urls" if="ra.entity.properties.filename">

		<path id="ra.entity.properties.path">
			<pathelement location="${ra.entity.properties.filename}" />
		</path>

		<!-- Lets leave pathconvert - it cant hurt, windows swalows it, and besides we still need to define property to add URI identifier "file:/"-->
		<pathconvert property="ra.props.file.path" targetos="unix" refid="ra.entity.properties.path">
		</pathconvert>

		<property name="ra.entity.properties.url" value="${file_url}${ra.props.file.path}" />

		<echo>Activating ${ra.entity} with properties: file=${ra.entity.properties.filename} fileURL=${ra.entity.properties.url}</echo>

		<slee-management jnpport="${jnpPort}" host="${jnpHost}" user="${user}" password="${password}">
			<createraentity resourceadaptorid="${ra.id}" entityname="${ra.entity}" properties="${ra.entity.properties.url}" />
			<activateraentity entityname="${ra.entity}" />
			<bindralinkname entityname="${ra.entity}" linkname="${ra.entity}" />
		</slee-management>

	</target>

	<target name="ra-activate-without-properties" depends="create-deploy-urls" unless="ra.entity.properties.filename">

		<echo>Activating ${ra.entity} without properties file.</echo>

		<slee-management jnpport="${jnpPort}" host="${jnpHost}" user="${user}" password="${password}">
			<createraentity resourceadaptorid="${ra.id}" entityname="${ra.entity}" />
			<activateraentity entityname="${ra.entity}" />
			<bindralinkname entityname="${ra.entity}" linkname="${ra.entity}" />
		</slee-management>
	</target>

	<target name="ra-activate" depends="ra-activate-without-properties,ra-activate-with-properties" />
	<target name="ra-deploy" depends="ra-install,ra-activate" />

	<target name="ra-uninstall" depends="create-deploy-urls">
		<echo>Uninstalling ${ra.entity}.</echo>
		<slee-management jnpport="${jnpPort}" host="${jnpHost}" user="${user}" password="${password}">
			<uninstall url="${file_url}${ra.url.to.deploy.ra}" />
			<uninstall url="${file_url}${ra.url.to.deploy.ratype}" />
		</slee-management>
	</target>

	<target name="ra-deactivate" depends="create-deploy-urls">
		<echo>Deactivating ${ra.entity}.</echo>
		<slee-management jnpport="${jnpPort}" host="${jnpHost}" user="${user}" password="${password}">
			<unbindralinkname linkname="${ra.entity}" />
			<deactivateraentity entityname="${ra.entity}" />
			<removeraentity entityname="${ra.entity}" />
		</slee-management>
	</target>

	<target name="ra-undeploy" depends="ra-deactivate,ra-uninstall" />

</project>

<?xml version="1.0"?>

<!--

 This is an ANT build file for the JAIN SLEE Technology Compatibility Kit 1.0

 To run this file, use Ant 1.5.1 or higher.
 (Available from http://jakarta.apache.org/ant/)
 
 This file must be run from the root JAIN SLEE TCK directory.

 This build file has the following useful targets:

 "clean"	- Delete all classes and jars created during the build of the JAIN SLEE TCK
		  Note that configuration files and JAIN SLEE TCK work and report directories
		  are not deleted.
		  
 "build-tck"	- Compile the JAIN SLEE TCK classes and build the jars required to
		  execute the JAIN SLEE TCK.
		  
 "javadoc"	- Build the javadoc for the JAIN SLEE TCK classes (excluding the test suite classes).
		  As the JavaTest tool and the JAIN SLEE TCK executable scripts form the user interface 
		  for the JAIN SLEE TCK, these classes will only be of interest to developers who are 
		  either writing or debugging tests, or who are writing a TCK resource adaptor 
		  for their JAIN SLEE implementation.
	      
 The default target is "build-tck".
 
 -->

<project name="JAIN SLEE TCK" default="build-tck" basedir=".">
  <!-- Ignore any externally set classpath -->
  <property name="build.sysclasspath" value="ignore"/>

   <!-- PATHS -->

   <property name="classes.root" value="classes"/>
   <property name="classes.sleetck" value="classes/sleetck"/>
   <property name="javadoc" value="javadoc"/>
   <property name="jars" value="jars"/>
   <property name="reports" value="reports"/>
   <property name="jars.slee-components" value="jars/slee-components"/>
   <property name="jars.deployable-units" value="jars/deployable-units"/>
   <property name="tck.source" value="src"/>
   <property name="slee-ant-tasks.jar" value="../ant-tasks/jars/slee-ant-tasks.jar"/>


   <!-- OUTPUT JARS -->

   <property name="tck.package" value="sleetck.jar"/>
   <property name="tck-ra-type.package" value="sleetck-ra-type-du.jar"/>
   <property name="tck-ra-common.package" value="sleetck-ra-common.jar"/>

   <!-- CLASSPATH -->

   <path id="project.class.path">
      <pathelement location="${classes.sleetck}"/>
   </path>

   <!-- CUSTOM TASKS -->

   <target name="build-tasks" depends="find-libs,ensure-classes-dir,ensure-jars-dir">
     <ant antfile="../ant-tasks/build.xml" dir="../ant-tasks"/>
      <taskdef name="sbbjar" classname="org.mobicents.ant.SbbJar" classpath="${slee-ant-tasks.jar}"/>
      <taskdef name="eventjar" classname="org.mobicents.ant.EventJar" classpath="${slee-ant-tasks.jar}"/>
      <taskdef name="profilespecjar" classname="org.mobicents.ant.ProfileSpecJar" classpath="${slee-ant-tasks.jar}"/>
      <taskdef name="deployablejar" classname="org.mobicents.ant.DeployableJar" classpath="${slee-ant-tasks.jar}"/>
      <taskdef name="resourceadaptortypejar" classname="org.mobicents.ant.ResourceAdaptorTypeJar" classpath="${slee-ant-tasks.jar}"/>
      <taskdef name="resourceadaptorjar" classname="org.mobicents.ant.ResourceAdaptorJar" classpath="${slee-ant-tasks.jar}"/>
   </target>
  
   <!-- CLEANERS -->

   <target name="clean-all-classes">
      <delete dir="${classes.root}" quiet="true"/>
      <mkdir  dir="${classes.root}"/>
   </target>

   <target name="clean-sleetck-classes">
      <delete dir="${classes.sleetck}" quiet="true"/>
   </target>

   <target name="clean-jars">
      <delete dir="${jars}" quiet="true"/>
   </target>

   <target name="clean" depends="clean-all-classes,clean-jars"/>

   <!-- TASK TO FIND LIBRARY DIRECTORY -->
  <target name="find-libs">
     <available file="../../../jain-slee-1.0-tck/lib" type="dir" property="libs" value="../../../jain-slee-1.0-tck/lib"/>

    <!-- LIBRARIES USED FOR COMPILATION -->

    <property name="slee.library" value="${libs}/slee_1_1.jar"/>
    <property name="javatest.library" value="${libs}/javatest.jar"/>
    <property name="jmx.library" value="${libs}/jmxri.jar"/>
    <property name="sleetck.library" value="${libs}/../jars/sleetck.jar"/>
  </target>


   <!-- TASKS TO ENSURE BUILD DIRECTORIES -->

   <target name="ensure-classes-dir">
      <mkdir dir="${classes.root}"/>
      <mkdir dir="${classes.sleetck}"/>
   </target>

   <target name="ensure-jars-dir">
      <mkdir dir="${jars}"/>
      <mkdir dir="${jars.slee-components}"/>
      <mkdir dir="${jars.deployable-units}"/>
   </target>

   <!-- TCK INFRASTRUCTURE -->

   <target name="build-infrastructure"
           depends="build-tasks"/>

   <!-- TEST SUITE AND SLEE COMPONENTS -->

   <target name="compile-tests" depends="ensure-classes-dir,find-libs">
      <echo>Compiling TCK tests. tck.source=${tck.source}, classes.sleetck=${classes.sleetck}</echo>
      <javac srcdir="${tck.source}" destdir="${classes.sleetck}" debug="on" >
         <classpath>
            <path refid="project.class.path"/>
            <pathelement location="${slee.library}"/>
            <pathelement location="${sleetck.library}"/>
            <pathelement location="${javatest.library}"/>
            <pathelement location="${jmx.library}"/>
         </classpath>
         <include name="org/mobicents/sleetck/**/*.java"/>
      </javac>
   </target>

   <!-- BUILD TEST SUITE -->
   
   <target name="build-test-suite" depends="build-infrastructure,compile-tests">
      <ant antfile="custom-components.xml"/>
   </target>

   <target name="build-tck" depends="build-infrastructure,build-test-suite"/>

   <!-- RUN TCK TESTS -->
   
   <target name="tests-slee-tck">
      <path id="slee.tck.du.path.id">
         <pathelement location="${jars.deployable-units}"/>
      </path>
      <path id="slee.tck.reports.path.id">
         <pathelement location="${reports}"/>
      </path>
      <path id="slee.tck.testsuite.path.id">
         <pathelement location="./testsuite"/>
      </path>
      <ant antfile="build.xml" dir="../../" target="tests-slee-tck-internal" inheritrefs="yes">
         <reference refid="slee.tck.du.path.id"/>
         <reference refid="slee.tck.reports.path.id"/>
         <reference refid="slee.tck.testsuite.path.id"/>
      </ant>
   </target>

</project>



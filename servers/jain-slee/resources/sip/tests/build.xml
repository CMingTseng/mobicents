<?xml version="1.0"?>

<!--

 This is an ANT build file for JAIN SLEE TCK 1.0 formatted tests

 To run this file, use Ant 1.5.1 or higher.
 (Available from http://jakarta.apache.org/ant/)
 
 This file must be run from the root JAIN SLEE TCK directory.

 This build file has the following useful targets:

 "clean"	- Delete all classes and jars created during the build of the JAIN SLEE TCK
		  Note that configuration files and JAIN SLEE TCK work and report directories
		  are not deleted.
		  
 "build-tests"	- Compile the test classes and build the jars required to
		  execute them.
		  
 "run-tests"	- Runs tests either a subset or all

 "javadoc"	- Build the javadoc for the test classes (excluding the test suite classes).
	      
 The default target is "build-tests".
 
 -->
<project name="JAIN_SLEE_TCK_SIPRA" default="build-tests" basedir=".">
	<!-- Definitions -->
	<property environment="system" />
	<property name="jboss.home" value="${system.JBOSS_HOME}" />
	<import file="${ant.file.JAIN_SLEE_TCK_SIPRA}/../../../../core/legacy/ant-scripts/mobicents-ant-common-ra.xml" />

	<property name="sipra.home" value="../" />
	<property name="node" value="all" />
	<!-- Ignore any externally set classpath -->
	<property name="build.sysclasspath" value="ignore" />
	<!-- PATHS -->
	<property name="build.dir" value="." />
	<property name="classes.root" value="${build.dir}/classes" />
	<!-- used in packaging -->
	<property name="classes.sleetests" value="${classes.root}" />
	<property name="javadoc" value="${build.dir}/javadoc" />
	<property name="jars" value="${build.dir}/jars" />
	<property name="reports" value="${build.dir}/reports" />
	<property name="jars.slee-components" value="${build.dir}/jars/slee-components" />
	<property name="jars.deployable-units" value="${build.dir}/jars/deployable-units" />
	<property name="tck.source" value="${build.dir}/src" />
	<property name="slee-ant-tasks-path" value="../../../tools/ant-tasks/target" />
	<path id="ant-tasks-path-tmp">
		<fileset dir="${slee-ant-tasks-path}">
			<include name="mobicents-tools-anttasks-*.jar" />
		</fileset>
	</path>
	<property name="slee-ant-tasks.jar" refid="ant-tasks-path-tmp" />
	<!-- OUTPUT JARS -->
	<property name="tck.package" value="sleetck.jar" />
	<property name="tck-ra-type.package" value="sleetck-ra-type-du.jar" />
	<property name="tck-ra-common.package" value="sleetck-ra-common.jar" />
	<!-- CLASSPATH -->
	<path id="project.class.path">

		<pathelement location="${jboss.home}/server/all/lib/jboss-j2ee.jar" />
		<pathelement location="${ant.file.JAIN_SLEE_TCK_SIPRA}/../../../core/jar/target/classes" />
	</path>
	<path id="ra-jar-path">
		<fileset dir="${sipra.home}/ra/target">
			<include name="sip-ra*.jar" />
		</fileset>
	</path>
	<path id="ratype-jar-path">
		<fileset dir="${sipra.home}/ratype/target">
			<include name="sip-ratype*.jar" />
		</fileset>
	</path>
	<path id="sip-path">
		<pathelement location="lib/SipStackBinder.jar" />
		<pathelement location="lib/jain-sip-api-1.2.jar" />
		<pathelement location="lib/jain-sip-ri-1.2.jar" />
		<path refid="ra-jar-path"/>
		<path refid="ratype-jar-path"/>
		
		<pathelement location="${jboss.home}/lib/jboss-common.jar" />
		<pathelement location="${jboss.home}/server/${node}/jnpserver.jar" />
		<pathelement location="${mobicents.home}/lib/concurrent.jar" />
		<pathelement location="${jboss.home}/client/jboss-aop-jdk50-client.jar" />
		<pathelement location="${jboss.home}/client/jboss-aspect-jdk50-client.jar" />
		<pathelement location="${jboss.home}/client/jbossall-client.jar" />
	</path>
	<!-- CUSTOM TASKS -->
	<target name="build-tasks" depends="find-libs,ensure-classes-dir,ensure-jars-dir">

		<taskdef name="sbbjar" classname="org.mobicents.ant.SbbJar" classpath="${slee-ant-tasks.jar}" />
		<taskdef name="eventjar" classname="org.mobicents.ant.EventJar" classpath="${slee-ant-tasks.jar}" />
		<taskdef name="profilespecjar" classname="org.mobicents.ant.ProfileSpecJar" classpath="${slee-ant-tasks.jar}" />
		<taskdef name="deployablejar" classname="org.mobicents.ant.DeployableJar" classpath="${slee-ant-tasks.jar}" />
		<taskdef name="resourceadaptortypejar" classname="org.mobicents.ant.ResourceAdaptorTypeJar" classpath="${slee-ant-tasks.jar}" />
		<taskdef name="resourceadaptorjar" classname="org.mobicents.ant.ResourceAdaptorJar" classpath="${slee-ant-tasks.jar}" />
	</target>
	<!-- CLEANERS -->
	<target name="clean-all-classes">
		<delete dir="${classes.root}" quiet="true" />
	</target>
	<target name="clean-reports">
		<delete dir="reports" quiet="true" />
	</target>

	<target name="clean-jars">
		<delete dir="${jars}" quiet="true" />
	</target>
	<target name="clean" depends="clean-all-classes,clean-jars,clean-reports" description="clean up build artifacts" />
	<!-- TASK TO FIND LIBRARY DIRECTORY -->
	<target name="find-libs">
		<available file="${mobicents.home}/jain-slee-1.0-tck/lib" type="dir" property="libs" value="${mobicents.home}/jain-slee-1.0-tck/lib" />
		<!-- LIBRARIES USED FOR COMPILATION -->
		<property name="slee.library" value="${libs}/slee.jar" />
		<property name="javatest.library" value="${libs}/javatest.jar" />
		<property name="jmx.library" value="${libs}/jmxri.jar" />
		<property name="sleetck.library" value="${libs}/../jars/sleetck.jar" />
		<property name="log4j" value="../lib/log4j.jar" />
	</target>
	<!-- TASKS TO ENSURE BUILD DIRECTORIES -->
	<target name="ensure-classes-dir">
		<mkdir dir="${classes.root}" />
		<mkdir dir="reports" />
	</target>
	<target name="ensure-jars-dir">
		<mkdir dir="${jars}" />
		<mkdir dir="${jars.slee-components}" />
		<mkdir dir="${jars.deployable-units}" />
	</target>
	<!-- TCK INFRASTRUCTURE -->
	<target name="build-infrastructure" depends="build-tasks" />
	<!-- TEST SUITE AND SLEE COMPONENTS -->
	<target name="compile-tests" depends="ensure-classes-dir,find-libs">
		<echo>Compiling TCK tests. tck.source=${tck.source}</echo>
		<javac srcdir="${tck.source}" destdir="${classes.root}" debug="on" source="1.4">
			<classpath>
				<path refid="project.class.path" />
				<path refid="sip-path" />
				<path refid="mobicents.core.classpath" />
				<pathelement location="${slee.library}" />
				<pathelement location="${sleetck.library}" />
				<pathelement location="${javatest.library}" />
				<pathelement location="${jmx.library}" />
			</classpath>
			<include name="org/mobicents/sleetests/**/*.java" />

		</javac>
		<copy todir="${classes.root}">
			<fileset dir="${tck.source}">
				<filename name="**/*.properties" />
			</fileset>

		</copy>
	</target>
	<!-- BUILD TEST SUITE -->
	<target name="build-test-suite" depends="build-infrastructure,compile-tests">
		<ant antfile="${build.dir}/custom-components.xml" />
	</target>
	<target name="build-tests" depends="build-infrastructure,build-test-suite" description="build tests" />
	<!-- RUN TCK TESTS -->
	<target name="run-tests" description="run tests. For example 'ant run-tests -Dtests=org/mobicents">
		<path id="slee.tck.du.path.id">
			<pathelement location="${jars.deployable-units}" />
		</path>
		<path id="slee.tck.reports.path.id">
			<pathelement location="${reports}" />
		</path>
		<path id="slee.tck.testsuite.path.id">
			<pathelement location="${build.dir}/src" />
		</path>
		<path id="slee.tck.jtx.file.id">
			<pathelement location="${build.dir}/testsuite/jain-slee-tck-1_0.jtx" />
		</path>
		<path id="slee.tests.aux.libs.id" refid="sip-path">

		</path>
		<path id="slee.tests.classes.id">
			<pathelement location="${ant.file.JAIN_SLEE_TCK_SIPRA}/../${classes.root}" />
		</path>
		<ant antfile="build.xml" dir="${ant.file.JAIN_SLEE_TCK_SIPRA}/../../../../core/legacy/tests" target="tests-slee-tck-internal" inheritrefs="yes">
			<reference refid="slee.tck.du.path.id" />
			<reference refid="slee.tck.reports.path.id" />
			<reference refid="slee.tck.testsuite.path.id" />
			<reference refid="slee.tck.jtx.file.id" />
			<reference refid="slee.tests.aux.libs.id" />
			<reference refid="slee.tests.classes.id" />
		</ant>
	</target>

</project>

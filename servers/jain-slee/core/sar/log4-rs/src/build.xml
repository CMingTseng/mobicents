<?xml version="1.0"?>

<!-- ======================================================================= -->
<!-- JBoss build file                                                      -->
<!-- ======================================================================= -->

<project name="Log4jRepositorySelector" default="main" basedir=".">
   <!-- Build properties, allow override from local labs/ant.properties file -->
   <property file="../ant.properties"/>
   <property environment="env"/>
   <property name="src.dir" value="${basedir}/src/main"/>
   <property name="resources.dir" value="${basedir}/resources"/>
   <property name="build.dir" value="${basedir}/build"/>
   <property name="build.deploy.dir" value="${build.dir}/deploy"/>
   <property name="build.classes.dir" value="${build.dir}/classes"/>
   <property name="jboss.bundle.dir" value="${env.JBOSS_HOME}"/>
   <property name="jboss.dist.dir" value="${jboss.bundle.dir}"/>
   <property name="jboss.default.dir" value="${jboss.dist.dir}/server/default"/>
   <property name="jboss.deploy.dir" value="${jboss.default.dir}/deploy"/>
   <property name="jboss.client.dir" value="${jboss.dist.dir}/client"/>
   <property name="base.lib.dir" value="${jboss.bundle.dir}/lib"/>
   <property name="default.lib.dir" value="${jboss.default.dir}/lib"/>

   <!-- The build classpath -->
   <path id="build.classpath">
      <pathelement location="${default.lib.dir}/javax.servlet.jar"/>
      <pathelement location="${default.lib.dir}/jboss.jar"/>
      <pathelement location="${base.lib.dir}/jboss-system.jar"/>
      <pathelement location="${base.lib.dir}/jboss-jmx.jar"/>
      <pathelement location="${jboss.client.dir}/jbossall-client.jar" />
      <pathelement location="${jboss.client.dir}/log4j.jar"/>
      <pathelement location="${jboss.client.dir}/concurrent.jar"/>
      <pathelement location="${build.classes.dir}"/>
   </path>
   <path id="client.classpath">
      <pathelement location="${default.lib.dir}/jboss-j2ee.jar"/>
      <pathelement location="${base.lib.dir}/jboss-jmx.jar"/>
      <pathelement location="${jboss.dist.dir}/client/jaas.jar"/>
      <pathelement location="${jboss.dist.dir}/client/jbossall-client.jar" />
      <pathelement location="${jboss.dist.dir}/client/log4j.jar"/>
      <pathelement location="${basedir}/src"/>
      <pathelement location="${resources.dir}"/>
   </path>

   <!-- =================================================================== -->
   <!-- Prepares the build directory                                        -->
   <!-- =================================================================== -->
   <target name="prepare">
      <mkdir dir="${build.classes.dir}"/>
      <mkdir dir="${build.deploy.dir}"/>
      <mkdir dir="${build.classes.dir}/META-INF"/>
   </target>

   <!-- =================================================================== -->
   <!-- Compiles the source code                                            -->
   <!-- =================================================================== -->
   <target name="compile" depends="prepare">
      <javac srcdir="${src.dir}"
         destdir="${build.classes.dir}"
         classpathref="build.classpath"
         debug="on"
         deprecation="off"
         optimize="off"
      >
      </javac>
   </target>

   <!-- =================================================================== -->
   <!-- Creates the jar archives                                            -->
   <!-- =================================================================== -->
   <target name="main" depends="compile">

      <!-- Build the Monitor SAR -->
      <copy todir="${build.classes.dir}/META-INF">
	 <fileset dir="${basedir}/META-INF">
            <include name="*.xml" />
         </fileset>
      </copy>
      
      <!-- copy todir="${build.deploy.dir}/log4j-rs.sar">
	      <fileset dir="${build.classes.dir}">
		      <include name="**/*.*" />
	      </fileset>
      </copy -->

      <jar destfile="${build.deploy.dir}/log4j-rs.sar" basedir="${build.classes.dir}"/>
      
      	<!-- Put the sar in the deploy of JBoss and deploy service XML file -->
	<copy todir="${jboss.deploy.dir}" file="${build.deploy.dir}/log4j-rs.sar">
	</copy>

   </target>



   <!-- =================================================================== -->
   <!-- Cleans up generated stuff                                           -->
   <!-- =================================================================== -->
   <target name="clean">
      <delete dir="${build.dir}"/>
      <delete file="${jboss.deploy.dir}/log4j-rs.sar"/>
   </target>

</project>


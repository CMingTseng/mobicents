<?xml version='1.0'?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
]>
<chapter
	id="chapter-Running_Mobicents">
	<title>Running Mobicents</title>
	<section
		id="Running_the_Mobicents_Application_Server">
		<title>Running the Mobicents Application Server</title>
		<para>Once installed, running Mobicents simply consists in changing to the <filename><replaceable>&lt;mobicents_topmost_directory&gt;</replaceable>/server/bin</filename> directory and invoking <command>run.sh</command> (Linux) or <command>run.bat</command> (Windows) The precise instructions depend on which platform you are running Mobicents on.</para>
		<variablelist>
			<title>Platform Mobicents is Running On</title>
			<varlistentry>
				<term>Linux</term>
				<listitem>
					<orderedlist>
						<listitem>
							<para>Change your working directory to the <filename><replaceable>&lt;mobicents_topmost_directory&gt;</replaceable>/server/bin</filename> directory:</para>
							<screen>
<command>cd <filename><replaceable>&lt;mobicents_topmost_directory&gt;</replaceable>/server/bin</filename>
								</command>
</screen>
						</listitem>
						<listitem>
							<para>Ensure that the <filename>run.sh</filename> file is executable. If it isn't, modify its permissions so that it is:</para>
							<screen>
<command>chmod +x <filename>run.sh</filename>
								</command>
</screen>
						</listitem>
						<listitem>
							<para>Finally, start the Mobicents Application Server:.</para>
							<screen>
<command>./run.sh</command>
</screen>
							<note>
								<para>The above command is a shortened version of this equivalent command:</para>
								<screen>
<command>./run.sh -c all -b 127.0.0.1</command>
</screen>
							</note>
						</listitem>
					</orderedlist>
				</listitem>
			</varlistentry>
			<varlistentry>
				<term>Windows</term>
				<listitem>
					<orderedlist>
						<listitem>
							<para>Change your working directory to the <filename><replaceable>&lt;mobicents_folder&gt;</replaceable>\server\bin</filename> folder.</para>
						</listitem>
						<listitem>
							<para>Start the Mobicents Application Server:</para>
							<screen>
<command>run.bat</command>
</screen>
							<note>
								<para>The above command is a shortened version of this equivalent command:</para>
								<screen>
<command>run.bat -c all -b 127.0.0.1</command>
</screen>
							</note>
						</listitem>
					</orderedlist>
				</listitem>
			</varlistentry>
		</variablelist>
	</section>
	<section
		id="chapter-Deploying_and_Undeploying_Resource_Adapters">
		<title>Deploying and Undeploying Resource Adapters</title>
		<para>Mobicents resource adapters can be deployed in several different ways. The easiest way depends on whether you would rather deploy them through the Mobicents Management Console, or by copying the deployable unit files into the correct directory, or by deploying them via the command line.</para>
		<para>Likewise, undeploying resource adapters can be accomplished in multiple ways. At the end of each of the following sections on deploying resource adapters there is, in addition, a section on how, similarly, to undeploy them.</para>
		<section
			id="section-Deploying_Resource_Adapters_with_the_Management_Console">
			<title>Deploying Resource Adapters with the Management Console</title>
			<para>Using the Mobicents Management Console is the graphical way to deploy and undeploy resource adapters. For an introduction to&mdash;and more information on&mdash;the Mobicents Management Console, refer to <xref
					linkend="chapter-Working_with_the_Mobicents_Management_Console"/>. The following instructions will assume that you are at least slightly familiar with the Management Console.</para>
			<para>Once Mobicents is running, point your browser to <systemitem><ulink
						url="http://localhost:8080/management-console/"/>
		</systemitem> to open the Managment Console. First, click on <guilabel>Deployable Units</guilabel> on the Main Menu to open <guilabel>Deployable Units</guilabel> in the main view. You will see a list of currently deployed units under the <guimenuitem>Browse</guimenuitem> tab (which might currently read <literal>No deployable unit found</literal>), and the possibility of searching for and installing deployable units in the <guimenuitem>Search</guimenuitem> and <guimenuitem>Install</guimenuitem> tabs. We are going to install a deployable unit, so click on the <guimenuitem>Install</guimenuitem> tab. Now, at the top of the view it should read <guilabel>Install a deployable unit</guilabel>, and under it you will see a <guilabel>Package file:</guilabel> prompt, and a field to hold the file name, with <guibutton>Browse...</guibutton> and <guibutton>Install</guibutton> buttons to the right of it.</para>
			<figure
				id="figure-deployable_units-install.png">
				<title>The <guibutton>Install</guibutton> tab of the <guilabel>Deployable Units</guilabel> view in the Management Console.</title>
				<mediaobject>
					<imageobject>
						<imagedata
							align="center"
							width="700"
							fileref="images/deployable_units-install.png"
							format="PNG"/>
					</imageobject>
				</mediaobject>
			</figure>
			<para>Before we click the <guibutton>Browse...</guibutton> button to search for deployable unit files, it is important to know how to recognize them, and in which order they should be installed.</para>
			<formalpara
				id="How_Do_I_Recognize_Deployable_Unit_Files">
				<title>How Do I Recognize Deployable Unit Files?</title>
				<para></para>
			</formalpara>
			<itemizedlist>
				<listitem>
					<para>Deployable unit files are <literal>jar</literal> files, so their file names will end with the extension <filename>.jar</filename>.</para>
				</listitem>
				<listitem>
					<para>The base name of the file name ends with <literal>-DU</literal>. For example, if we are looking to install the <acronym>SIP</acronym> resource adapter, and we are looking in <filename><replaceable>&lt;topmost_mobicents_directory&gt;</replaceable>/resources/sipra</filename>, then we see two files named <filename>sip-ra-DU.jar</filename> and <filename>sip-ratype-DU.jar</filename>. We must install <emphasis>both</emphasis> of these file, whose names end in <literal>-DU.jar</literal>, in order to completely install the <acronym>SIP</acronym> resource adapter. The order in which we install these files is also important, so make sure to read the next section before attempting to browse and install these files.</para>
				</listitem>
			</itemizedlist>
			<formalpara>
				<title>In Which Order Should I Install the Deployable Unit Files?</title>
				<para>As mentioned, the order in which you install the deployable unit files is important. You will find two deployable unit files in the directory for the resource adapter you want to deploy. One of them will be named <filename><replaceable>&lt;resource_adapter&gt;</replaceable>-ratype-DU.jar</filename>, and the other will be named <filename><replaceable>&lt;resource_adapter&gt;</replaceable>-ra-DU.jar</filename>.</para>
			</formalpara>
			<para>The file with <literal>ratype</literal> in the filename is a dependency of the other file, and it <emphasis>must be installed first</emphasis>. For example, in the <acronym>SIP</acronym> resource adapter directory (we will discuss how to find the appropriate directory for your resource adapter in the next section), we find these two deployable unit files: <filename>sip-ra-DU.jar</filename> and <filename>sip-ratype-DU.jar</filename>. The file named <replaceable>&lt;sip&gt;</replaceable>-ra-DU.jar is the <quote>main</quote> deployable unit file for the <acronym>SIP</acronym> resource adapter, which we know because its file name has the name of the resource adapter (<filename>sip</filename>), followed by a hyphen and then <literal>ra</literal>, which stands for <quote>resource adapter</quote>. This <quote>main</quote> resource adapter file has a dependency: the <filename>sip-ratype-DU.jar</filename> file, which, as we noted, must be installed first.</para>
			<formalpara>
				<title>Installing the Deployable Unit Files</title>
				<para>Click <guibutton>Browse...</guibutton> and navigate to the <filename><replaceable>&lt;mobicents_topmost_directory&gt;</replaceable>/resources</filename> directory. In this directory are subdirectories corresponding to the names of installable resource adapters. For example, the <filename>sipra</filename> directory refers to the <acronym>SIP</acronym> resource adapter. Find the correct directory for the resource adapter you want to install and enter it using the file selection dialog.</para>
			</formalpara>
			<para>Unfortunately, it is not possible to select multiple files with the file selection dialog and deploy everything at once, thereby avoiding the need to deploy them in the correct order. Locate all of the deployable unit files in the directory (explained above), determine which one is the <quote>main</quote> deployable unit file for the resource adapter, and select the first of its dependencies with the file selector.</para>
			<figure
				id="figure-deployable_units-selecting_the_ratype_dependency.png">
				<title>Selecting the First Dependency of the Deployable Unit Files for the <acronym>SIP</acronym> Resource Adapter.</title>
				<mediaobject>
					<imageobject>
						<imagedata
							align="center"
							fileref="images/deployable_units-selecting_the_ratype_dependency.png"
							format="PNG"/>
					</imageobject>
				</mediaobject>
			</figure>
			<para>Back at the <guimenuitem>Install</guimenuitem> tab of the <guilabel>Deployable Units</guilabel> screen, the location of the deployable unit file should now be entered in the text entry field. Click the <guibutton>Install</guibutton> button to install it. If you followed the correct order for installing deployable unit files, then a message similar to <computeroutput>[INFO] Deployable unit installed</computeroutput> will appear in the Management Console log at the bottom of the browser window. If you tried to install the files in the wrong order, then an error message similar to the following will appear in the log:</para>
			<para>
				<computeroutput>[ERROR] javax.slee.management.DeploymentException: Could not deploy: No DeployableUniDeploymentDescriptor descriptor (META-INF/deployable-unit.xml) was found in deployable...</computeroutput>. If you receive this error, you should try to deploy the deployable unit files in a different order.</para>
			<para>If you succeeded in deploying the desired resource adapter, you will see the name of that resource adapter in the <guilabel>Resources</guilabel> view of the Management Console.</para>
			<figure
				id="figure-deployable_units-installation_success.png">
				<title>Successful Deployment of the <acronym>SIP</acronym> Resource Adapter</title>
				<mediaobject>
					<imageobject>
						<imagedata
							align="center"
							fileref="images/deployable_units-installation_success.png"
							format="PNG"/>
					</imageobject>
				</mediaobject>
			</figure>
			<formalpara>
				<title>Undeploying Resource Adapters with the Management Console</title>
				<para>Undeploying a resource adapter with the Management Console consists in removing the deployable unit files, and must be done <emphasis>in the opposite order</emphasis> of installing them. To undeploy a resource adapter, click on <guimenuitem>Deployable Units</guimenuitem> in the Main Menu, and make sure the <guimenuitem>Browse</guimenuitem> tab is selected at the top of the <guilabel>Deployable Units</guilabel> view.</para>
			</formalpara>
			<para>Both deployable unit files must be uninstalled, starting with the <quote>main</quote> deployable unit file for the resource adapter (<abbrev>i.e.</abbrev>, the file that has <literal>ra</literal> rather than <literal>ratype</literal> in its file name). In the screenshot below, which shows the two deployable unit files for the <acronym>SIP</acronym> resource adapter, the two files should be uninstalled in the following order: <filename>sip-ra-DU.jar</filename> followed by <filename>sip-ratype-DU.jar</filename>. Trying to uninstall the files in the opposite order will produce an error in the Management Console log at the bottom of the browser. To uninstall the files, simply click the <guilabel>uninstall</guilabel> link on the right side, in the  <guilabel>Actions</guilabel> column.</para>
			<figure
				id="figure-deployable_units-uninstalling.png">
				<title>Uninstalling deployable unit files for the <acronym>SIP</acronym> resource adapter: the main deployable unit file is <filename>sip-ra-DU.jar</filename>, and should be uninstalled first</title>
				<mediaobject>
					<imageobject>
						<imagedata
							align="center"
							fileref="images/deployable_units-uninstalling.png"
							format="PNG"/>
					</imageobject>
				</mediaobject>
			</figure>
			<para>Successful uninstallation means that neither deployable unit files are listed in the <guimenuitem>Browse</guimenuitem> tab of the <guilabel>Deployable Units</guilabel> view, and the resource adapter is not listed in the <guilabel>Resources</guilabel> view.</para>
		</section>
		<section
			id="section-Deploying_Resource_Adapters_by_Copying_Deployable_Unit_Files">
			<title>Deploying Resource Adapters by Copying Deployable Unit Files</title>
			<para>
				<xref
					linkend="How_Do_I_Recognize_Deployable_Unit_Files"/>
			</para>
		</section>
		<section
			id="section-Deploying_Resource_Adapters_Via_the_Command_Line">
			<title>Deploying Resource Adapters Via the Command Line</title>
			<para>Most Mobicents resource adapters can be run by simply issuing an ant task command from the topmost Mobicents directory.</para>
			<note>
				<para>Remember to replace <filename><replaceable>&lt;mobicents_topmost_directory&gt;</replaceable>
				</filename> and <filename><replaceable>&lt;resource_adapter&gt;</replaceable>
				</filename> in the paths below with the name of the topmost Mobicents directory and the directory name corresponding to the correct resource adapter, respectively. Look in <filename><replaceable>&lt;mobicents_topmost_directory&gt;</replaceable>/resources</filename> to find the directory name corresponding to the resource adapter you want to deploy.</para>
			</note>
			<orderedlist>
				<listitem>
					<para>Change to the directory in the Mobicents installation:</para>
					<para>
				<screen>
<command>cd  <filename><replaceable>&lt;mobicents_topmost_directory&gt;</replaceable>
							</filename>
						</command>
</screen>
					</para>
				</listitem>
				<listitem>
					<para>Run the ant build-and-deploy script:</para>
					<screen>
<command>tools/ant/bin/ant -f <filename>resources/<replaceable>&lt;resource_adapter&gt;</replaceable>/build.xml</filename> ra-deploy</command>
</screen>
					<para>For example, the directory name in <filename><replaceable>&lt;mobicents_topmost_directory&gt;</replaceable>/resources</filename> corresponding to the JAIN SIP resource adapter is (currently) named <filename>sipra</filename> ("SIP Resource Adapter"). To deploy the SIP resource adapter, therefore, you would issue the following command:</para>
					<screen>
<command>tools/ant/bin/ant -f <filename>resources/sipra/build.xml</filename> ra-deploy</command>
</screen>
				</listitem>
			</orderedlist>
			<formalpara
				id="fpara-Undeploying_Resource_Adapters_Via_the_Command_Line">
				<title>Undeploying Resource Adapters Via the Command Line</title>
				<para>Resource Adapters can be undeployed in almost exactly the same way that they are deployed. To undeploy a resource adapter, issue the following command from the topmost Mobicents directory, replacing <replaceable>&lt;resource_adapter&gt;</replaceable> with the name of the directory corresponding to the name of the resource adapter you want to undeploy:</para>
			</formalpara>
			<screen>
<command>tools/ant/bin/ant -f <filename>resources/<replaceable>&lt;resource_adapter&gt;</replaceable>/build.xml</filename> ra-undeploy</command>
</screen>
		</section>
	</section>
</chapter>

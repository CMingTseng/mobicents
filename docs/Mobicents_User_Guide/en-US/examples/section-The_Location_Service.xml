<?xml version='1.0'?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
]>
<section
	id="section-The_Location_Service">
	<title>The Location Service</title>
	<para>The Location Service contains a (currently hard-coded<footnote
			xreflabel="footnote-Location_Service-Hard-Coded_Addresses"><para>The Location Service currently performs a lookup on a hard-coded list of addresses. This model is evolving toward the eventual use of a database.</para>
		</footnote>) list of mappings of request URIs to destination addresses. When the Location Service receives a request, it performs a lookup on that mapping and proxies the request simultaneously to the destination address (or addresses) associated with that URI.</para>
	<para>Regardless of whether the JBoss Application Server or the Tomcat Servlet Container is the Servlets Server being used, the following steps are the ones performed by the application and container in conjunction with the Location Service:</para>
	<itemizedlist>
		<listitem>
			<para>A hypothetical user named Alice makes a call to <literal>sip:receivers@sip-servlets.com</literal>. The <literal>INVITE</literal> is received by the servlet container, which invokes the Location Service.</para>
		</listitem>
		<listitem>
			<para>The Location Service, using non-SIP means, determines that the callee (i.e. the receiver) is registered at two locations, identified by two SIP URIs: <literal>sip:receiver@127.0.0.1:5090</literal> and <literal>sip:receiver@127.0.0.1:6090</literal>.</para>
		</listitem>
		<listitem>
			<para>The Location Service proxies to those two destinations in parallel, without record-routing, and without making use of supervised mode.</para>
		</listitem>
		<listitem>
			<para>One of the destinations returns a <literal>200 (OK)</literal>; the second proxy is then cancelled.</para>
		</listitem>
		<listitem>
			<para>The <literal>200 (OK) is forwarded to Alice, and call setup is completed as usual.</literal>
			</para>
		</listitem>
	</itemizedlist>
	<para>Here is the current list of hard-coded contacts<footnoteref linkend="footnote-Location_Service-Hard-Coded_Addresses"/> and their location URIs:</para>
	<itemizedlist>
		<title>sip:receiver@sip-servlets.com</title>
		<listitem>
			<para>
					<literal>sip:receiver@127.0.0.1:5090</literal>
				</para>
		</listitem>
		<listitem>
			<para>
				<literal>sip:receiver@127.0.0.1:6090</literal>
			</para>
		</listitem>
	</itemizedlist>
	
	<!-- The Location Service -->
	<section
		id="section-binary-Location_Service--Installing_Configuring_and_Running">
		<title>The Location Service: Installing, Configuring and Running</title>
		<para></para>
		<formalpara
			id="formalpara-binary-Location_Service-Pre-Install_Requirements_and_Prerequisites">
			<title>Pre-Install Requirements and Prerequisites</title>
			<para></para>
		</formalpara>
		<!-- <variablelist
			id="variablelist-binary-Location_Service-Hardware_Requirements">
			<title>Hardware Requirements</title>
			<varlistentry>
				<term>Sufficient Disk Space</term>
				<listitem>
					<para></para>
				</listitem>
			</varlistentry>
		</variablelist> -->
		<variablelist
			id="variablelist-binary-Location_Service-Software_Prerequisites">
			<title>Software Prerequisites</title>
			<varlistentry>
				<term>Either an MSS for JBoss or an MSS for Tomcat Installation</term>
				<listitem>
					<para>Before proceeding, you should follow the instructions for installing, configuring, running and testing either an MSS for JBoss or an MSS for Tomcat binary installation:</para>
					<itemizedlist>
						<listitem>
							<para>
								<ulink
									url="section-binary-SIP_Servlets_Server_with_JBoss-Installing_Configuring_and_Running"/>
							</para>
						</listitem>
						<listitem>
							<para>
								<ulink
									url="section-binary-SIP_Servlets_Server_with_Tomcat-Installing_Configuring_and_Running"/>
							</para>
						</listitem>
					</itemizedlist>
				</listitem>
			</varlistentry>
		</variablelist>
		<formalpara
			id="formalpara-binary-Location_Service-Downloading">
			<title>Downloading</title>
			<para>Download the Location Service's Web ARchive (WAR file) here:</para>
		</formalpara>
		<itemizedlist>
			<listitem>
				<ulink
					url="http://repository.jboss.org/maven2/org/mobicents/servlet/sip/example/location-service/1.1/location-service-1.1.war"/>
			</listitem>
		</itemizedlist>
		<para>Its corresponding Data ARchive can be downloaded here:</para>
		<itemizedlist>
			<listitem>
				<ulink
					url="http://www.mobicents.org/locationservice-dar.properties"/>
			</listitem>
		</itemizedlist>
		<formalpara
			id="formalpara-binary-Location_Service-Installing">
			<title>Installing</title>
			<para>Both the <filename>location-service-1.1.war</filename> WAR file and the <filename>locationservice-dar.properties</filename> DAR file should be placed into different directories in your SIP Servlet Server installation hierachy. Which location depends on whether you are using the Location Service with MSS for JBoss or with MSS for Tomcat:</para>
		</formalpara>
		<variablelist>
			<varlistentry>
				<term>MSS for JBoss</term>
				<listitem>
					<para>Place <filename>location-service-1.1.war</filename> into the <filename><envar>JBOSS_HOME</envar>/server/default/deploy/</filename> directory, and <filename>locationservice-dar.properties</filename> into the <filename><envar>JBOSS_HOME</envar>/server/default/conf/dars/</filename> directory.</para>
				</listitem>
			</varlistentry>
			<varlistentry>
				<term>MSS for Tomcat</term>
				<listitem>
					<para>Place <filename>location-service-1.1.war</filename> into the <filename><envar>CATALINA_HOME</envar>/webapps/</filename> directory, and <filename>locationservice-dar.properties</filename> into the <filename><envar>CATALINA_HOME</envar>/conf/dars/</filename> directory.</para>
				</listitem>
			</varlistentry>
		</variablelist>
		<formalpara
			id="formalpara-binary-Location_Service-Configuring">
			<title>Configuring</title>
			<para>The <literal>darConfigurationFileLocation</literal> attribute of the <literal>Service</literal> element must be set to the value <userinput>darConfigurationFileLocation</userinput>. The instructions are given below by SIP Servlets Server breed:</para>
		</formalpara>
		<variablelist>
			<varlistentry>
				<term>MSS for JBoss</term>
				<listitem>
					<para>Open the <filename><envar>JBOSS_HOME</envar>/server/default/deploy/jboss-web.deployer/server.xml</filename> configuration file and find the <literal>Service</literal> element. Add an attribute to it called <userinput>darConfigurationFileLocation</userinput>, and set it to <replaceable>conf/dars/locationservice-dar.properties</replaceable>.  Make sure that the configuration file only contains one <literal>darConfigurationFileLocation</literal> attribute: your new one.</para>
				</listitem>
			</varlistentry>
			<varlistentry>
				<term>MSS for Tomcat</term>
				<listitem>
					<para>Open the <filename><envar>CATALINA_HOME</envar>/conf/server.xml</filename> configuration file and find the <literal>Service</literal> element. Add an attribute to it called <userinput>darConfigurationFileLocation</userinput>, and set it to <userinput>conf/dars/locationservice-dar.properties</userinput>. Make sure that the configuration file only contains one <literal>darConfigurationFileLocation</literal> attribute: your new one.</para>
				</listitem>
			</varlistentry>
		</variablelist>
		<formalpara
			id="formalpara-binary-Location_Service-Running">
			<title>Running</title>
			<para>If you are using an MSS for JBoss instance, refer to the following section for details on how to run it:</para>
		</formalpara>
		<itemizedlist>
			<listitem>
				<para>
					<ulink
						url="section-binary-SIP_Servlets_Server_with_JBoss-Running"/>
				</para>
			</listitem>
		</itemizedlist>
		<para>Or, if you are using an MSS for Tomcat instance, refer to the following section for details on running it:</para>
		<itemizedlist>
			<listitem>
				<para>
					<ulink
						url="section-binary-SIP_Servlets_Server_with_Tomcat-Running"/>
				</para>
			</listitem>
		</itemizedlist>
		<formalpara
			id="formalpara-binary-Location_Service-Testing">
			<title>Testing</title>
		</formalpara>
		<procedure>
			<title></title>
			<step>
				<para>Start two SIP softphones. The first phone should be set up as <userinput>sip:receiver@sip-servlets.com</userinput> at IP address <userinput>127.0.0.1</userinput> on port <userinput>5090</userinput>. The second phone can be set up in any way you like. Note that the SIP phones do not have to be registered.</para>
			</step>
			<step>
				<para>Using the second phone, make a call to <literal>sip:receiver@sip-servlets.com</literal>. If the Location Service has been set up correctly and is running, the first phone—as the receiver or callee—should now be ringing.</para>
			</step>
		</procedure>
		<!--<formalpara
			id="formalpara-binary-Location_Service-Using">
			<title>Using</title>
			<para></para>
		</formalpara>-->
		<formalpara
			id="formalpara-binary-Location_Service-Stopping">
			<title>Stopping</title>
			<para>If you are using an MSS for JBoss instance, refer to the following section for details on how to stop it:</para>
		</formalpara>
		<itemizedlist>
			<listitem>
				<para>
					<ulink
						url="section-binary-SIP_Servlets_Server_with_JBoss-Stopping"/>
				</para>
			</listitem>
		</itemizedlist>
		<para>Or, if you are using an MSS for Tomcat instance, refer to the following section for details on stopping it:</para>
		<itemizedlist>
			<listitem>
				<para>
					<ulink
						url="section-binary-SIP_Servlets_Server_with_Tomcat-Stopping"/>
				</para>
			</listitem>
		</itemizedlist>
		<formalpara
			id="formalpara-binary-Location_Service-Uninstalling">
			<title>Uninstalling</title>
			<para>Unless disk space is at a premium, there is usually no need to uninstall the Location Service. However, if you will not be using it again, you may want to unset the <literal>darConfigurationFileLocation</literal> attribute of the <literal>Service</literal> element, which you set to <literal>conf/dars/locationservice-dar.properties</literal>, in either the <filename><envar>JBOSS_HOME</envar>/server/default/deploy/jboss-web.deployer/server.xml</filename> (MSS for JBoss) or the <filename><envar>CATALINA_HOME</envar>/conf/server.xml</filename> (MSS for Tomcat) configuration file. Basically, you want to undo the procedure you performed in <xref
					linkend="formalpara-binary-Location_Service-Configuring"/>.</para>
		</formalpara>
		<para>You may also wish to delete the WAR and DAR files for the Location Service, which you installed in <xref
				linkend="formalpara-binary-Location_Service-Installing"/>.</para>
	</section>
</section>

<?xml version="1.0" encoding="UTF-8" ?>

<plugin name="MobicentsSipServlets"
        displayName="Mobicents Sip Servlets Application Container"
        package="org.rhq.plugins.mobicents.servlet.sip"
        version="1.0"
        description="Statistics for SipApplicationDispatcher"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns="urn:xmlns:rhq-plugin"
        xmlns:c="urn:xmlns:rhq-configuration">

   	<depends plugin="JMX" />
   	<depends plugin="JBossAS" useClasses="true"/>
   
	<service name="MobicentsSipServlets"
         discovery="org.rhq.plugins.jmx.MBeanResourceDiscoveryComponent"
         class="org.rhq.plugins.jmx.MBeanResourceComponent"
         description="Statistics for SipApplicationDispatcher"
         >
		
		<!-- The service will run inside the Embedded Tomcat Server of the JBoss AS plugin -->
		<runs-inside>
   			<parent-resource-type name="Embedded Tomcat Server" plugin="JBossAS"/>
      	</runs-inside>

		<!-- Discovery of Sip Application Dispatcher object is done through JMX -->
        <plugin-configuration>
           	<c:simple-property name="objectName" readOnly="true" default="jboss.web:type=SipApplicationDispatcher"/>
           	<c:simple-property name="queueSize" type="integer" description="Maximum number of pending messages allowed to wait in a queue to be executed." defaultValue="1500"/>
        </plugin-configuration>
        
        <operation name="setConcurrencyControlModeByName" displayName="Defines the Concurrency Control Mode" description="Sets the concurrency mode, must be one of the following - None, SipSession or SipApplicationSession">
        	<parameters>
        		<c:simple-property name="concurrencyControlMode" defaultValue="SipSession"/>
        	</parameters>
        </operation>
        
        <metric displayName="Number of SIP requests processed" property="requestsProcessed"
             defaultOn="true" defaultInterval="1000" displayType="summary"/>

     	<metric displayName="Number of pending messages in all queues" property="numberOfPendingMessages"
             defaultOn="true" defaultInterval="500" displayType="summary"/>
    </service>
</plugin>

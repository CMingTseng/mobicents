<a4j:region xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:rich="http://richfaces.org/rich" rendered="#{identity.loggedIn}">
	<div class="leftpanel">
	<rich:simpleTogglePanel switchType="client" >
		<f:facet name="header">My Phones</f:facet>
		<a4j:form>
			<rich:dataTable id="registration"
				value="#{dataLoader.loadRegistrations()}" var="registration"
				rows="10"
				>

				<rich:column>
					<f:facet name="header">Phone</f:facet>
					<s:link id="registration"
                         value="#{registration.uri}"
                   		 propagation="none"
                         view="/registration.xhtml">
                        <f:param name="registrationId"
                                value="#{registration.id}"/>
                    </s:link>
                    <a4j:region rendered="#{not empty registration.bindings}"> <span style="color:red"> (#{registration.bindings.size()} bindings)</span></a4j:region>
				</rich:column>
				<rich:column width="20">
					<f:facet name="header">
					Ring
					</f:facet>
					<h:selectBooleanCheckbox id="selectedCb"
						value="#{registration.selected}">
						<a4j:support event="onchange" reRender="registration"
							actionListener="#{registrationAction.select(registration)}"></a4j:support>
					</h:selectBooleanCheckbox>
				</rich:column>
				<rich:column width="20">
					<a4j:commandLink immediate="true" value="" 
						action="#{registrationAction.remove(registration)}" reRender="registration">
						<h:graphicImage value="/img/trash.png" style="border:0"/>
					</a4j:commandLink>
				</rich:column>	
				<f:facet name="footer">
                	<rich:datascroller renderIfSinglePage="false"/>
            	</f:facet>				
			</rich:dataTable>
			<br/>
<h:graphicImage style="float:right" id="regHelp" value="/img/help.png" />
			<h:inputText value="#{registrationAction.registrationUri}" size="15" />

			<rich:spacer width="15"></rich:spacer>
			<a4j:commandLink value="Add phone" id="addPhone"
				action="#{registrationAction.addRegistration()}"
				reRender="registration,messages"> 

			</a4j:commandLink>
			
			<rich:toolTip for="regHelp" layout="block"><div style="width:350px;">You can add SIP URIs and PSTN Phone numbers for your account in this panel. Later you can register against the SIP URIs from SIP phones and the registration bindings will appear in this panel. When initiation calls from this UI only the phones you have selected with <b>Ring</b> will be called.</div></rich:toolTip>
			
				<!--rich:spacer width="15"></rich:spacer><a4j:commandLink value="Refresh" reRender="registration"></a4j:commandLink-->
		</a4j:form>

	</rich:simpleTogglePanel> 		
	<a4j:form>
		<rich:simpleTogglePanel switchType="client" >
			<f:facet name="header">Contacts</f:facet>

			<rich:dataTable id="contacts" value="#{dataLoader.loadContacts()}"
				var="contact" rows="30">

				<rich:column>
					<f:facet name="header">Name</f:facet>
					<s:link id="contact"
                         value="#{contact.uri}"
                   		 propagation="none"
                         view="/contact.xhtml">
                        <f:param name="contactId"
                                value="#{contact.id}"/>
                    </s:link>
				</rich:column>
				<rich:column width="40">
					<f:facet name="header">
					</f:facet>
					<h:commandLink ajaxSingle="true"
						action="#{callAction.call(contact.uri)}">Call</h:commandLink>
				</rich:column>
				<rich:column width="20">
					<a4j:commandLink immediate="true" value="" 
						action="#{contactAction.remove(contact)}" reRender="contacts">
						 <h:graphicImage value="/img/trash.png" style="border:0"/>
					</a4j:commandLink>
				</rich:column>
				<f:facet name="footer">
                	<rich:datascroller renderIfSinglePage="false"/>
            	</f:facet>	
			</rich:dataTable>
			<br /><h:graphicImage id="conHelp" style="float:right" value="/img/help.png" />
			<h:inputText value="#{contactAction.contactUri}" size="15" />
			<rich:spacer width="15"></rich:spacer>
			<a4j:commandLink value="Add contact"
				action="#{contactAction.addContact()}" reRender="contacts,messages">

			</a4j:commandLink>
			
			<rich:toolTip for="conHelp" layout="block"><div style="width:350px;">You can add SIP URIs and PSTN Phone numbers for your account in this panel. Then you can initiate calls by clicking the <b>Call</b> button.</div></rich:toolTip>
			
		</rich:simpleTogglePanel>
	</a4j:form>
	<a4j:form>		
		<rich:simpleTogglePanel switchType="client" id="historyPanel">
			<f:facet name="header">History</f:facet>
			<rich:dataList value="#{dataLoader.loadHistory()}" var="hist"
				rows="5">
				<b><h:outputText value="#{hist.message} " /></b>
				<h:outputText value="(#{hist.timestamp})" />
			</rich:dataList>
		</rich:simpleTogglePanel>
	</a4j:form></div>
</a4j:region>
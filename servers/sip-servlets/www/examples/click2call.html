<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">










<html>
  <head>
    <title>Sip-Servlets - </title>
    <style type="text/css" media="all">
      @import url("../css/maven-base.css");
      @import url("../css/maven-theme.css");
      @import url("../css/site.css");
    </style>
    <link rel="stylesheet" href="../css/print.css" type="text/css" media="print" />
        <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
      </head>
  <body class="composite">
    <!-- TODO: move this into JavaScript to patch the skin
      <div class="xright">  </div>
    -->
    <div id="leftColumn">
      <div id="navcolumn">
             <dl class=navgroup>
        <dd><ul>
              
    <li class="none">
              <a href="../index.html">Introduction</a>
        </li>
              
                
              
      
            
      
              
        <li class="collapsed">
              <a href="../installation.html">Installation</a>
              </li>
              
                
              
      
            
      
            
      
            
      
            
      
            
      
            
            
            
      
              
            <li class="expanded">
              <a href="../examples/examples.html">Examples</a>
                <ul>
                  
    <li class="none">
              <a href="../examples/call_blocking.html">Call Blocking</a>
        </li>
                  
    <li class="none">
              <a href="../examples/call_forwarding.html">Call Forwarding</a>
        </li>
                  
    <li class="none">
              <a href="../examples/call_controller.html">Call Controller</a>
        </li>
                  
    <li class="none">
              <a href="../examples/speed_dial.html">Speed Dial</a>
        </li>
                  
    <li class="none">
              <a href="../examples/location_service.html">Location Service</a>
        </li>
                  
    <li class="none">
              <a href="../examples/speeddial_locationservice.html">Speed Dial/Location Service</a>
        </li>
                  
    <li class="none">
              <strong>Click to Call</strong>
        </li>
                  
    <li class="none">
              <a href="../examples/chatserver.html">Chat Server</a>
        </li>
              </ul>
        </li>
              
    <li class="none">
              <a href="../roadmap.html">Roadmap</a>
        </li>
              
    <li class="none">
              <a href="../servlets/ProjectMailingListList">Mailing lists</a>
        </li>
              
    <li class="none">
              <a href="../source/browse/sip-servlets/">Source code</a>
        </li>
              
    <li class="none">
              <a href="../servlets/ProjectIssues">Issues</a>
        </li>
          </ul></dd>
    </dl>
      <dl class=navgroup>
        <dt>Project Documentation</dt>
        <dd><ul>
              
                
              
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
              
        <li class="collapsed">
              <a href="../project-info.html">Project Information</a>
              </li>
          </ul></dd>
    </dl>
        </div>
      <script>
        // replace the java.net project tools with the navigation bar from Maven.
        // also get rid of "Get Involved" thingie too, while we are at it
        var pt = document.getElementById("projecttools");
        var nv = document.getElementById("navcolumn");
        
        while(pt.previousSibling!=null)
          pt.parentNode.removeChild(pt.previousSibling);
        
        pt.parentNode.insertBefore(nv,pt);
        pt.parentNode.removeChild(pt);
      </script>
      <script>
        // kill "description" h3 bar
        var ld = document.getElementById("longdescription");
        if(ld!=null) {
          for( n=ld.firstChild; n!=null; n=n.nextSibling ) {
            if(n.nodeType==1 && n.innerHTML=="Description" ) {
              n.parentNode.removeChild(n);
              break;
            }
          }
        }
      </script>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <p><b>Important Note :</b>
 <i>This example is a modified version of the click to dial example from the <a href="https://sailfin.dev.java.net/" class="externalLink">sailfin project</a>
 and is originally available at <a href="http://wiki.glassfish.java.net/Wiki.jsp?page=SipClickToDialExample2" class="externalLink">http://wiki.glassfish.java.net/Wiki.jsp?page=SipClickToDialExample2</a>
. It is has been modified to fit the new JSR 289 application selection process and slimmed down to its minimum. The purpose here is to demonstrate interoperability between containers and show backward compatibility with JSR 116.</i>
</p>
<div class="section"><h2>Click To Call</h2>
<div class="section"><h3>Service Description</h3>
<p>This simple example shows how SIP Servlets can be used along with HTTP servlets as a converged application to place calls from a web page. This example consists of the following steps:</p>
<ol type="1"><li>Alice and Bob each register a SIP Softphone</li>
<li>Alice clicks on the &quot;Call&quot; link to place a call to Bob</li>
<li>Alice's phone rings</li>
<li>When Alice picks up her phone, Bob's phone rings</li>
<li>When Bob answers his phone, the call is connected</li>
<li>When one of them hangs up, the other one is also disconnected </li>
</ol>
</div>
<div class="section"><h3>How to activate it</h3>
<div class="section"><h4>From the binary</h4>
<p>You can find the war file corresponding to this example <a href="http://download.java.net/maven/2/org/mobicents/servlet/sip/example/click-to-call-servlet/1.0-SNAPSHOT/click-to-call-servlet-1.0-SNAPSHOT.war" class="externalLink">here</a>
.<br />
Drop the downloaded war file into your <tt>tomcat_home/webapps</tt>
 directory or <tt>jboss_home/server/default/deploy</tt>
 directory </p>
<p>Get the corresponding <a href="/darfiles/click2call-dar.properties">dar configuration file</a>
.<br />
Drop it in your <tt>tomcat_home/conf/dars</tt>
 directory or <tt>jboss_home/server/default/conf/dars</tt>
 directory.<br />
To use this dar file for this service, specify in the Service xml tag, darConfigurationFileLocation attribute of the <tt>tomcat_home/conf/server.xml</tt>
 file or <tt>jboss_home/server/default/deploy/jboss-web.deployer/server.xml</tt>
, the following :<br />
<tt>conf/dars/click2call-dar.properties</tt>
</p>
<p>You can now run your container (Tomcat or Jboss).</p>
</div>
<div class="section"><h4>From the source</h4>
<p>Please check out the speed dial example located under this <a href="https://sip-servlets.dev.java.net/source/browse/sip-servlets/trunk/sip-servlets-examples/click-to-call" class="externalLink">location</a>
 from the svn repository. Follow the instructions in the README.txt to build and run the example.</p>
<p>The DAR file for this example can be found in the sip servlets impl project under the <a href="https://sip-servlets.dev.java.net/source/browse/sip-servlets/trunk/sip-servlets-impl/docs" class="externalLink">docs directory</a>
 Use this as a DAR file (Service tag/darConfigurationFileLocation attribute in the tomcat's server.xml): file:///E:/workspaces/sip-servlets/sip-servlets-impl/docs/dar-click2dial.properties </p>
</div>
</div>
<div class="section"><h3>How to play with it</h3>
<p>Starts Two sip phones.</p>
<p>Open up a browser to http://localhost:8080/click2call/. If you have no registered SIp clients you will be asked to register at least two.<br />
Configure your SIP clients to use the sip servlets server as a register and proxy. (ip address : 127.0.0.1, port: 5080)<br />
By default it will accept any password, see below for instructions on how to enable security and authentication.&#160; After the registration you will see a table where each cell will initiate a call between the corresponding clients.</p>
<p>You can also navigate to http://localhost:8080/click2call/simplecall.html, which is a simplified version that doesn't require registered clients.<br />
You will see the index page where you can enter two SIP URIs. Enter the URIs of the two SIP phones you just started and click &quot;Submit&quot;.<br />
The SIP phones don't have to be registered.</p>
<p>After you pick up both phones the RTP session starts.</p>
<div class="section"><h4>To enable security in JBoss AS</h4>
<p>To enable security for JBoss Application Server, basically you have to create a security domain suitable for digest authentication and then configure your Sip Servlets application to use this security domain.<br />
Here are the steps to make a simple configuration with static users, passwords and roles:</p>
<ol type="1"><li>In server/default/conf/login-config.xml add a new security policy with hashed passwords, like this:<br />
<tt>&lt;application-policy name = &quot;sip-servlets&quot;</tt>
&gt;<br />
<tt>&lt;authentication</tt>
&gt;<br />
<tt>&lt;login-module code=&quot;org.jboss.security.auth.spi.UsersRolesLoginModule&quot; flag = &quot;required&quot;</tt>
&gt;<br />
<tt>&lt;module-option name=&quot;usersProperties&quot;&gt;props/sip-servlets-users.properties&lt;/module-option</tt>
&gt;<br />
<tt>&lt;module-option name=&quot;rolesProperties&quot;&gt;props/sip-servlets-roles.properties&lt;/module-option</tt>
&gt;<br />
<tt>&lt;module-option name=&quot;hashAlgorithm&quot;&gt;MD5&lt;/module-option</tt>
&gt;<br />
<tt>&lt;module-option name=&quot;hashEncoding&quot;&gt;rfc2617&lt;/module-option</tt>
&gt;<br />
<tt>&lt;module-option name=&quot;hashUserPassword&quot;&gt;false&lt;/module-option</tt>
&gt;<br />
<tt>&lt;module-option name=&quot;hashStorePassword&quot;&gt;true&lt;/module-option</tt>
&gt;<br />
<tt>&lt;module-option name=&quot;passwordIsA1Hash&quot;&gt;true&lt;/module-option</tt>
&gt;<br />
<tt>&lt;module-option name=&quot;storeDigestCallback&quot;&gt;org.jboss.security.auth.spi.RFC2617Digest&lt;/module-option</tt>
&gt;<br />
<tt>&lt;/login-module</tt>
&gt;<br />
<tt>&lt;/authentication</tt>
&gt;<br />
<tt>&lt;/application-policy</tt>
&gt;</li>
<li>In the file props/sip-servlets-users.properties put this:<br />
# A sample users.properties file, this line creates user &quot;admin&quot; with password &quot;admin&quot; for &quot;sip-servlets-realm&quot;<br />
admin=9640e13fedc736bdafa6b9007d965c56<p>The cryptic string here is the A1 value of the digest authentication algorithm and can be generated with the following command:<br />
<tt>java -cp ../server/default/lib/jbosssx.jar org.jboss.security.auth.spi.RFC2617Digest username &quot;My Realm&quot; password</tt>
<br />
<tt>RFC2617 A1 hash: 9b47ec6f03603dd49863e7d58c4c49ea</tt>
</p>
</li>
<li>In the file props/sip-servlets-roles.properties put this:<br />
# A sample roles.properties file for use with some roles<br />
admin=caller,role1,role2,..<p>Each line in this file assigns roles to the users defined in sip-servlets-users.properties</p>
</li>
<li>In jboss-web.xml in your application put this:<br />
<tt>&lt;jboss-web</tt>
&gt;<br />
<tt>&lt;!-- Uncomment the security-domain to enable security. You will need to edit the htmladaptor login configuration to setup the login modules used to authentication users. --</tt>
&gt;<br />
<tt>&lt;security-domain&gt;java:/jaas/sip-servlets&lt;/security-domain</tt>
&gt;<br />
<tt>&lt;/jboss-web</tt>
&gt;</li>
<li>In sip.xml in your application add some security constraint and authentication type, for example:<br />
<tt>&lt;security-constraint</tt>
&gt;<br />
<tt>&lt;display-name&gt;REGISTER Method Security Constraint&lt;/display-name</tt>
&gt;<br />
<tt>&lt;resource-collection</tt>
&gt;<br />
<tt>&lt;resource-name&gt;SimpleSipServlet&lt;/resource-name</tt>
&gt;<br />
<tt>&lt;description&gt;Require authenticated REGSITER requests&lt;/description</tt>
&gt;<br />
<tt>&lt;servlet-name&gt;SimpleSipServlet&lt;/servlet-name</tt>
&gt;<br />
<tt>&lt;sip-method&gt;REGISTER&lt;/sip-method</tt>
&gt;<br />
<tt>&lt;/resource-collection</tt>
&gt;<br />
<tt>&lt;auth-constraint</tt>
&gt;<br />
<tt>&lt;role-name&gt;caller&lt;/role-name</tt>
&gt;<br />
<tt>&lt;/auth-constraint</tt>
&gt;<br />
<tt>&lt;/security-constraint</tt>
&gt;<p><tt>&lt;login-config</tt>
&gt;<br />
<tt>&lt;auth-method&gt;DIGEST&lt;/auth-method</tt>
&gt;<br />
<tt>&lt;realm-name&gt;sip-servlets-realm&lt;/realm-name</tt>
&gt;<br />
<tt>&lt;/login-config</tt>
&gt;</p>
</li>
</ol>
</div>
<div class="section"><h4>To enable security in Tomcat</h4>
<p>You have to specify some security realm for the servlet container or it's parents, and add some contraints to the application. There are the steps: \</p>
<ol type="1"><li>Open <tt>&lt;tomcat_home&gt;/conf/server.xml</tt>
 and uncomment the following line:<br />
<tt>&lt;Realm className=&quot;org.apache.catalina.realm.MemoryRealm&quot; /</tt>
&gt;</li>
<li>Open <tt>&lt;tomcat_home&gt;/conf/tomcat-users.xml</tt>
 and add the following <i>user</i>
 sub-element:<br />
<tt>&lt;user name=&quot;user&quot; password=&quot;password&quot; roles=&quot;caller&quot; /</tt>
&gt;</li>
<li>In sip.xml in your application add some security constraint and authentication type, for example:<br />
<tt>&lt;security-constraint</tt>
&gt;<br />
<tt>&lt;display-name&gt;REGISTER Method Security Constraint&lt;/display-name</tt>
&gt;<br />
<tt>&lt;resource-collection</tt>
&gt;<br />
<tt>&lt;resource-name&gt;SimpleSipServlet&lt;/resource-name</tt>
&gt;<br />
<tt>&lt;description&gt;Require authenticated REGSITER requests&lt;/description</tt>
&gt;<br />
<tt>&lt;servlet-name&gt;SimpleSipServlet&lt;/servlet-name</tt>
&gt;<br />
<tt>&lt;sip-method&gt;REGISTER&lt;/sip-method</tt>
&gt;<br />
<tt>&lt;/resource-collection</tt>
&gt;<br />
<tt>&lt;auth-constraint</tt>
&gt;<br />
<tt>&lt;role-name&gt;caller&lt;/role-name</tt>
&gt;<br />
<tt>&lt;/auth-constraint</tt>
&gt;<br />
<tt>&lt;/security-constraint</tt>
&gt;<p><tt>&lt;login-config</tt>
&gt;<br />
<tt>&lt;auth-method&gt;DIGEST&lt;/auth-method</tt>
&gt;<br />
<tt>&lt;realm-name&gt;sip-servlets-realm&lt;/realm-name</tt>
&gt;<br />
<tt>&lt;/login-config</tt>
&gt;</p>
</li>
</ol>
</div>
</div>
</div>

      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">&#169;  
          2008
    
          
  

  
  
  &nbsp;| Last Published: 02/09/2008
  &nbsp;| Version: 0.2
</div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>

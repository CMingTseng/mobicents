<project basedir="." name="mobicents subprojects ">

	<property name="node" value="all" description="Controls the jboss conrfiguration. Value is typically 'all'" />
	<property name="project.home" value="." />
	<dirname property="project.home.dir" file="${project.home}" />

	<!--  SIPRA, XMPPRA, ASTERISK RA, SIP SERVICS VARS -->
	<property name="sipra" value="./ra/sipra" />
	<property name="sipra-stage" value="${sipra}/stage" />
	<property name="sipra-unit" value="sip-ra.jar" />
	<property name="xmpp" value="./ra/xmppra" />
	<property name="xmpp-stage" value="${xmpp}/stage" />
	<property name="xmpp-unit" value="xmpp-ra.jar" />
	<property name="asteriskra" value="./ra/asteriskra" />
	<property name="sip.services.home" value="thirdparty/sip-services" />
	<property name="dest" value="classes" />
	<property name="build" value="./build" />


	<property environment="system" />
	<property name="jboss.home" value="${system.JBOSS_HOME}" />
	<!-- SLEE MANAGEMENT -->
	<property name="mobicents.home" value="${system.MOBICENTS_HOME}" />
	<import file="${mobicents.home}/tools/mobicents-cli/slee-management.xml" />

	<!--  SOME MORE PATH VARS -->

	<property name="deploy.home" value="${jboss.home}" />

	<property name="deployables" value="./deployable-unit" />

	<property name="mobicents.sar" value="${deploy.home}/server/${node}/${deploydir}/mobicents.sar" />

	<property name="jboss.server.dir" value="${deploy.home}/server" />

	<property name="jboss.home.deploy" value="${deploy.home}/server/${node}/deploy" />

	<property name="jboss.mobicents.deploy.dir" value="${deploy.home}/server/${node}/deploy-mobicents" />

	<property name="jboss.tmp.deploy.dir" value="${deploy.home}/server/${node}/tmp/deploy" />

	<property name="jboss.conf.dir" value="${deploy.home}/server/${node}/conf" />

	<property name="jboss.readme.dir" value="${deploy.home}" />

<property name="libs.home" value="lib" />

	<!--  THIS SHOULD BE MOVED TO COMMON PART -->
	<!--  PATH -->
	<path id="project.class.path">
		<pathelement location="${libs.home}/log4j.jar" />
		<pathelement location="${sipra}/lib/JainSipApi1.2.jar" />
		<pathelement location="${sipra}/lib/JainSipRi1.2.jar" />
		<pathelement location="${sipra}/stage/sip-resource-adaptor.jar" />
		<pathelement location="${sipra}/stage/sip-resource-adaptor-type.jar" />
		<pathelement location="${asteriskra}/lib/asterisk-java.jar" />
		<!-- Slee API jar file -->
		<pathelement location="${libs.home}/slee_1_1.jar" />
		
		
		<pathelement location="${dest}" />
		<pathelement location="${libs.home}/commons-pool-1.2.jar" />
		<pathelement location="${libs.home}/junit.jar" />
		<pathelement location="${libs.home}/log4j.jar" />
		<pathelement location="${libs.home}/commons-collections-3.1.jar" />
		<pathelement location="${libs.home}/commons-collections-testframework-3.1.jar" />
		<pathelement location="${libs.home}/commons-logging.jar" />
		<pathelement location="${libs.home}/concurrent.jar" />
		<pathelement location="${libs.home}/javassist.jar" />
		<!--JBoss Cache -->
		<pathelement location="${jboss.home}/server/all/lib/jboss-aop.jar" />
		<pathelement location="${jboss.home}/server/all/lib/jboss-cache.jar" />
		<pathelement location="${jboss.home}/lib/jboss-common.jar" />
		<pathelement location="${jboss.home}/lib/jboss-jmx.jar" />
		<pathelement location="${jboss.home}/lib/jboss-system.jar" />
		<pathelement location="${jboss.home}/server/all/lib/jboss.jar" />
		<pathelement location="${project.home}/lib/jgroups-all.jar" />
		<!--Java Transacion Api-->
		<pathelement location="${libs.home}/jta.jar" />
		<!--JMX REMOTE CLIENT-->
		<pathelement location="${jboss.home}/server/all/lib/jmx-adaptor-plugin.jar" />
		<pathelement location="${jboss.home}/server/all/lib/jnpserver.jar" />
		<pathelement location="${jboss.home}/server/all/lib/jboss-transaction.jar" />
		

		<!-- JBoss HA for failover -->
		<pathelement location="${jboss.home}/server/all/lib/jbossha.jar" />


		<!-- J2EE jar - only required to compile the ejb-ref test case -->
		<pathelement location="${jboss.home}/server/all/lib/jboss-j2ee.jar" />

		<!-- ANT junit jar file -->
		<pathelement location="${libs.home}/ant-junit.jar" />
		<pathelement location="${libs.home}/sipunit.jar" />

		<!-- Slee 1.1 Resource Adaptor Interfaces -->
		<pathelement location="${libs.home}/sleeRA.zip" />
		<!-- Required by test usage.types.2216 -->
		<pathelement location="${libs.home}/dom4j.jar" />
		
	</path>




	<property name="sipra.home" value="${mobicents.home}/ra/sipra" />
	<property name="sipra.home" value="../slee-sip-ra" />
	<path id="sip-path-TCK">
		<pathelement location="./tests/lib/SipStackBinder.jar" />
		<pathelement location="${sipra.home}/lib/JainSipApi1.2.jar" />
		<pathelement location="${sipra.home}/lib/JainSipRi1.2.jar" />
		<pathelement location="${sipra.home}/stage/sip-resource-adaptor.jar" />
		<pathelement location="${jboss.home}/lib/jboss-common.jar" />
		<pathelement location="${jboss.home}/server/${node}/jnpserver.jar" />
		<pathelement location="${mobicents.home}/lib/concurrent.jar" />
		<!--<pathelement location="${mobicents.home}/ra/sipra/lib/JainSipApi1.2.jar"/>
			<pathelement location="${mobicents.home}/ra/sipra/lib/JainSipRi1.2.jar"/>-->
	</path>



	<target name="init" depends="management-init"></target>

	<target name="sipra" description="Calls default target from ${sipra}/build.xml">
		<subant target="">
			<fileset dir="${sipra}" includes="build.xml" />
		</subant>
	</target>

	<target name="sipraclean">
		<subant target="clean">
			<property name="stage-dir" value="${sipra-stage}" />
			<property name="ra-unit" value="${sipra-unit}" />
			<fileset dir="${sipra}" includes="build.xml" />
		</subant>
		<delete file="${jboss.home}/sipdebug.txt" />
	</target>

	<target name="sipradeploy">
		<subant target="sipradeploy">
			<fileset dir="${sipra}" includes="build.xml" />
		</subant>
	</target>

	<target name="siprabuild">
		<subant target="siprabuild">
			<fileset dir="${sipra}" includes="build.xml" />
			<property name="sipra.target.dir" value="${jboss.mobicents.deploy.dir}" />
		</subant>
	</target>

	<target name="auto-deploy-sip" depends="init,siprabuild, build-sip-proxy-service-jars" description="Copies all SIP components to the server directories. The server will consequently deploy or redeploy them.">
		<copy todir="${jboss.mobicents.deploy.dir}" file="${sip.services.home}/examples/proxyservice.jar" />
		<copy todir="${jboss.mobicents.deploy.dir}/scripts" file="${sip.services.home}/sip-deploy.bsh" />
	</target>

	<!--  SIP SERVICES? -->
	<target name="build-pinger-jars">
		<mkdir dir="${build}" />
		<javac classpathref="project.class.path" debug="true" deprecation="true" destdir="${dest}" nowarn="false" target="1.4" source="1.4">
			<src path="${sip.services.home}/src" />
		</javac>
		<jar destfile="${build}/pinger.jar">
			<metainf file="${sip.services.home}/src/util/pinger/META-INF/sbb-jar.xml" />
			<fileset dir="${dest}">
				<include name="util/**/*.class" />
			</fileset>
		</jar>
		<jar destfile="${build}/event.jar">
			<metainf file="${sip.services.home}/src/util/pinger/META-INF/event-jar.xml" />
			<fileset dir="${dest}">
				<include name="util/Ping.class" />
			</fileset>
		</jar>
		<copy todir="${build}" file="${sip.services.home}/src/util/pinger/service.xml" />
		<jar destfile="${build}/pingerdu.jar">
			<metainf file="${sip.services.home}/src/util/pinger/META-INF/deployable-unit.xml" />
			<fileset dir="${build}">
				<include name="**/*.*" />
			</fileset>
		</jar>
		<move todir="${sip.services.home}/examples" file="${build}/pingerdu.jar" />
		<delete failonerror="false" includeemptydirs="true">
			<fileset dir="${build}" />
			<fileset dir="${dest}">
				<include name="util/pinger/**" />
			</fileset>
		</delete>
	</target>


	<target name="build-sip-proxy-service-jars">
		<!-- Build the jar file for enventrytest.jar and copy over -->
		<property name="build.sip.dir" value="${build}/sip"></property>
		<mkdir dir="${build.sip.dir}" />
		<javac classpathref="project.class.path" debug="true" deprecation="true" destdir="${dest}" nowarn="false" target="1.4" source="1.4">
			<src path="${sip.services.home}/src" />
		</javac>

		<jar destfile="${build.sip.dir}/registrarsbb.jar">
			<metainf file="${sip.services.home}/src/org/mobicents/slee/services/sip/registrar/META-INF/sbb-jar.xml" />
			<fileset dir="${dest}">
				<include name="org/mobicents/slee/services/sip/registrar/**/*.class" />
			</fileset>
		</jar>
		<jar destfile="${build.sip.dir}/proxysbb.jar">
			<metainf file="${sip.services.home}/src/org/mobicents/slee/services/sip/proxy/META-INF/sbb-jar.xml" />
			<fileset dir="${dest}">
				<include name="org/mobicents/slee/services/sip/proxy/**/*.class" />
				<include name="org/mobicents/slee/services/sip/common/**/*.class" />
				<include name="util/**/*.class" />
			</fileset>
		</jar>
		<copy todir="${build.sip.dir}" file="${sip.services.home}/src/org/mobicents/slee/services/sip/proxy/service.xml" />
		<jar destfile="${build.sip.dir}/proxyservice.jar">
			<metainf file="${sip.services.home}/src/org/mobicents/slee/services/sip/proxy/META-INF/deployable-unit.xml" />
			<fileset dir="${build.sip.dir}">
				<include name="proxysbb.jar" />
				<include name="registrarsbb.jar" />
				<include name="service.xml" />
			</fileset>
		</jar>
		<move todir="${sip.services.home}/examples" file="${build.sip.dir}/proxyservice.jar" />
		<delete failonerror="false" includeemptydirs="true">
			<fileset dir="${build.sip.dir}" />
			<fileset dir="${dest}">
				<include name="org/mobicents/slee/services/sip/**" />
			</fileset>
		</delete>
	</target>


	<target name="proxy-service-deploy" depends="build-sip-proxy-service-jars,management-init" description="Deploys the SIP Proxy Service">
		<path id="proxyservice">
			<pathelement location="./thirdparty/sip-services/examples/proxyservice.jar" />
		</path>
		<pathconvert targetos="unix" property="proxyservice" refid="proxyservice" />
		<slee-management jnpport="${jnpPort}">
			<install url="${file_url}${proxyservice}" />
		</slee-management>
		<echo>Proxy Service deployed</echo>
		<!-- Activate the proxy service -->
		<slee-management jnpport="${jnpPort}">
			<activateservice serviceid="JAIN SIP Proxy Service#NIST#1.0" />
		</slee-management>
		<echo>proxy service activated</echo>
	</target>


	<target name="asteriskra" description="Calls default target from ${asteriskra}/build.xml">
		<subant target="">
			<fileset dir="${asteriskra}" includes="build.xml" />
		</subant>
	</target>

	<target name="xmppra" description="Calls default target from ${xmpp}/build.xml">
		<subant target="">
			<fileset dir="${xmpp}" includes="build.xml" />
		</subant>
	</target>
	<target name="xmppclean">
		<subant target="clean-ra">
			<fileset dir="${xmpp}" includes="build.xml" />
		</subant>
	</target>
	<target name="xmppbuild">
		<subant target="build-ra">
			<fileset dir="${xmpp}" includes="build.xml" />
		</subant>
	</target>
	<target name="xmppdeploy">
		<subant target="deploy-ra">
			<fileset dir="${xmpp}" includes="build.xml" />
		</subant>
	</target>
	<target name="xmppundeploy">
		<subant target="undeploy-ra">
			<fileset dir="${xmpp}" includes="build.xml" />
		</subant>
	</target>




	<!--  XMPP RA -DEPLOYS  -->
	<target name="auto-deploy-xmpp" depends="init,xmppbuild" description="Copies all XMPP components to the server directories. The server will consequently deploy or redeploy them.">
		<copy todir="${jboss.mobicents.deploy.dir}/scripts" file="${xmpp}/bin/xmpp-deploy.bsh" />
	</target>
	<!-- XMPP RA END-->



	<target name="asteriskraclean">
		<subant target="clean">
			<fileset dir="${asteriskra}" includes="build.xml" />
		</subant>
	</target>


	<target name="asteriskradeploy" depends="asteriskra" description="Deploys the Asterisk RA to JBOSS">

		<echo>${asteriskra}/bin/DeployAsteriskRA.bat</echo>
		<exec dir="${mobicents.home}\${asteriskra}\bin" spawn="false" vmlauncher="true" os="Windows XP, Windows_NT, Windows 2000" executable="${mobicents.home}\${asteriskra}\bin\DeployAsteriskRA.bat"></exec>

		<exec dir="${mobicents.home}/${asteriskra}/bin" spawn="false" os="Solaris, SunOS" executable="${mobicents.home}/${asteriskra}/bin/DeployAsteriskRA.sh"></exec>
	</target>





</project>

<?xml version="1.0" encoding="UTF-8"?>

<project name="Project Resource Adaptor Framework Sbb --- 1.0" default="deploy"> 
<!-- Michael Maretzke, 2005-08-11, Version 1.0 -->	  

	<!-- General settings -->
	<property name="prj.version" value="1.0" />
	<property name="prj.name" value="bouncesbb" />
	<!-- Directories -->
	<property name="dir.root" value="./" />
	<property name="dir.lib" value="${dir.root}/lib" />
	<property name="dir.desc" value="${dir.root}/descriptors" />
	<property name="dir.desc.sbb" value="${dir.desc}/sbb" />
	<property name="dir.desc.service" value="${dir.desc}/service" />
	<property name="dir.desc.unit" value="${dir.desc}/unit" />	
	<property name="dir.classes" value="${dir.root}/build" />
	<property name="dir.dist" value="${dir.root}/dist" />	
	<property name="dir.src" value="${dir.root}/src" />
	<property name="dir.stage" value="${dir.root}/stage" />
	<property name="dir.stage.sbb" value="${dir.stage}/${prj.name}" />
	<!-- JAR files -->
	<property name="jar.sbb" value="${prj.name}-sbb.jar" />
	<property name="jar.service" value="${prj.name}-service.jar" />

  <!-- the compiletime classpath -->
  <path id="path.compile">
		<fileset dir="${dir.lib}">
			<include name="*.jar" />
		</fileset>
  </path>
  
	<target name="clean">
		<delete dir="${dir.classes}/" />
		<delete dir="${dir.dist}" />
		<delete dir="${dir.stage}" />		
	</target>
	
	<target name="init"> 
		<mkdir dir="${dir.classes}" />
		<mkdir dir="${dir.dist}" />
		<mkdir dir="${dir.stage}" />		
	</target>
	
	<target name="deploy" depends="package-service" />
	
	<target name="compile" depends="init"> 	  
		<javac srcdir="${dir.src}" destdir="${dir.classes}" debug="on">
			<classpath>
			  <path refid="path.compile" />
			</classpath>
		</javac>		
	</target>	
	
		<target name="package-sbb" depends="compile">
		<copy file="${dir.desc.sbb}/sbb-jar.xml" todir="${dir.stage.sbb}/META-INF" />
		<copy todir="${dir.stage.sbb}">
			<fileset dir="${dir.classes}" />
		</copy>
		<jar destfile="${dir.stage}/${jar.sbb}">
			<fileset dir="${dir.stage.sbb}" />
		</jar>
		<delete dir="${dir.stage.sbb}" />
	</target>

	<target name="package-service" depends="package-sbb">
		<copy file="${dir.desc.unit}/deployable-unit.xml" todir="${dir.stage}/META-INF" />
		<copy file="${dir.desc.service}/service.xml" todir="${dir.stage}" />		
		<jar destfile="${dir.dist}/${jar.service}">
			<fileset dir="${dir.stage}" />
		</jar>
		<delete dir="${dir.stage}" />
	</target>
	
	
	<target name="rebuild" depends="clean, deploy" />
	
	<target name="package-events" depends="compile">
		<copy file="${dir.desc.ratype}/event-jar.xml" todir="${dir.stage.events}/META-INF" />
		<jar destfile="${dir.stage}/${jar.events}">
			<fileset dir="${dir.stage.events}" />
		</jar>
<!-- <delete dir="${dir.stage.events}" /> -->
	</target>

	<target name="package-ratype" depends="compile">
		<copy file="${dir.desc.ratype}/resource-adaptor-type-jar.xml" todir="${dir.stage.ratype}/META-INF" />
		<copy todir="${dir.stage.ratype}">
			<fileset dir="${dir.classes}">
				<patternset refid="src.ratype"/>				
			</fileset>
		</copy>
		<jar destfile="${dir.stage}/${jar.ratype}">
			<fileset dir="${dir.stage.ratype}" />
		</jar>
<!--		<delete dir="${dir.stage.ratype}" /> -->
	</target>

	<target name="package-ra" depends="compile">
		<copy file="${dir.desc.ra}/resource-adaptor-jar.xml" todir="${dir.stage.ra}/META-INF" />
		<copy todir="${dir.stage.ra}">
			<fileset dir="${dir.classes}" />
		</copy>
		<jar destfile="${dir.stage}/${jar.ra}">
			<fileset dir="${dir.stage.ra}"/>
		</jar>
<!-- <delete dir="${dir.stage.ra}" /> -->
	</target>

	<target name="package-unit-type" depends="package-ratype, package-events">
		<copy file="${dir.desc.ratype}/deployable-unit.xml" todir="${dir.stage.ratype-unit}/META-INF" />
		<copy todir="${dir.stage.ratype-unit}">
			<fileset dir="${dir.stage}">
				<include name="${jar.events}" />
				<include name="${jar.ratype}" />
			</fileset>
		</copy>
		<jar destfile="${dir.stage}/${jar.ratype-unit}">
			<fileset dir="${dir.stage.ratype-unit}" />
		</jar>
<!--		<delete dir="${stage-ratype-unit}" /> -->
	</target>

	<target name="package-unit-ra" depends="package-ra">
		<copy file="${dir.desc.ra}/deployable-unit.xml" todir="${dir.stage.ra-unit}/META-INF" />
		<copy todir="${dir.stage.ra-unit}">
			<fileset dir="${dir.stage}">
				<include name="${jar.ra}" />
			</fileset>
		</copy>
		<jar destfile="${dir.stage}/${jar.ra-unit}">
			<fileset dir="${dir.stage.ra-unit}" />
		</jar>
<!-- 	<delete dir="${dir.stage.ra-unit}" /> -->
	</target>

</project>

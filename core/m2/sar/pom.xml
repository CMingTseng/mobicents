<project xmlns="http://maven.apache.org/POM/4.0.0"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">

	<modelVersion>4.0.0</modelVersion>

	<parent>
		<groupId>org.mobicents</groupId>
		<artifactId>mobicents-parent</artifactId>
		<version>1.2.0-beta-2-SNAPSHOT</version>
	</parent>

	<artifactId>mobicents-sar</artifactId>
	<packaging>jboss-sar</packaging>
	<name>Mobicents :: sar</name>
	<url>http://mobicents.dev.java.net</url>

	<dependencies>
		<dependency>
			<groupId>org.mobicents</groupId>
			<artifactId>mobicents</artifactId>
			<version>${parent.version}</version>
			<scope>compile</scope>
		</dependency>
		<dependency>
			<groupId>jgroups</groupId>
			<artifactId>jgroups</artifactId>
			<version>${jgroups.version}</version>
			<scope>runtime</scope>
		</dependency>
	</dependencies>

	<build>

		<resources>
			<resource>
				<directory>../../xml/sar</directory>
				<filtering>true</filtering>
				<includes>
					<include>jboss-treecache*.xml</include>
				</includes>
			</resource>
			<resource>
				<directory>../../dtd/</directory>
				<targetPath>dtd</targetPath>
			</resource>
			<resource>
				<directory>../../xml/sar/xml</directory>
				<targetPath>xml</targetPath>
				<includes>
					<include>*.xml</include>
				</includes>
			</resource>
		</resources>

		<plugins>
			<plugin>
				<groupId>org.codehaus.mojo</groupId>
				<artifactId>jboss-packaging-maven-plugin</artifactId>
				<version>2.0-SNAPSHOT</version>
				<extensions>true</extensions>
				<configuration>
					<deploymentDescriptorFile>
						../../xml/sar/META-INF/jboss-service.xml
					</deploymentDescriptorFile>
					<libDirectory>
						${project.build.directory}/mobicents.sar/lib
					</libDirectory>
					<packagingDirectory>
						${project.build.directory}/mobicents.sar
					</packagingDirectory>
					<excludes>
						<exclude>concurrent:concurrent</exclude>
						<exclude>
							commons-collections:commons-collections
						</exclude>
						<exclude>
							commons-logging:commons-logging
						</exclude>
						<exclude>jboss:jboss</exclude>
						<exclude>jboss:jboss-common</exclude>
						<exclude>jboss:jboss-j2se</exclude>
						<exclude>jboss:jboss-minimal</exclude>
						<exclude>jboss:jboss-system</exclude>
						<exclude>jboss:jbossall-client</exclude>
						<exclude>jboss:jbossall</exclude>
						<exclude>jboss:jbossha</exclude>
						<exclude>jboss:jmx-adaptor-plugin</exclude>
						<exclude>javax.transaction:jta</exclude>
						<exclude>junit:junit</exclude>
						<exclude>log4j:log4j</exclude>
						<exclude>javax.servlet:servlet-api</exclude>
						<exclude>jdom:jdom</exclude>
						<exclude>jgroups:jgroups-all</exclude>
						<exclude>xerces:xerces</exclude>
						<exclude>xerces:xercesImpl</exclude>
						<exclude>xml-apis:xml-apis</exclude>
						<exclude>slide:webdavlib</exclude>
					</excludes>
				</configuration>
			</plugin>

			<plugin>
				<artifactId>maven-antrun-plugin</artifactId>
				<executions>
					<execution>
						<id>copy-sar-resources</id>
						<phase>install</phase>
						<goals>
							<goal>run</goal>
						</goals>
						<configuration>
							<tasks>
								<mkdir
									dir="${jboss.deploy}/deploy-mobicents/" />
								<mkdir
									dir="${jboss.deploy}/deploy-mobicents/scripts" />

								<echo
									message="=============== Copy Mobicents.rar ==================" />

								<copy
									file="../rar/target/mobicents-rar-${parent.version}.rar"
									tofile="${project.build.directory}/mobicents.sar/mobicents.rar" />

								<echo
									message="=============== Copy ejb3-proxy ==================" />
								<copy
									file="../ejb3-proxy/target/ejb3-proxy-${parent.version}.jar"
									tofile="${project.build.directory}/mobicents.sar/SleeConnectionProxy.ejb3" />

								<copy
									file="../../log4-rs/dist/log4j-rs.sar"
									todir="${jboss.deploy}/deploy" />

								<copy file="../../README.txt"
									todir="${jboss.readme.dir}" />
								<copy
									file="../../bin/SleeCommandInterface.bat"
									todir="${jboss.bin.dir}" />
								<copy
									file="../../bin/SleeCommandInterface.sh"
									todir="${jboss.bin.dir}" />
								<chmod
									file="${jboss.bin.dir}/SleeCommandInterface.sh"
									perm="755" />

								<copy file="../../bin/java.policy"
									todir="${jboss.bin.dir}" />
								<copy
									file="../../docs/pictures/mobicents-logo.gif"
									tofile="${jboss.deploy}/jmx-console.war/images/logo.gif" />

								<copy todir="${jboss.licenses.dir}">
									<fileset file="../../LICENSES/*" />
								</copy>

								<copy overwrite="true"
									todir="${jboss.bin.dir}">
									<fileset dir="../../bin">
										<filename name="run.*" />
									</fileset>
								</copy>

								<copy todir="${jboss.home.deploy}">
									<fileset dir="target">
										<include
											name="mobicents.sar/**" />
										<exclude
											name="**/jboss-service.xml" />
									</fileset>
								</copy>

								<copy
									todir="${jboss.home.deploy}/mobicents.sar/META-INF"
									flatten="yes">
									<filterset>
										<filtersfile
											file="../../build/etc/single.properties" />
									</filterset>
									<fileset
										dir="${project.build.directory}/mobicents.sar/META-INF/">
										<include
											name="jboss-service.xml" />
									</fileset>
								</copy>

								<copy
									todir="${jboss.home.deploy}/mobicents.sar/" flatten="yes">
									<filterset>
										<filtersfile
											file="../../build/etc/single.properties" />
									</filterset>
									<fileset
										dir="../../src/main/java/org/mobicents/slee/test/connector/ejb/">
										<include name="slee-ds.xml" />
									</fileset>
								</copy>

								<echo>
									Touching
									${jboss.deploy}/deploy/mobicents.sar/META-INF/jboss-service.xml
									to cause redeploy
								</echo>

								<touch>
									<fileset
										file="${jboss.home.deploy}/mobicents.sar/META-INF/jboss-service.xml" />
								</touch>

								<echo
									message="=============== TODO connector-test-ejb.jar ==================" />
								<echo
									message="=============== TODO ejbref-test-ejb ==================" />


							</tasks>
						</configuration>
					</execution>
					<execution>
						<id>clean-sar-resources</id>
						<phase>clean</phase>
						<goals>
							<goal>run</goal>
						</goals>
						<configuration>
							<tasks>

								<delete file="mobicents.sar" />
								<delete failonerror="false"
									includeemptydirs="true">
									<fileset dir="${jboss.home.deploy}/mobicents.sar" />
								</delete>
								<delete failonerror="false"
									includeemptydirs="true">
									<fileset
										file="${jboss.home}/server/${node}/deploy/connector-test-ejb.jar" />
									<fileset
										file="${jboss.home}/server/${node}/deploy/ejbref-test-ejb.jar" />
								</delete>
								<delete failonerror="false"
									includeemptydirs="true">
									<fileset
										dir="${jboss.tmp.deploy.dir}">
										<include name="tmpDUJars**/*.*" />
										<include name="tmpDUJars*" />
									</fileset>
								</delete>
								<delete failonerror="false"
									includeemptydirs="true">
									<fileset
										dir="${jboss.tmp.deploy.dir}">
										<include name="slee-ds.xml" />
										<include name="mobicents.rar" />
									</fileset>
									<fileset dir="${jboss.deploy}">
										<include name="slee-ds.xml" />
										<include name="mobicents.rar" />
									</fileset>
								</delete>
							</tasks>
						</configuration>
					</execution>
				</executions>
			</plugin>
		</plugins>
	</build>

</project>

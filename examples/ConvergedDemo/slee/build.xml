<?xml version="1.0" encoding="utf-8"?>
<project name="ConvergedDemo" default="deploy">

	<property environment="system" />
	<!--property name="examples.home" value="${system.MOBICENTS_EXAMPLES}" /-->

	<path id="duPath">
		<pathelement location="./jars/ConvergedDemo-DU.jar" />
	</path>

	<property name="duPathValue" refid="duPath" />
	<property name="serviceID1" value="Seam DVD Example User SBB Service#org.mobicents#1.0" />
	<property name="serviceID2" value="Seam DVD Example Admin SBB Service#org.mobicents#1.0" />
	<property name="serviceID3" value="Mobicents Furniture Store Example Order Date SBB Service#org.mobicents#1.0" />
	<property name="serviceID4" value="Mobicents Furniture Store Example Order Ship SBB Service#org.mobicents#1.0" />

	<!-- MOBICENTS MCLI[ in fact this is slee-management.xml but name has been changed for convenience] -->
	<import file="../../lib/build.xml" />
	<echo>EXAMPLES HOME[${examples.home}]</echo>
	<!--import file="${examples.home}/lib/build.xml" /-->



	<target name="init" depends="management-init,lib-init">
		<fail>
			JBOSS_HOME environment variable is not set. It should be set to something like C:\tools\jboss-4.2.0.GA on Windows or /var/jboss-4.2.0.GA on linux/unix.
			<condition>
				<not>
					<isset property="system.JBOSS_HOME" />
				</not>
			</condition>
		</fail>

		<path id="slee">
			<pathelement location="${examples.home}/lib/slee_1_1.jar" />
		</path>

		<path id="ExternalComponents" refid="examples-libraries">
		</path>

		<path id="ejb3">
			<pathelement location="${jboss.home}/server/${node}/lib/ejb3-persistence.jar" />
			<pathelement location="${jboss.home}/server/${node}/lib/hibernate3.jar" />
			<pathelement location="${jboss.home}/server/${node}/lib/hibernate-annotations.jar" />
			<pathelement location="${jboss.home}/server/${node}/lib/hibernate-entitymanager.jar" />
		</path>

	</target>

	<target name="clean" depends="init">
		<ant target="clean-UserSbb-sbb" />
		<ant target="clean-OrderDeliverDateSbb-sbb" />
		<ant target="clean-OrderShipDateSbb-sbb" />
		<ant target="clean-AdminSbb-sbb" />
		<ant target="clean-CallControlSbb-sbb" />
		<ant target="clean-Custom-event" />
		<ant target="clean-pojo" />
		<ant target="clean-utility-jar" />
		<ant target="clean-ConvergedDemo-DU" />
	</target>

	<target name="build-utility-jar" depends="init">
		<mkdir dir="classes/utility" />
		<mkdir dir="library/" />
		<javac destdir="classes/utility" srcdir="src" includes="org/mobicents/slee/util/*.java,org/mobicents/slee/service/common/*.java"  debug="on">
			<classpath>				
				<path refid="ExternalComponents" />
			</classpath>
		</javac>

		<jar jarfile="library/utility.jar">
			<fileset dir="classes/utility" includes="org/mobicents/slee/util/*.class,org/mobicents/slee/service/common/*.class" />
		</jar>
	</target>

	<target name="clean-utility-jar">
		<delete file="library/utility.jar" />
		<delete dir="classes/utility" />
	</target>

	<target name="build-pojo" depends="init">
		<mkdir dir="classes/pojo" />
		<mkdir dir="library/" />
		<javac destdir="classes/pojo" srcdir="src" includes="org/mobicents/seam/*.java"  debug="on">
			<classpath>				
				<path refid="ExternalComponents" />
				<path refid="ejb3" />
			</classpath>
		</javac>
		<copy file="src/org/mobicents/seam/persistence.xml" tofile="classes/pojo/persistence.xml" />

		<jar jarfile="library/pojo.jar">
			<metainf dir="classes/pojo" includes="persistence.xml" />
			<fileset dir="classes/pojo" includes="org/mobicents/seam/*.class" />
		</jar>
	</target>

	<target name="clean-pojo">
		<delete file="library/pojo.jar" />
		<delete dir="classes/pojo" />
	</target>

	<target name="build-UserSbb-sbb" depends="init">
		<mkdir dir="classes/UserSbb-sbb" />
		<mkdir dir="jars/" />
		<javac destdir="classes/UserSbb-sbb" srcdir="src" includes="org/mobicents/slee/service/user/*.java"  debug="on">
			<classpath>	
				<path refid="ejb3" />			
				<path refid="slee" />
				<path refid="ExternalComponents" />
			</classpath>
		</javac>
	
		<copy todir="classes/UserSbb-sbb">
			<filterset>
				<filtersfile file="../convergeddemo.properties"/>			
			</filterset>
       			<fileset dir="src/org/mobicents/slee/service/user">
	   			<include name="sbb-jar.xml" />
   	   		</fileset>
		</copy>

		<!-- copy file="src/org/mobicents/slee/service/user/UserSbb-sbb-jar.xml" tofile="classes/UserSbb-sbb/sbb-jar.xml" / -->

		<jar jarfile="jars/UserSbb-sbb.jar">
			<metainf dir="classes/UserSbb-sbb" includes="sbb-jar.xml" />
			<fileset dir="classes/UserSbb-sbb" includes="org/mobicents/slee/service/user/*.class" />
		</jar>
	</target>

	<target name="clean-UserSbb-sbb">
		<delete file="jars/UserSbb-sbb.jar" />
		<delete dir="classes/UserSbb-sbb" />
	</target>

	<target name="build-OrderDeliverDateSbb-sbb" depends="init">
		<mkdir dir="classes/OrderDeliverDateSbb-sbb" />
		<mkdir dir="jars/" />
		<javac destdir="classes/OrderDeliverDateSbb-sbb" srcdir="src" includes="org/mobicents/slee/service/user/delivery/*.java"  debug="on">
			<classpath>	
				<path refid="ejb3" />			
				<path refid="slee" />
				<path refid="ExternalComponents" />
			</classpath>
		</javac>

		<copy todir="classes/OrderDeliverDateSbb-sbb">
			<filterset>
				<filtersfile file="../convergeddemo.properties"/>			
			</filterset>
       			<fileset dir="src/org/mobicents/slee/service/user/delivery">
	   			<include name="sbb-jar.xml" />
   	   		</fileset>
		</copy>

		<!-- copy file="src/org/mobicents/slee/service/user/delivery/OrderDeliverDateSbb-sbb-jar.xml" tofile="classes/OrderDeliverDateSbb-sbb/sbb-jar.xml" / -->

		<jar jarfile="jars/OrderDeliverDateSbb-sbb.jar">
			<metainf dir="classes/OrderDeliverDateSbb-sbb" includes="sbb-jar.xml" />
			<fileset dir="classes/OrderDeliverDateSbb-sbb" includes="org/mobicents/slee/service/user/delivery/*.class" />
		</jar>
	</target>

	<target name="clean-OrderDeliverDateSbb-sbb">
		<delete file="jars/OrderDeliverDateSbb-sbb.jar" />
		<delete dir="classes/OrderDeliverDateSbb-sbb" />
	</target>	
	
	<target name="build-OrderShipDateSbb-sbb" depends="init">
		<mkdir dir="classes/OrderShipDateSbb-sbb" />
		<mkdir dir="jars/" />
		<javac destdir="classes/OrderShipDateSbb-sbb" srcdir="src" includes="org/mobicents/slee/service/user/ship/*.java"  debug="on">
			<classpath>	
				<path refid="ejb3" />			
				<path refid="slee" />
				<path refid="ExternalComponents" />
			</classpath>
		</javac>

		<copy todir="classes/OrderShipDateSbb-sbb">
			<filterset>
				<filtersfile file="../convergeddemo.properties"/>			
			</filterset>
       			<fileset dir="src/org/mobicents/slee/service/user/ship">
	   			<include name="sbb-jar.xml" />
   	   		</fileset>
		</copy>

		<!-- copy file="src/org/mobicents/slee/service/user/ship/OrderShipDateSbb-sbb-jar.xml" tofile="classes/OrderShipDateSbb-sbb/sbb-jar.xml" / -->

		<jar jarfile="jars/OrderShipDateSbb-sbb.jar">
			<metainf dir="classes/OrderShipDateSbb-sbb" includes="sbb-jar.xml" />
			<fileset dir="classes/OrderShipDateSbb-sbb" includes="org/mobicents/slee/service/user/ship/*.class" />
		</jar>
	</target>

	<target name="clean-OrderShipDateSbb-sbb">
		<delete file="jars/OrderShipDateSbb-sbb.jar" />
		<delete dir="classes/OrderShipDateSbb-sbb" />
	</target>

	<target name="clean-CallControlSbb-sbb">
		<delete file="jars/CallControlSbb-sbb.jar" />
		<delete dir="classes/CallControlSbb-sbb" />
	</target>

	<target name="build-CallControlSbb-sbb" depends="init">
		<mkdir dir="classes/CallControlSbb-sbb" />
		<mkdir dir="jars/" />
		<javac destdir="classes/CallControlSbb-sbb" srcdir="src" includes="org/mobicents/slee/service/callcontrol/*.java"  debug="on">
			<classpath>				
				<path refid="slee" />
				<path refid="ExternalComponents" />
			</classpath>
		</javac>

		<copy todir="classes/CallControlSbb-sbb">
			<filterset>
				<filtersfile file="../convergeddemo.properties"/>			
			</filterset>
       			<fileset dir="src/org/mobicents/slee/service/callcontrol">
	   			<include name="sbb-jar.xml" />
   	   		</fileset>
		</copy>

		<!-- copy file="src/org/mobicents/slee/service/callcontrol/CallControlSbb-sbb-jar.xml" tofile="classes/CallControlSbb-sbb/sbb-jar.xml" / -->

		<jar jarfile="jars/CallControlSbb-sbb.jar">
			<metainf dir="classes/CallControlSbb-sbb" includes="sbb-jar.xml" />
			<fileset dir="classes/CallControlSbb-sbb" includes="org/mobicents/slee/service/callcontrol/*.class" />
		</jar>
	</target>

	<target name="build-AdminSbb-sbb" depends="init">
		<mkdir dir="classes/AdminSbb-sbb" />
		<mkdir dir="jars/" />
		<javac destdir="classes/AdminSbb-sbb" srcdir="src" includes="org/mobicents/slee/service/admin/*.java"  debug="on">
			<classpath>
				<path refid="ejb3" />	
				<path refid="slee" />
				<path refid="ExternalComponents" />
			</classpath>
		</javac>

		<copy todir="classes/AdminSbb-sbb">
			<filterset>
				<filtersfile file="../convergeddemo.properties"/>			
			</filterset>
       			<fileset dir="src/org/mobicents/slee/service/admin">
	   			<include name="sbb-jar.xml" />
   	   		</fileset>
		</copy>

		<!-- copy file="src/org/mobicents/slee/service/admin/AdminSbb-sbb-jar.xml" tofile="classes/AdminSbb-sbb/sbb-jar.xml" / -->

		<jar jarfile="jars/AdminSbb-sbb.jar">
			<metainf dir="classes/AdminSbb-sbb" includes="sbb-jar.xml" />
			<fileset dir="classes/AdminSbb-sbb" includes="org/mobicents/slee/service/admin/*.class" />
		</jar>
	</target>

	<target name="clean-AdminSbb-sbb">
		<delete file="jars/AdminSbb-sbb.jar" />
		<delete dir="classes/AdminSbb-sbb" />
	</target>

	<target name="build-Custom-event" depends="init">
		<mkdir dir="classes/Custom-event" />
		<mkdir dir="jars/" />
		<javac destdir="classes/Custom-event" srcdir="src" includes="org/mobicents/slee/service/events/*.java"  debug="on">
			<classpath>
				<path refid="slee" />
				<path refid="ExternalComponents" />
			</classpath>
		</javac>
		<copy file="src/org/mobicents/slee/service/events/Custom-event-jar.xml" tofile="classes/Custom-event/event-jar.xml" />

		<jar jarfile="jars/Custom-event.jar">
			<metainf dir="classes/Custom-event" includes="event-jar.xml" />
			<fileset dir="classes/Custom-event" includes="org/mobicents/slee/service/events/*.class" />
		</jar>
	</target>

	<target name="clean-Custom-event">
		<delete file="jars/Custom-event.jar" />
		<delete dir="classes/Custom-event" />
	</target>

	<target name="build-ConvergedDemo-DU" depends="build-UserSbb-sbb,build-OrderDeliverDateSbb-sbb,build-OrderShipDateSbb-sbb, build-AdminSbb-sbb,build-CallControlSbb-sbb,build-Custom-event,build-pojo,build-utility-jar">
		<mkdir dir="classes/ConvergedDemo-DU" />
		<copy file="src/org/mobicents/slee/service/ConvergedDemo-deployable-unit.xml" tofile="classes/ConvergedDemo-DU/deployable-unit.xml" />
		<jar jarfile="jars/ConvergedDemo-DU.jar">
			<metainf dir="classes/ConvergedDemo-DU" includes="deployable-unit.xml" />
			<fileset includes="jars/UserSbb-sbb.jar" dir="" />
			<fileset includes="jars/AdminSbb-sbb.jar" dir="" /> 
			<fileset includes="jars/CallControlSbb-sbb.jar" dir="" />
			<fileset includes="jars/Custom-event.jar" dir="" />
			<fileset includes="jars/OrderDeliverDateSbb-sbb.jar" dir="" /> 
			<fileset includes="jars/OrderShipDateSbb-sbb.jar" dir="" />
			<fileset includes="library/pojo.jar" dir="" />
			<fileset includes="library/utility.jar" dir="" />
			<fileset includes="src/org/mobicents/slee/service/user/UserSbb-service.xml" dir="." />
			<fileset includes="src/org/mobicents/slee/service/admin/AdminSbb-service.xml" dir="." />
			<fileset includes="src/org/mobicents/slee/service/user/delivery/OrderDeliverDateSbb-service.xml" dir="." />
			<fileset includes="src/org/mobicents/slee/service/user/ship/OrderShipDateSbb-service.xml" dir="." />
		</jar>
	</target>

	<target name="clean-ConvergedDemo-DU">
		<delete file="jars/ConvergedDemo-DU.jar" />
		<delete dir="classes/ConvergedDemo-DU" />
	</target>

	<!-- Deploys to JBOSS. -->
	<target name="deploy" depends="build-ConvergedDemo-DU,management-init">

		<pathconvert targetos="unix" property="duPathValue" refid="duPath" />
		<echo>Deploying ConvergedDemo DU JAR ${file_url}${duPathValue}</echo>
		<slee-management jnpport="${jnpPort}" host="${jnpHost}">
			<install url="${file_url}${duPathValue}" />
		</slee-management>
		<echo>Activate ConvergedDemo Service</echo>
		<slee-management jnpport="${jnpPort}" host="${jnpHost}">
			<activateservice serviceid="${serviceID1}" />
			<activateservice serviceid="${serviceID2}" />
			<activateservice serviceid="${serviceID3}" />
			<activateservice serviceid="${serviceID4}" />
		</slee-management>
	</target>

	<target name="undeploy" depends="init">
		<pathconvert targetos="unix" property="duPathValue" refid="duPath" />
		<!-- deactivate the service -->
		<slee-management jnpport="${jnpPort}" host="${jnpHost}">
			<deactivateservice serviceid="${serviceID1}" />
			<deactivateservice serviceid="${serviceID2}" />
			<deactivateservice serviceid="${serviceID3}" />
			<deactivateservice serviceid="${serviceID4}" />
		</slee-management>
		<!-- undeploys the service -->
		<slee-management jnpport="${jnpPort}" host="${jnpHost}">
			<uninstall url="${file_url}${duPathValue}" />
		</slee-management>
	</target>


	<target name="deploy-all" depends="management-init" description="!! Deploys this  example along with all dependencies, hopefuly!!">		
		<ant target="deploy" />
	</target>


	<target name="undeploy-all" depends="management-init" description="!! unDeploys this  example along with all dependencies, hopefuly!!">
		<ant target="undeploy" />		
	</target>
</project>

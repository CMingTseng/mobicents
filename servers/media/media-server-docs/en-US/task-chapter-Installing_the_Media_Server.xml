<?xml version='1.0'?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
]><!-- chapter id nickname: itms -->
<chapter
	id="chapter-Installing_the_Media_Server">
	<title>Installing the Media Server</title>
	<para>The Media Server is a self-contained Java software stack consisting of multiple servers architecturally designed to work together.  This server stack includes the JBoss Application Server and the JAIN SLEE Server; both of these required servers are included in the Media Server distribution.</para>
	<para>The Media Server is available in both binary and source code distributions. The simplest way to get started with the Media Server is to download the ready-to-run binary distribution. Alternatively, the source code for the Media Server can be obtained by checking it out from its repository using the Subversion version control system (<acronym>VCS</acronym>), and then built using the Maven build system. Whereas installing the binary distribution is recommended for most users, obtaining and building the source code is recommended for those who want access to the latest revisions and Media Server capabilities.</para>
	<bridgehead	id="itms-Installing_the_Java_Development_Kit">Installing the Java Development Kit</bridgehead>
	
	<xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="mob-task-section-Java_Development_Kit-Installing_Configuring_and_Running.xml"></xi:include>
	
	<section	id="itms-binary-Media_Server-Installing_Configuring_and_Running">
		<title>Binary Distribution: Installing, Configuring and Running</title>
		<para>The Media Server distribution comes bundled with the JBoss Application Server, the latest version of the JAIN SLEE Server, and all of the resource adapters required to run the various bundled examples.</para>
		
		<section	id="itms-binary-Media_Server-PreInstall_Requirements_and_Prerequisites">
			<title>Pre-Install Requirements and Prerequisites</title>
			<para>Ensure that the following requirements have been met before continuing with the install.</para>
			<variablelist id="itms-binary-Media_Server-Hardware_Requirements">
				<title>Hardware Requirements</title>
				<varlistentry>
					<term>Sufficient Disk Space</term>
					<listitem>
						<para>Once unzipped, the Media Server binary release requires <emphasis>at least</emphasis> &MS_SIZE; of free disk space.  Keep in mind that disk space requirements may change from release to release.</para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>Anything Java Itself Will Run On</term>
					<listitem>
						<para>The Media Server and its bundled servers, JBoss and JAIN SLEE, are 100% Java. The Media Server will run on the same hardware that the JBoss Application Server runs on.</para>
					</listitem>
				</varlistentry>
			</variablelist>
			<variablelist id="itms-binary-Media_Server-Software_Prerequisites">
				<title>Software Prerequisites</title>
				<varlistentry>
					<term>JDK 5 or Higher</term>
					<listitem>
						<para>A working installation of the Java Development Kit (<acronym>JDK</acronym>) version 5 or higher is required in order to run the Media Server.  Note that the JBoss Application Server is a runtime dependency of the Media Server and, as mentioned, comes bundled with the binary distribution.</para>
					</listitem>
				</varlistentry>
			</variablelist>
		</section>
		<section id="itms-binary-Media_Server-Downloading">
			<title>Downloading</title>
			<para>The latest version of the Media Server is available from <ulink url="http://www.mobicents.org/mms-downloads.html"/>.  The top row of the table holds the latest version.  Click the <literal>Download</literal> link to start the download.</para>
		</section>
		<section	id="itms-binary-Media_Server-Installing">
			<title>Installing</title>
			<para>Once the requirements and prerequisites have been met and you have downloaded the binary distribution zip file, you are ready to install the Media Server. Follow the instructions below for your platform, whether Linux or Windows.</para>
			<note id="itms-Media_Server-Use_Version_Numbers_Relevant_to_Your_Installation">
				<title>Version Number</title>
				<para>For clarity, the command line instructions presented in this chapter use specific version numbers and directory names.  Ensure this information is substituted with the binary distribution's version numbers and file names.</para>
			</note>
			<procedure>
				<title>Installing the Media Server Binary Distribution on Linux</title>
				<para>It is assumed that the downloaded archive is saved in the home directory, and that a terminal window is open displaying the home directory.</para>
				<step>
					<para>Create a subdirectory to extract the files into.  For ease of identification, it is recommended that the version number of the binary is included in this directory name.</para>
					<screen>~]$ mkdir <quote>ms-<replaceable>&lt;version&gt;</replaceable></quote></screen>
				</step>
				<step>
					<para>Move the downloaded zip file into the directory:</para>
					<screen>~]$ mv <quote>&MS_ZIP;</quote><quote>ms-<replaceable>&lt;version&gt;</replaceable></quote></screen>
				</step>
				<step>
					<para>Move into the directory:</para>
					<screen>~]$ cd <quote>ms-<replaceable>&lt;version&gt;</replaceable></quote></screen>
				</step>
				<step>
				<para>Extract the files into the current directory by executing one of the following commands.
				<itemizedlist>
          <listitem><para>Java: <screen>ms-<replaceable>&lt;version&gt;</replaceable>]$ jar -xvf <quote>&MS_ZIP;</quote></screen></para></listitem>
				  <listitem><para>Linux: <screen>mss-jboss-&lt;version&gt;]$ unzip &quot;&SSS_MSS4J_ZIP;&quot;</screen></para></listitem>
        </itemizedlist>
        <note><para>Alternatively, use <command>unzip</command> -d &lt;unzip_to_location&gt; to extract the zip file's contents to a location other than the current directory.</para></note>
				</para>
				</step>
				<step>
					<para>Consider deleting the archive, if free disk space is an issue.</para>
					<screen>ms-<replaceable>&lt;version&gt;</replaceable>]$ rm <quote>&MS_ZIP;</quote></screen>
				</step>
			</procedure>
			<procedure>
				<title>Installing the Media Server Binary Distribution on Windows</title>
				<step>
					<para>For this procedure, it is assumed that the downloaded archive is saved in the <filename>My Downloads</filename> folder.</para>
				</step>
				<step>
				<para>Create a subfolder in <filename>My Downloads</filename> to extract the zip file's contents into.  For ease of identification, it is recommended that the version number of the binary is included in the folder name.  For example, <filename>ms-&lt;version&gt;</filename>.</para>
			</step>
			<step>
				<para>Extract the contents of the archive, specifying the destination folder as the one created in the previous step.</para>
      </step>
      <step>
        <para>Alternatively, execute the <command>jar -xvf</command> command to extract the binary distribution files from the zip archive.</para>
        <orderedlist>
          <listitem><para>Move the downloaded zip file from <filename>My Downloads</filename> to the folder created in the previous step.</para></listitem>
          <listitem><para>Open the Windows Command Prompt and navigate to the folder that contains the archive using the <command>cd</command> command</para></listitem>
          <listitem><para>Execute the <command>jar -xvf</command> command to extract the archive contents into the current folder.</para>
          <screen>C:&bsol;Users&bsol;&lt;user&gt;&bsol;My Downloads&bsol;ms-&lt;version&gt;&bsol;jar -xvf &quot;&MS_ZIP;&quot;</screen>
          </listitem>
        </orderedlist>
      </step>
			<step>
				<para>It is recommended that the folder holding the MSS for JBoss files (in this example, the folder named <filename>mss-jboss-<replaceable>&lt;version&gt;</replaceable></filename>) is moved to a user-defined location for storing executable programs.  For example, the <filename>Program Files</filename> folder.</para>
			</step>
			<step>
				<para>Consider deleting the archive, if free disk space is an issue.</para>
				<screen>C:&bsol;Users&bsol;&lt;user&gt;&bsol;My Downloads&bsol;mss-jboss-&lt;version&gt;&bsol;delete &quot;&MS_ZIP;&quot;</screen>
			</step>
		</procedure>
		</section>
		
    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="mob-task-section-Setting_the_JBOSS_HOME_Environment_Variable.xml"></xi:include>
    
		<section	id="itms-binary-Media_Server-Running">
			<title>Running</title>
			<para>In the Linux terminal or Command Prompt, you will be able to tell that the Media Server started successfully if the last line of output is similar to the following (ending with <quote>Started in 23s:648ms</quote>):</para>
			<programlisting><![CDATA[11:23:07,656 INFO  [Server] JBoss (MX MicroKernel) [4.2.2.GA (build: SVNTag=JBoss_4_2_2_GA date=200710221139)] Started in 23s:648ms]]></programlisting>
			<procedure>
				<title>Running the Media Server on Linux</title>
				<step>
				  <para>Change the working directory to installation directory (the one in which the zip file's contents was extracted to)</para>
				  <screen>downloads]$ cd &quot;ms-&lt;version&gt;&quot;</screen>
			  </step>
			  <step>
			  	<para>(Optional) Ensure that the <filename>bin/run.sh</filename> start script is executable.</para>
			  	<screen>ms-&lt;version&gt;]$ chmod +x bin/run.sh</screen>
			  </step>
		  	<step>
		  		<para>Execute the <filename>run.sh</filename> Bourne shell script.</para>
	  			<screen>ms-&lt;version&gt;]$ ./bin/run.sh</screen>
        </step>
	  	</procedure>
		  <note><para>Instead of executing the Bourne shell script to start the server, the <filename>run.jar</filename> executable Java archive can be executed from the <filename>bin</filename> directory:</para>
			<screen>ms-&lt;version&gt;]$ java -jar bin/run.jar</screen></note>
		  <procedure>
		  	<title>Running Media Server on <productname>Windows</productname></title>
	  		<step>
		  		<para>Using Windows Explorer, navigate to the <filename>bin</filename> subfolder in the installation directory.</para>
        </step>
		  	<step>
		  		<para>The preferred way to start the Media Server is from the Command Prompt.  The command line interface displays details of the startup process, including any problems encountered during the startup process.</para>
		  		<para>Open the Command Prompt via the <guilabel>Start</guilabel> menu and navigate to the correct folder:</para>
			  	<screen>C:&bsol;Users&bsol;&lt;user&gt;&bsol;My Downloads&gt; cd &quot;ms-&lt;version&gt;&quot;</screen>
		  	</step>
       <step>
         <para>Start the JBoss Application Server by executing one of the following files:
         <itemizedlist>
           <listitem><para><filename>run.bat</filename> batch file:</para><screen>C:&bsol;Users&bsol;&lt;user&gt;&bsol;My Downloads&bsol;ms-&lt;version&gt;&gt;bin&bsol;run.bat</screen></listitem>
           <listitem><para><filename>run.jar</filename> executable Java archive:</para><screen>C:&bsol;Users&bsol;&lt;user&gt;My Downloads&bsol;mss-jboss-&lt;version&gt;&gt;java -jar bin&bsol;run.jar</screen></listitem>
          </itemizedlist>
          </para>
			</step>
			</procedure>
		</section>
		<section	id="itms-binary-Media_Server-Stopping">
		  <title>Stopping the Media Server</title>
			<para>Detailed instructions for stopping the JBoss Application Server are given below, arranged by platform.  If the server is correctly stopped, the following three lines are displayed as the last output in the Linux terminal or Command Prompt:</para>
		  <programlisting>[Server] Shutdown complete
Shutdown complete
Halting VM</programlisting>
		<procedure>
			<title>Stopping the Media Server on Linux</title>
			<step>
				<para>Change the working directory to the binary distribution's install directory.</para>
				<screen>~]$ cd &quot;ms-&lt;version&gt;&quot;</screen>
			</step>
			<step>
				<para>(Optional) Ensure that the bin/shutdown.sh start script is executable:</para>
				<screen>ms-&lt;version&gt;]$ chmod +x bin/shutdown.sh</screen>
			</step>
			<step>
				<para>Run the <filename>shutdown.sh</filename> executable Bourne shell script with the <option>-S</option> option (the short option for <option>--shutdown</option>) as a command line argument:</para>
				<screen>ms-&lt;version&gt;]$ ./bin/shutdown.sh -S</screen>
			</step>
		</procedure>
		<note><para>The <filename>shutdown.jar</filename> executable Java archive with the <option>-S</option> option can also be used to shut down the server:</para>
      <screen>ms-&lt;version&gt;]$ java -jar bin/shutdown.jar -S</screen></note>
		<procedure>
			<title>Stopping MSS for JBoss on Windows</title>
			<step>
				<para>Stopping the JBoss Application Server on Windows consists of executing either the <filename>shutdown.bat</filename> or the <filename>shutdown.jar</filename> executable file in the <filename>bin</filename> subfolder of the MSS for JBoss binary distribution.  Ensure the <option>-S</option> option (the short option for <option>--shutdown</option>) is included in the command line argument.</para>
				<screen>C:&bsol;Users&bsol;&lt;user&gt;&bsol;My Downloads&bsol;ms-&lt;version&gt;&gt;bin&bsol;shutdown.bat -S</screen>
				<stepalternatives>
					<step>
						<para>The <filename>shutdown.jar</filename> executable Java archive with the <option>-S</option> option can also be used to shut down the server:</para>
						<screen>C:&bsol;Users&bsol;&lt;user&gt;&bsol;My Downloads&bsol;ms-&lt;version&gt;&gt;java -jar bin&bsol;shutdown.jar -S</screen>
					</step>
				</stepalternatives>
			</step>
		</procedure>
		</section>
		<section	id="itms-binary-Media_Server-Using">
			<title>Using</title>
			<para>The Media Server can be controlled using the Management Console, which is started along with the server.</para>
		</section>
		<section id="itms-Server_Structure">
  	<title>Server Structure</title>
  	<para>Now the server is installed, it is important to understand the layout of the server directories.  An understanding of the server strucutre is useful when deploying examples, and making configuration changes.  It is also useful to understand what components can be removed to reduce the server boot time.</para>
  	<para>The directory structure in the Media Server installation directory is named using a standard structure.  <xref linkend="tab-mss-Directory-Structure"/> describes each directory, and the type of information contained within each location.</para>
  	<table id="tab-mss-Directory-Structure" frame='all'>
      <title>Directory Structure</title>
      <tgroup cols='2' align='left' colsep='1' rowsep='1'>
      <colspec colname='c1'/>
      <colspec colname='c2'/>
      <thead>
      <row>
        <entry align="center">Directory Name</entry>
        <entry align="center">Description</entry>
      </row>
      </thead>
      <tbody>
        <row>
          <entry>bin</entry><entry>Contains the entry point JARs and start-up scripts included with the Media Server distribution.</entry>
        </row>
        <row>
         <entry>conf</entry><entry>Contains the core services that are required for the server.  This includes the bootstrap descriptor, log files, and the default bootstrap-beans.xml configuration file.</entry>
        </row>
        <row>
          <entry>deploy</entry><entry>Contains the dynamic deployment content required by the hot deployment service.  The deploy location can be overridden by specifying a location in the URL attribute of the URLDeploymentScanner configuration item.</entry>
        </row>
         <row>
          <entry>lib</entry><entry>Contains the startup JAR files used by the server. </entry>
        </row>
        <row>
          <entry>log</entry><entry>Contains the logs from the bootstrap logging service.  The <filename>log</filename> directory is the default directory into which the bootstrap logging service places its logs, however, the location can be overridden by altering the log4j.xml configuration file.  This file is located in the <filename>/conf</filename> directory.</entry>
        </row>
      </tbody>
    </tgroup>
    </table>
  	<para>The Media Server uses a number of XML configuration files that control various aspects of the server.  <xref linkend="tab-mss-Core_Configuration_File_Set"/> describes the location of the key configuration files, and provides a description of the </para>
  	<table id="tab-mss-Core_Configuration_File_Set" frame='all'>
      <title>Core Configuration File Set</title>
      <tgroup cols='2' align='left' colsep='1' rowsep='1'>
      <colspec colname='c1'/>
      <colspec colname='c2'/>
      <thead>
      <row>
        <entry align="center">File Name and Location</entry>
        <entry align="center">Description</entry>
      </row>
      </thead>
      <tbody>
        <row>
          <entry>conf/bootstrap-beans.xml</entry><entry>Specifies which additional microcontainer deployments are loaded as part of the bootstrap phase.  bootstrap-beans.xml references other configuration files contained in the <filename>/conf/bootstrap/</filename> directory.  For a standard configuration, the bootstrap configuration files require no alteration.</entry>
        </row>
        <row>
          <entry>conf/log4j.properties</entry><entry>Specifies the Apache <literal>log4j</literal> framework category priorities and appenders used by the Media Server.</entry>
        </row>
        <row>
          <entry>deploy/ann-beans.xml</entry><entry>Specifies the configuration for announcement access points.</entry>
        </row>
        <row>
          <entry>deploy/ivr-beans.xml</entry><entry>Specifies the configuration for Interactive Voice Response (IVR) endpoints.</entry>
        </row>
        <row>
          <entry>deploy/prelay-beans.xml</entry><entry>Specifies the configuration for Packet Relay endpoints.</entry>
        </row>
        <row>
          <entry>deploy/cnf-beans.xml</entry><entry>Specifies the configuration for Conference endpoints.</entry>
        </row>
        <row>
          <entry>deploy/test-beans.xml</entry><entry>Specifies the endpoint for test capabilities.</entry>
        </row>
        <row>
          <entry>deploy/mgcp-conf.xml</entry><entry>Specifies the configuration for the MGCP controller.</entry>
        </row>
      </tbody>
    </tgroup>
    </table>
	</section>
	
		<section	id="itms-binary-Media_Server-Testing">
			<title>Testing</title>
			<para>For information on testing the Media Server, refer to <xref linkend="itms-Writing_and_Running_Tests_Against_the_Media_Server"/>.</para>
		</section>
		
		<section	id="itms-binary-Media_Server-Uninstalling">
			<title>Uninstalling</title>
			<para>To uninstall the Media Server, simply delete the directory you decompressed the binary distribution archive into.</para>
		</section>
	</section>
	
	<section	id="itms-Writing_and_Running_Tests_Against_the_Media_Server">
		<title>Writing and Running Tests Against the Media Server</title>
		<para>For information about the different kinds of tests that the Media Server provides, refer to <ulink url="http://groups.google.com/group/mobicents-public/web/mobicents-ms-tests">Writing and Running Tests Against MMS</ulink>.</para>
	</section>
</chapter>


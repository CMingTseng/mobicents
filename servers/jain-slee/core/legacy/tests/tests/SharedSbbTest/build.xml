<?xml version="1.0" encoding="utf-8"?>
<project default="all" name="SharedSbbTest">

	<property name="mobicents.home" value="${ant.file.SharedSbbTest}/../../.." />
	<import file="${mobicents.home}/../ant-scripts/mobicents-ant-common-properties.xml" />
	<import file="${mobicents.home}/../ant-scripts/mobicents-ant-common-service.xml" />

	<!-- DEPLOY STUFF -->
	<path id="du1Path">
		<pathelement location="./jars/DU1-DU.jar" />
	</path>
	<path id="du2Path">
		<pathelement location="./jars/DU2-DU.jar" />
	</path>


	<property name="du1PathValue" refid="du1Path" />
	<property name="du2PathValue" refid="du2Path" />


	<property name="serviceID1" value="Service1#mobicents#0.1" />
	<property name="serviceID2" value="Service2#mobicents#0.1" />
	

	<target name="init" depends="init-common">
		<path id="slee" refid="mobicents.core.classpath"/>
		<path id="slee-tck">
			<pathelement location="${mobicents.home}/lib/sleetck-minimal.jar"/>
		</path>
	</target>
	<target depends="init,build-DU1-DU,build-DU2-DU" name="all">

	</target>
	
	<target depends="init" name="clean-all">
		<delete dir="jars" />
		<delete dir="classes" />
	</target>	
	
	<target depends="init" name="build-Sbb1-sbb">
		<mkdir dir="classes/Sbb1-sbb" />
		<mkdir dir="jars/" />
		<javac destdir="classes/Sbb1-sbb" includes="org/mobicents/test/*.java" srcdir="src">
			<classpath>
				<path refid="slee" />
				<path refid="slee-tck" />
			</classpath>
		</javac>
		<path id="alla">
			<pathelement location="src/org/mobicents/test/Sbb1-sbb-jar.xml" />
		</path>
		<property name="test1" refid="alla" />

		<sbbjar classpath="classes/Sbb1-sbb" destfile="jars/Sbb1-sbb.jar" sbbjarxml="${test1}" />
	</target>
	<target name="clean-Sbb1-sbb">
		<delete file="jars/Sbb1-sbb.jar" />
		<delete dir="classes/Sbb1-sbb" />
	</target>
	<target depends="init" name="build-Sbb2-sbb">
		<mkdir dir="classes/Sbb2-sbb" />
		<mkdir dir="jars/" />
		<javac destdir="classes/Sbb2-sbb" includes="org/mobicents/test/*.java" srcdir="src">
			<classpath>
				<path refid="slee" />
				<path refid="slee-tck" />
			</classpath>
		</javac>
		<path id="alla2">
			<pathelement location="src/org/mobicents/test/Sbb2-sbb-jar.xml" />
		</path>
		<property name="test2" refid="alla2" />
		<sbbjar classpath="classes/Sbb2-sbb" destfile="jars/Sbb2-sbb.jar" sbbjarxml="${test2}" />
	</target>
	<target name="clean-Sbb2-sbb">
		<delete file="jars/Sbb2-sbb.jar" />
		<delete dir="classes/Sbb2-sbb" />
	</target>
	<target depends="init" name="build-Sbb3-sbb">
		<mkdir dir="classes/Sbb3-sbb" />
		<mkdir dir="jars/" />
		<javac destdir="classes/Sbb3-sbb" includes="org/mobicents/test/*.java" srcdir="src">
			<classpath>
				<path refid="slee" />
				<path refid="slee-tck" />
			</classpath>
		</javac>
		<path id="alla3">
			<pathelement location="src/org/mobicents/test/Sbb3-sbb-jar.xml" />
		</path>
		<property name="test3" refid="alla3" />
		<sbbjar classpath="classes/Sbb3-sbb" destfile="jars/Sbb3-sbb.jar" sbbjarxml="${test3}" />
	</target>
	<target name="clean-Sbb3-sbb">
		<delete file="jars/Sbb3-sbb.jar" />
		<delete dir="classes/Sbb3-sbb" />
	</target>
	<target depends="build-Sbb1-sbb,build-Sbb2-sbb" name="build-DU1-DU">
		<mkdir dir="classes/DU1-DU" />
		<copy file="src/org/mobicents/test/DU1-deployable-unit.xml" tofile="classes/DU1-DU/deployable-unit.xml" />
		<jar jarfile="jars/DU1-DU.jar">
			<metainf dir="classes/DU1-DU" includes="deployable-unit.xml" />
			<fileset dir="" includes="jars/Sbb1-sbb.jar" />
			<fileset dir="" includes="jars/Sbb2-sbb.jar" />
			<fileset dir="." includes="src/org/mobicents/test/Service1-service.xml" />
		</jar>
	</target>
	<target name="clean-DU1-DU">
		<delete file="jars/DU1-DU.jar" />
		<delete dir="classes/DU1-DU" />
	</target>
	<target depends="build-Sbb2-sbb,build-Sbb3-sbb" name="build-DU2-DU">
		<mkdir dir="classes/DU2-DU" />
		<copy file="src/org/mobicents/test/DU2-deployable-unit.xml" tofile="classes/DU2-DU/deployable-unit.xml" />
		<jar jarfile="jars/DU2-DU.jar">
			<metainf dir="classes/DU2-DU" includes="deployable-unit.xml" />
			<fileset dir="" includes="jars/Sbb2-sbb.jar" />
			<fileset dir="" includes="jars/Sbb3-sbb.jar" />
			<fileset dir="." includes="src/org/mobicents/test/Service2-service.xml" />
		</jar>
	</target>
	<target name="clean-DU2-DU">
		<delete file="jars/DU2-DU.jar" />
		<delete dir="classes/DU2-DU" />
	</target>
	





	<!-- DEPLOYING STUFF -->


	<target name="deploy1" depends="build-DU1-DU" description="Deploys services into container described by ${jnpHost} and ${jnpPort}">
		<echo>Installing and activating service ${serviceID1}.</echo>
		<slee-management jnpport="${jnpPort}" host="${jnpHost}">
			<install url="${file_url}${du1PathValue}" />
			<activateservice serviceid="${serviceID1}" />
		</slee-management>

	</target>

	<target name="undeploy1" depends="init" description="unDeploys services from container described by ${jnpHost} and ${jnpPort}">
		<echo>Deactivating and uninstalling service ${serviceID1}.</echo>

		<slee-management jnpport="${jnpPort}" host="${jnpHost}">
			<deactivateservice serviceid="${serviceID1}" />
			<uninstall url="${file_url}${du1PathValue}" />
		</slee-management>

	</target>



	<target name="deploy2" depends="build-DU2-DU" description="Deploys services into container described by ${jnpHost} and ${jnpPort}">
		<echo>Installing and activating service ${serviceID1}.</echo>
		<slee-management jnpport="${jnpPort}" host="${jnpHost}">
			<install url="${file_url}${du2PathValue}" />
			<activateservice serviceid="${serviceID2}" />
		</slee-management>

	</target>

	<target name="undeploy2" depends="init" description="unDeploys services from container described by ${jnpHost} and ${jnpPort}">
		<echo>Deactivating and uninstalling service ${serviceID1}.</echo>

		<slee-management jnpport="${jnpPort}" host="${jnpHost}">
			<deactivateservice serviceid="${serviceID2}" />
			<uninstall url="${file_url}${du2PathValue}" />
		</slee-management>

	</target>









</project>

<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<project basedir="." default="test-suite" name="sip-servlets-test-suite">
	<property environment="env" />
	<property name="M2_REPO" value="${env.M2_REPO}" />
	<property name="junit.output.dir" value="junit" />
	<property name="debuglevel" value="source,lines,vars" />
	<property name="target" value="1.5" />
	<property name="source" value="1.5" />
	<property name="classes" value="target/classes" />
	<property name="test-classes" value="target/test-classes" />
	<path id="sip-servlets-test-suite.classpath">
		<pathelement location="${classes}" />
		<pathelement location="${test-classes}" />		
		<pathelement location="${M2_REPO}/commons-logging/commons-logging/1.1/commons-logging-1.1.jar" />
		<pathelement location="${M2_REPO}/log4j/log4j/1.2.14/log4j-1.2.14.jar" />
		<pathelement location="${M2_REPO}/logkit/logkit/1.0.1/logkit-1.0.1.jar" />
		<pathelement location="${M2_REPO}/avalon-framework/avalon-framework/4.1.3/avalon-framework-4.1.3.jar" />
		<pathelement location="${M2_REPO}/javax/servlet/servlet-api/2.5/servlet-api-2.5.jar" />
		<pathelement location="lib/sipunit.jar" />
		<pathelement location="${M2_REPO}/concurrent/concurrent/1.3.4/concurrent-1.3.4.jar" />
		<pathelement location="${M2_REPO}/javax/servlet/jsp/jsp-api/2.1/jsp-api-2.1.jar" />
		<pathelement location="${M2_REPO}/javax/sip/jain-sip-api/1.2.1/jain-sip-api-1.2.1.jar" />
		<pathelement location="${M2_REPO}/javax/sip/jain-sip-ri/1.2.1/jain-sip-ri-1.2.1.jar" />
		<pathelement location="${M2_REPO}/junit/junit/3.8.1/junit-3.8.1.jar" />
		<pathelement location="${M2_REPO}/org/apache/tomcat/catalina/6.0.14/catalina-6.0.14.jar" />
		<pathelement location="${M2_REPO}/org/apache/tomcat/servlet-api/6.0.14/servlet-api-6.0.14.jar" />
		<pathelement location="${M2_REPO}/org/apache/tomcat/juli/6.0.14/juli-6.0.14.jar" />
		<pathelement location="${M2_REPO}/org/apache/tomcat/annotations-api/6.0.14/annotations-api-6.0.14.jar" />
		<pathelement location="${M2_REPO}/org/apache/tomcat/coyote/6.0.14/coyote-6.0.14.jar" />
		<pathelement location="${M2_REPO}/org/apache/tomcat/jasper/6.0.14/jasper-6.0.14.jar" />
		<pathelement location="${M2_REPO}/org/apache/tomcat/jsp-api/6.0.14/jsp-api-6.0.14.jar" />
		<pathelement location="${M2_REPO}/org/apache/tomcat/el-api/6.0.14/el-api-6.0.14.jar" />
		<pathelement location="${M2_REPO}/org/apache/tomcat/jasper-jdt/6.0.14/jasper-jdt-6.0.14.jar" />
		<pathelement location="${M2_REPO}/org/apache/tomcat/jasper-el/6.0.14/jasper-el-6.0.14.jar" />
		<pathelement location="${M2_REPO}/org/mobicents/servlet/sip/sip-servlets-spec/1.1-SNAPSHOT/sip-servlets-spec-1.1-SNAPSHOT.jar" />
		<pathelement location="${M2_REPO}/org/mobicents/servlet/sip/sip-servlets-impl/0.3-SNAPSHOT/sip-servlets-impl-0.3-SNAPSHOT.jar" />
	</path>

	<target name="init">
		<echo message="${M2_REPO}"/>
		<mkdir dir="${classes}" />
		<mkdir dir="${test-classes}" />
	</target>

	<target name="clean">
		<delete dir="${classes}" />
		<delete dir="${test-classes}" />
		<delete dir="logs" />
	</target>

	<target name="build" depends="clean,init">
		<echo message="${ant.project.name}: ${ant.file}" />
		<javac debug="true" debuglevel="${debuglevel}" destdir="${classes}" source="${source}" target="${target}">
			<src path="src/main/java" />
			<classpath refid="sip-servlets-test-suite.classpath" />
		</javac>
		<javac debug="true" debuglevel="${debuglevel}" destdir="${test-classes}" source="${source}" target="${target}">
			<src path="src/test/java" />
			<classpath refid="sip-servlets-test-suite.classpath" />
		</javac>
		<copy todir="${test-classes}">
			<fileset dir="src/test/resources">
				<include name="**/*.properties" />
			</fileset>
		</copy>
	</target>

	<target name="junitreport">
		<junitreport todir="${junit.output.dir}">
			<fileset dir="${junit.output.dir}">
				<include name="TEST-*.xml" />
			</fileset>
			<report format="frames" todir="${junit.output.dir}" />
		</junitreport>
	</target>

	<target name="test-suite" depends="build">
		<mkdir dir="${junit.output.dir}" />
		<junit fork="yes" printsummary="yes">
			<classpath refid="sip-servlets-test-suite.classpath" />
			<formatter type="xml" />

			<batchtest fork="yes" todir="${junit.output.dir}">
				<fileset dir="src/test/java">
					<include name="**/*Test.java" />
					<exclude name="**/B2BUATest.java" />
					<exclude name="**/Click2CallBasicTest.java" />
				</fileset>
			</batchtest>
		</junit>
		<!--mkdir dir="${junit.output.dir}"/>
        <junit fork="yes">          
          <classpath refid="sip-servlets-test-suite.classpath"/>          
  
          <test name="org.mobicents.servlet.sip.testsuite.AllTests">
            <formatter type="plain"/>
          </test>  
        </junit-->
	</target>
</project>

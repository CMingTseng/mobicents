<project name="3pcc_ws_server" default="deploy" basedir=".">

	<property environment="system" />
	<property name="jboss.home" location="${system.JBOSS_HOME}" />
	<property name="src" location="src" />
	<property name="build" location="build" />
	<property name="common.dir" value="${basedir}/../common" />
	<property name="classes.dir" value="${basedir}/../../3pcc_sip_slee/classes" />
	<property name="module.name.wsr" value="3pcc_ws_server.wsr" />
	<property name="examples.home" value="${system.MOBICENTS_EXAMPLES}" />
	<!--  MOBICENTS MCLI[ in fact this is slee-management.xml but name has been changed for conveniance] 
	  -->
	<import file="${examples.home}/lib/build.xml" />
	<target name="init" depends="clean,management-init,lib-init" description="initialization">
		<tstamp />
		<mkdir dir="${build}" />
		<path id="classpath">
			<!--  <fileset dir="${jboss.home}/server/all/lib">
						<include name="*.jar" />
					</fileset> 
	  -->
			<pathelement location="${jboss.home}/server/all/lib/jboss-jaxrpc.jar" />
			<pathelement location="${jboss.home}/server/all/lib/jboss-j2ee.jar" />
			<pathelement location="${jboss.home}/server/all/lib/jboss-saaj.jar" />
			<pathelement location="${jboss.home}/server/all/lib/log4j.jar" />
			<pathelement location="${jboss.home}/server/all/lib/activation.jar" />
			<pathelement location="${jboss.home}/server/all/lib/mail.jar" />
			<pathelement location="${jboss.home}/server/all/deploy/jboss-net.sar/axis-ws4ee.jar" />
			<!--  <pathelement location="${basedir}/../3pcc_ws_client/lib/axis.jar" /> 
	  -->
			<pathelement location="${jboss.home}/server/all/deploy/jboss-net.sar/commons-discovery.jar" />
			<pathelement location="${jboss.home}/server/all/deploy/jboss-net.sar/commons-logging.jar" />
			<pathelement location="${jboss.home}/server/all/deploy/jboss-net.sar/wsdl4j.jar" />
			<!--  <fileset dir="${jboss.home}/server/all/deploy/jboss-net.sar">
						<include name="*.jar"/>
					</fileset> 
	  -->
			<fileset dir="${basedir}/../../3pcc_sip_slee/jars">
				<include name="*.jar" />
			</fileset>
			<pathelement location="${examples.home}/lib/slee_1_1.jar" />
			<pathelement location="${jboss.home}/server/all/deploy/jbossweb-tomcat50.sar/servlet-api.jar" />
			<pathelement location="${jboss.home}/lib/jboss-common.jar" />
			<pathelement location="${basedir}/../../3pcc_sip_slee/classes/" />
		</path>
	</target>



	<target name="compile" depends="init" description="compile source">
		<javac srcdir="${src}" destdir="${build}" source="1.4" target="1.4" classpathref="classpath" />
		<javac srcdir="${common.dir}" destdir="${build}" source="1.4" target="1.4" classpathref="classpath" />
	</target>

	<target name="create-skeletons" depends="init">
		<java classname="org.apache.axis.wsdl.WSDL2Java" fork="true" failonerror="true" classpathref="classpath">
			<arg value="META-INF/parlayx_third_party_call_service_2_0.wsdl" />
			<arg value="--output" />
			<arg file="src" />
			<arg value="--verbose" />
			<arg value="--package" />
			<arg value="org.csapi.www.schema.parlayx.common.v2_0" />
		</java>
		<sleep milliseconds="2000" />
	</target>


	<target name="package" depends="" description="Packaging the war file">
		<copy file="${common.dir}/etc/callservice.properties" todir="${build}/META-INF" />
		<copy file="${common.dir}/etc/callservice.properties" todir="${classes.dir}/META-INF" />

		<jar jarfile="${module.name.wsr}">
			<fileset dir="${build}">
				<include name="**/*.class" />
				<include name="**/*.properties" />
			</fileset>
			<metainf dir="META-INF" includes="web-service.xml" />
			<metainf dir="META-INF" includes="*.wsdl" />
			<metainf dir="META-INF" includes="*.wsdd" />
			<metainf dir="META-INF" includes="*.xsd" />
		</jar>

	</target>

	<target name="clean" description="clean project">

		<delete>
			<fileset dir=".">
				<include name="*.jar" />
				<include name="*.ear" />
				<include name="*.sar" />
				<include name="*.war" />
				<include name="*.MD5" />
			</fileset>
		</delete>
		<delete dir="${build}" />
	</target>

	<target name="deploy" depends="clean,compile,package" description="jar">
		<copy file="${module.name.wsr}" todir="${jboss.home}/server/all/deploy" />
		<delete file="${module.name.wsr}" />
	</target>

	<target name="undeploy">
		<delete file="${jboss.home}/server/all/deploy/${module.name.wsr}" />
	</target>

</project>


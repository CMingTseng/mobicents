<?xml version="1.0" encoding="utf-8"?>
<project default="war" name="3pcc_web_app">
	
	<property name="class.dir" value="${basedir}/classes" /> 
	  <property name="src.dir" value="src" /> 
	  <property name="webcontent.dir" value="WebContent" /> 
	  <property name="lib.dir" value="lib" /> 
	  <property name="jsp.dir" value="${webcontent-dir}/WEB-INF/jsp" /> 
	  <property name="common.dir" value="${basedir}/../common" /> 
	  <property name="ws.client.dir" value="${basedir}/../3pcc_ws_client" /> 
	  <property name="ws.server.dir" value="${basedir}/../3pcc_ws_server" /> 
	  <property name="common.etc.dir" value="${basedir}/../common/etc" /> 
	  <property file="${common.etc.dir}/callservice.properties" /> 
	 <!-- 	******************************************
			Set the system variable JBOSS_HOME to 
			your jboss installation directory
		******************************************
		
	  --> 
	  <property environment="system" /> 
	  <property name="jboss.home" value="${system.JBOSS_HOME}" /> 
	  <property name="jboss.deploy.dir" value="${jboss.home}/server/all/deploy" /> 
	  <property name="jboss.lib.dir" value="${jboss.home}/server/all/lib" /> 
	  <property name="jboss-net.lib.dir" value="${jboss.home}/server/all/deploy/jboss-net.sar" /> 
	  <property name="jboss.node" value="all" /> 
	  <property name="ThirdPCC.web.war.dir" value="thirdpcc.war" /> 
	  <property name="build.dir" value="build" /> 
	  <property name="deploy.dir" value="${jboss.home}/server/all/deploy/" /> 
	  <property name="examples.home" value="${system.MOBICENTS_EXAMPLES}" /> 
	 <!--  MOBICENTS MCLI[ in fact this is slee-management.xml but name has been changed for conveniance] 
	  --> 
	  <import file="${examples.home}/lib/build.xml" /> 
	 <target name="init" depends="management-init,lib-init">
	 <path id="project.class.path">
	 <!--  For the (e.g.) javax.resource.ResourceException 
	  --> 
	  <pathelement location="${jboss.lib.dir}/jboss-j2ee.jar" /> 
	  <pathelement location="${examples.home}/lib/slee_1_1.jar" /> 
	  <pathelement location="${jboss.lib.dir}/log4j.jar" /> 
	  <pathelement location="${jboss.deploy.dir}/jbossweb-tomcat50.sar/servlet-api.jar" /> 
	  <pathelement location="${basedir}/../../3pcc_sip_slee/classes" /> 
	 <!--  <pathelement location="../3pcc_ws_client/lib/axis.jar"/> 
	  --> 
	  <pathelement location="${jboss.home}/client/axis-ws4ee.jar" /> 
	  <pathelement location="${jboss.home}/client/commons-discovery.jar" /> 
	  <pathelement location="${jboss.home}/client/commons-logging.jar" /> 
	  <pathelement location="${jboss.home}/client/jboss-jaxrpc.jar" /> 
	  <pathelement location="${jboss.home}/client/jboss-saaj.jar" /> 
	  <pathelement location="${jboss.home}/client/log4j.jar" /> 
	  <pathelement location="${jboss.home}/client/wsdl4j.jar" /> 
	  <pathelement location="${jboss.home}/client/jboss-common-client.jar" /> 
	  </path>
	  </target>


	<!-- 
	*********************************************
		Cleans all in classes and the war dir
	*********************************************
	-->
	<target name="clean" depends="init" description="Cleans all in classes and the war file">
		<delete dir="${class.dir}"/>
		<delete dir="${build.dir}" />
	</target>

	<!--
	**********************************************
		Compile
	**********************************************
	-->
	<target name="compile" depends="clean">
		<mkdir dir="${class.dir}" />
		<!-- Compile source files -->
		<javac destdir="${class.dir}"  source="1.4" target="1.4">
			<classpath>
				<path refid="project.class.path" />
			</classpath>
			<src path="${src.dir}"/>
			<src path="${common.dir}/src"/>
			<src path="${ws.client.dir}/src"/>
		</javac>

		<!-- Compile common files 
		<javac destdir="${class.dir}" srcdir="${common.dir}/src">
			<classpath>
				<path refid="project.class.path" />
			</classpath>
		</javac>-->
	</target>

	<!--
	***********************************************
		Build war 
	***********************************************
	-->
	<target name="war" depends="compile">

		<!-- create dir struct -->
		<mkdir dir="${build.dir}/${ThirdPCC.web.war.dir}" />
		<mkdir dir="${build.dir}/${ThirdPCC.web.war.dir}/WEB-INF/classes" />
		<mkdir dir="${build.dir}/${ThirdPCC.web.war.dir}/WEB-INF/lib" />
		<mkdir dir="${build.dir}/${ThirdPCC.web.war.dir}/META-INF/" />

		<!-- copy web content -->
		<copy todir="${build.dir}/${ThirdPCC.web.war.dir}">
			    <fileset dir="${webcontent.dir}"/>
		</copy>
		
		<!-- copy source files -->
		<copy todir="${build.dir}/${ThirdPCC.web.war.dir}/WEB-INF/classes">
			<fileset dir="${class.dir}" includes="se/jayway/sip/**/*.class" />
		</copy>
	
		<!-- Copy properties file --> 
		<copy file="${common.dir}/etc/callservice.properties" 
			  todir="${build.dir}/${ThirdPCC.web.war.dir}/META-INF"/> 

	</target>

	<!--
	***********************************************
		Build war when WS client is included
	***********************************************
	-->
	<target name="war+ws_client" depends="compile">
	
		<!-- compile ws client -->
		<subant target="compile">
			<fileset dir="${ws.client.dir}" includes="build.xml" />
		</subant>

		<!-- create dir struct -->
		<mkdir dir="${build.dir}/${ThirdPCC.web.war.dir}" />
		<mkdir dir="${build.dir}/${ThirdPCC.web.war.dir}/WEB-INF/classes" />
		<mkdir dir="${build.dir}/${ThirdPCC.web.war.dir}/WEB-INF/lib" />
		<mkdir dir="${build.dir}/${ThirdPCC.web.war.dir}/META-INF/" />

		<!-- copy web content -->
		<copy todir="${build.dir}/${ThirdPCC.web.war.dir}">
			    <fileset dir="${webcontent.dir}"/>
		</copy>

		<!-- copy source files (both web app and ws client) -->
		<copy todir="${build.dir}/${ThirdPCC.web.war.dir}/WEB-INF/classes">
			<fileset dir="${class.dir}" includes="se/jayway/sip/**/*.class" />
			<fileset dir="${ws.client.dir}/build" includes="se/jayway/sip/callcontrol/client/model/**/*.class" />
			<fileset dir="${ws.client.dir}/build" includes="se/jayway/sip/callcontrol/client/service/**/*.class" />
			<fileset dir="${ws.client.dir}/build" includes="org/**/*.class" />
		</copy>
	
		<!-- copy properties file --> 
		<copy file="${common.dir}/etc/callservice.properties" 
			  todir="${build.dir}/${ThirdPCC.web.war.dir}/META-INF"/> 
		 
	</target>

	<!--
	***********************************************
		Deploy to JBoss
	***********************************************
	-->
	<target name="deploy" depends="war" description="Deploy the web app as a war folder">
		<copy todir="${deploy.dir}">
			<fileset dir="${build.dir}" />
		</copy>
	</target>
	
	<!--
	***************************************************
		Deploy to JBoss when WS client is included
	***************************************************
	-->
	<target name="deploy+ws_client" depends="war+ws_client" description="Deploy the web app as a war folder when WS client is included in web app">
		<copy todir="${deploy.dir}">
			<fileset dir="${build.dir}" />
		</copy>
	</target>

	<!-- 
	***************************************
	Undeploys war
	***************************************
	-->
	<target name="undeploy" description="Undeploys ThirdPCCWeb">
		<delete dir="${deploy.dir}/${ThirdPCC.web.war.dir}" />
	</target>
	
	<target name="redeploy" depends="undeploy, deploy" description="Undeploys and deploys the wep app"/>

</project>

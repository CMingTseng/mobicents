<?xml version="1.0" encoding="utf-8"?>
<project default="all" name="Call Blocking">

    <property environment="system"/>
    
    <property name="jboss.home" value="${system.JBOSS_HOME}" />
    <property name="node" value="all" description="Controls the jboss conrfiguration. Values are typically all or node1" />
    <property name="deploy-mobicents.dir" value="${jboss.home}/server/${node}/deploy-mobicents" 
        description="Points to the deploy-mobicents/ . The default value is derived from JBOSS_HOME."/>

    <target name="init">
        <path id="slee">
            <pathelement location="../lib/slee_1_1.jar"/>
        </path>
    	
        <!-- Following ant tasks that are available in source via the EclipSLEE sub-project -->
        <taskdef classname="org.mobicents.eclipslee.ant.SbbJar"
            classpath="../lib/slee-tasks.jar" name="sbbjar"/>
        <taskdef classname="org.mobicents.eclipslee.ant.EventJar"
            classpath="../lib/slee-tasks.jar" name="eventjar"/>
        <taskdef classname="org.mobicents.eclipslee.ant.ProfileSpecJar"
            classpath="../lib/slee-tasks.jar" name="profilespecjar"/>
        <taskdef classname="org.mobicents.eclipslee.ant.DeployableJar"
            classpath="../lib/slee-tasks.jar" name="deployablejar"/>
        <taskdef
            classname="org.mobicents.eclipslee.ant.ResourceAdaptorTypeJar"
            classpath="../lib/slee-tasks.jar" name="resourceadaptortypejar"/>
        <taskdef
            classname="org.mobicents.eclipslee.ant.ResourceAdaptorJar"
            classpath="../lib/slee-tasks.jar" name="resourceadaptorjar"/>
    	
        <path id="ExternalComponents">
            <pathelement location="../stage/parlay-resource-adaptor-type.jar"/>
            <pathelement location="../lib/connector-api.jar"/>
        </path>
    	
        <path id="path-CallBlocking-sbb">
            <pathelement location="../stage/parlay-events.jar"/>
            <pathelement location="../stage/parlay-resource-adaptor-type.jar"/>
        </path>
    </target>
    
    <target depends="init" name="all">
        <ant target="build-CallBlocking-sbb"/>
        <ant target="build-CallBlocking-DU"/>
        <ant target="build-auto-deploy"/>
    </target>
	
    <target depends="init" name="clean">
        <ant target="clean-CallBlocking-sbb"/>
        <ant target="clean-CallBlocking-DU"/>
    </target>
	
    <target name="build-CallBlocking-sbb" depends="init">
        <mkdir dir="classes/CallBlocking-sbb"/>
        <mkdir dir="jars/"/>
        <javac destdir="classes/CallBlocking-sbb" srcdir="src" includes="**/*.properties org/mobicents/slee/parlay/callblocking/*.java"
            debug="true" >
            <classpath>
                <path refid="path-CallBlocking-sbb"/>
                <path refid="ExternalComponents"/>
                <path refid="slee"/>
            </classpath>
        </javac>
    	<copy todir="classes/CallBlocking-sbb" file="src/MPCCS.properties"></copy>
        <sbbjar destfile="jars/CallBlocking-sbb.jar"
            classpath="classes/CallBlocking-sbb" 
        	sbbjarxml="src/org/mobicents/slee/parlay/callblocking/CallBlocking-sbb-jar.xml"
        	includes="MPCCS.properties"/>
    	<profilespecjar destfile="jars/CallBlocking-profile.jar"
            classpath="classes/CallBlocking-sbb" 
        	profilespecjarxml="src/org/mobicents/slee/parlay/callblocking/CallBlocking-profile-spec-jar.xml"/>
    </target>
	
    <target name="clean-CallBlocking-sbb">
        <delete file="jars/CallBlocking-sbb.jar"/>
        <delete dir="classes/CallBlocking-sbb"/>
    </target>
	
    <target name="build-CallBlocking-DU" depends="build-CallBlocking-sbb">
        <mkdir dir="classes/CallBlocking-DU"/>
        <copy file="src/CallBlocking-deployable-unit.xml" 
        	tofile="classes/CallBlocking-DU/deployable-unit.xml"/>
        <jar jarfile="jars/CallBlocking-DU.jar">
            <metainf dir="classes/CallBlocking-DU" includes="deployable-unit.xml"/>
            <fileset includes="jars/CallBlocking-sbb.jar" dir=""/>
            <fileset includes="jars/CallBlocking-profile.jar" dir=""/>
            <fileset
                includes="CallBlocking-service.xml" 
            	dir="./src/org/mobicents/slee/parlay/callblocking/"/>
        </jar>
        <!--<delete file="jars/CallBlocking-sbb.jar"/>
        <delete file="jars/CallBlocking-profile.jar"/>-->
    </target>
	
    <target name="clean-CallBlocking-DU">
        <delete file="jars/CallBlocking-DU.jar"/>
        <delete dir="classes/CallBlocking-DU"/>
    </target>
	
    <target name="build-auto-deploy">
        <copy file="scripts/callblocking-deploy.bsh" todir="jars/scripts/"/>
        <copy todir="${deploy-mobicents.dir}">
            <fileset dir="jars">
                <include name="**/*.jar"/>
                <include name="**/*"/>
            </fileset>
        </copy>
    </target>
</project>

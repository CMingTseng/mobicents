<?xml version="1.0" encoding="utf-8"?>
<project name="TrainingExample4" default="deploy">

	<property environment="system" />
	<!--property name="examples.home" value="${system.MOBICENTS_EXAMPLES}" /-->

	<path id="duPath">
		<pathelement location="./jars/TrainingExample4-DU.jar" />
	</path>

	<property name="duPathValue" refid="duPath" />
	<property name="serviceID1" value="Training Example4 FirstBounceSbb Service#org.mobicents#1.0" />
	<property name="serviceID2" value="Training Example4 SecondBounceSbb Service#org.mobicents#1.0" />

	<!-- MOBICENTS MCLI[ in fact this is slee-management.xml but name has been changed for convenience] -->
	<import file="../../lib/build.xml" />
	<echo>EXAMPLES HOME[${examples.home}]</echo>
	<!--import file="${examples.home}/lib/build.xml" /-->



	<target name="init" depends="management-init,lib-init">
		<path id="slee">
			<pathelement location="${examples.home}/lib/slee_1_1.jar" />
		</path>


		<path id="ExternalComponents" refid="examples-libraries">

		</path>


	</target>
	<target name="clean" depends="init">
		<ant target="clean-FirstBounceSbb-sbb" />
		<ant target="clean-SecondBounceSbb-sbb" />
		<ant target="clean-TrainingExample4-DU" />
	</target>
	<target name="build-FirstBounceSbb-sbb" depends="init">
		<mkdir dir="classes/FirstBounceSbb-sbb" />
		<mkdir dir="jars/" />
		<javac destdir="classes/FirstBounceSbb-sbb" srcdir="src" includes="org/mobicents/slee/service/first/*.java,org/mobicents/slee/service/CommonSbb.java">
			<classpath>
				<path refid="slee" />
				<path refid="ExternalComponents" />
			</classpath>
		</javac>
		<copy file="src/org/mobicents/slee/service/first/FirstBounceSbb-sbb-jar.xml" tofile="classes/FirstBounceSbb-sbb/sbb-jar.xml" />

		<jar jarfile="jars/FirstBounceSbb-sbb.jar">
			<metainf dir="classes/FirstBounceSbb-sbb" includes="sbb-jar.xml" />
			<fileset dir="classes/FirstBounceSbb-sbb" includes="org/mobicents/slee/service/first/*.class,org/mobicents/slee/service/CommonSbb.class" />
		</jar>
	</target>
	<target name="clean-FirstBounceSbb-sbb">
		<delete file="jars/FirstBounceSbb-sbb.jar" />
		<delete dir="classes/FirstBounceSbb-sbb" />
	</target>


	<target name="build-SecondBounceSbb-sbb" depends="init">
		<mkdir dir="classes/SecondBounceSbb-sbb" />
		<mkdir dir="jars/" />
		<javac destdir="classes/SecondBounceSbb-sbb" srcdir="src" includes="org/mobicents/slee/service/second/*.java,org/mobicents/slee/service/CommonSbb.java">
			<classpath>
				<path refid="slee" />
				<path refid="ExternalComponents" />
			</classpath>
		</javac>
		<copy file="src/org/mobicents/slee/service/second/SecondBounceSbb-sbb-jar.xml" tofile="classes/SecondBounceSbb-sbb/sbb-jar.xml" />

		<jar jarfile="jars/SecondBounceSbb-sbb.jar">
			<metainf dir="classes/SecondBounceSbb-sbb" includes="sbb-jar.xml" />
			<fileset dir="classes/SecondBounceSbb-sbb" includes="org/mobicents/slee/service/second/*.class,org/mobicents/slee/service/CommonSbb.class" />
		</jar>
	</target>
	<target name="clean-SecondBounceSbb-sbb">
		<delete file="jars/SecondBounceSbb-sbb.jar" />
		<delete dir="classes/SecondBounceSbb-sbb" />
	</target>




	<target name="build-TrainingExample4-DU" depends="build-FirstBounceSbb-sbb,build-SecondBounceSbb-sbb">
		<mkdir dir="classes/TrainingExample4-DU" />
		<copy file="src/org/mobicents/slee/service/TrainingExample4-deployable-unit.xml" tofile="classes/TrainingExample4-DU/deployable-unit.xml" />
		<jar jarfile="jars/TrainingExample4-DU.jar">
			<metainf dir="classes/TrainingExample4-DU" includes="deployable-unit.xml" />
			<fileset includes="jars/FirstBounceSbb-sbb.jar" dir="" />
			<fileset includes="jars/SecondBounceSbb-sbb.jar" dir="" />
			<fileset includes="src/org/mobicents/slee/service/first/FirstBounceSbb-service.xml" dir="." />
			<fileset includes="src/org/mobicents/slee/service/second/SecondBounceSbb-service.xml" dir="." />
		</jar>
	</target>
	<target name="clean-TrainingExample4-DU">
		<delete file="jars/TrainingExample4-DU.jar" />
		<delete dir="classes/TrainingExample4-DU" />
	</target>
	<!-- Deploys to JBOSS. -->
	<target name="deploy" depends="build-TrainingExample4-DU,management-init">

		<pathconvert targetos="unix" property="duPathValue" refid="duPath" />
		<echo>Deploying TrainingExample4 DU JAR ${file_url}${duPathValue}</echo>
		<slee-management jnpport="${jnpPort}" host="${jnpHost}">
			<install url="${file_url}${duPathValue}" />
		</slee-management>
		<echo>Activate TrainingExample4 Service</echo>
		<slee-management jnpport="${jnpPort}" host="${jnpHost}">
			<activateservice serviceid="${serviceID1}" />
			<activateservice serviceid="${serviceID2}" />
		</slee-management>
	</target>
	<target name="undeploy" depends="init">
		<pathconvert targetos="unix" property="duPathValue" refid="duPath" />
		<!-- deactivate the service -->
		<slee-management jnpport="${jnpPort}" host="${jnpHost}">
			<deactivateservice serviceid="${serviceID1}" />
			<deactivateservice serviceid="${serviceID2}" />
		</slee-management>
		<!-- undeploys the service -->
		<slee-management jnpport="${jnpPort}" host="${jnpHost}">
			<uninstall url="${file_url}${duPathValue}" />
		</slee-management>
	</target>


	<target name="deploy-all" depends="management-init" description="!! Deploys this  example along with all dependencies, hopefuly!!">		
		<ant target="deploy" />
	</target>


	<target name="undeploy-all" depends="management-init" description="!! unDeploys this  example along with all dependencies, hopefuly!!">
		<ant target="undeploy" />		
	</target>


</project>

<?xml version="1.0" encoding="UTF-8"?>
<!-- 
/***************************************************
 *                                                 *
 *  Mobicents: The Open Source VoIP Platform       *
 *                                                 *
 *  Distributable under LGPL license.              *
 *  See terms of license at gnu.org.               *
 *                                                 *
 ***************************************************/
-->

<server>
    
  <mbean code="org.mobicents.slee.container.management.jmx.SleeLifecycleMonitor"
         name="slee:service=SleeLifecycleMonitor"> 
        <depends optional-attribute-name="SleeManagementMBean">slee:service=SleeManagement</depends>        
  </mbean>

  <mbean code="org.mobicents.slee.container.management.jmx.SleeManagementMBeanImpl"
         name="slee:service=SleeManagement"> 
        <depends optional-attribute-name="AlarmMBean">slee:name=AlarmMBean</depends>        
        <depends optional-attribute-name="DeploymentMBean">slee:name=DeploymentMBean</depends>        
        <depends optional-attribute-name="ServiceManagementMBean">slee:name=ServiceManagementMBean</depends>        
        <depends optional-attribute-name="TraceMBean">slee:name=TraceMBean</depends>        
        <depends optional-attribute-name="ProfileProvisioningMBean">slee:name=ProfileProvisoningMBean</depends>
        <!-- <depends optional-attribute-name="ResourceAdaptorMBean">slee:name=ResourceAdaptorMBean</depends>       -->
        <depends optional-attribute-name="ResourceManagementMBean">slee:name=ResourceManagementMBean</depends>       
        <depends optional-attribute-name="SbbEntitiesMBean">slee:name=SbbEntitiesMBean</depends>       
        <attribute name="ActivityManagementMBean">slee:name=ActivityManagementMBean</attribute>       
        <depends>slee:name=TransactionManagerMBean</depends>       
        <depends>jboss.cache:service=TreeCache</depends>
        <depends>jboss.cache:service=DeploymentTreeCache</depends>
        <depends>jboss.cache:service=ProfileTreeCache</depends>
        <depends>slee:service=SleeProfileManager</depends>
        <depends>jboss.cache:service=RuntimeTreeCache</depends>
  </mbean>

  <mbean code="org.mobicents.slee.container.management.jmx.AlarmMBeanImpl"
         name="slee:name=AlarmMBean">
         <depends>slee:name=TransactionManagerMBean</depends>
  </mbean>

  <mbean code="org.mobicents.slee.container.management.jmx.DeploymentMBeanImpl"
         name="slee:name=DeploymentMBean">
  </mbean>

  <mbean code="org.mobicents.slee.container.management.jmx.ServiceManagementMBeanImpl"
         name="slee:name=ServiceManagementMBean">
  </mbean>

  <mbean code="org.mobicents.slee.container.management.jmx.TraceMBeanImpl"
         name="slee:name=TraceMBean">
         <depends>slee:name=TransactionManagerMBean</depends>
  </mbean>

  <mbean code="org.mobicents.slee.container.management.jmx.ProfileProvisioningMBeanImpl"
         name="slee:name=ProfileProvisoningMBean">
        <depends>slee:name=TransactionManagerMBean</depends>
  </mbean>

  <!-- The service responsible for Profiles housekeeping -->
  <mbean code="org.mobicents.slee.container.profile.SleeProfileManager"
       name="slee:service=SleeProfileManager"> 
       <depends>slee:name=ProfileProvisoningMBean</depends>
  </mbean>

  <!-- ResourceAdaptorMBean is depricated and removed instead use ResourceManagementMbean
  <mbean code="org.mobicents.slee.container.management.jmx.ResourceAdaptorMBeanImpl"
         name="slee:name=ResourceAdaptorMBean">
  </mbean> -->

  <mbean code="org.mobicents.slee.container.management.jmx.ResourceManagementMBeanImpl"
         name="slee:name=ResourceManagementMBean">
  </mbean>

  <mbean code="org.mobicents.slee.container.management.jmx.ActivityManagementMBeanImpl"
         name="slee:name=ActivityManagementMBean">
         <depends>slee:service=SleeManagement</depends>
  </mbean>
  
  <mbean code="org.mobicents.slee.container.management.jmx.SbbEntitiesMBeanImpl"
         name="slee:name=SbbEntitiesMBean">
         <depends>slee:name=TransactionManagerMBean</depends>
  </mbean>
  
  <mbean code="org.mobicents.slee.runtime.transaction.TransactionManagerImpl"
         name="slee:name=TransactionManagerMBean">
        <depends>jboss:service=TransactionManager</depends>
        <depends optional-attribute-name="TreeCacheName">
               jboss.cache:service=TreeCache
        </depends>
        <depends optional-attribute-name="DeploymentTreeCacheName">
               jboss.cache:service=DeploymentTreeCache
        </depends>
        <depends optional-attribute-name="ProfileTreeCacheName">
               jboss.cache:service=ProfileTreeCache
        </depends>
        <depends optional-attribute-name="RuntimeTreeCacheName">
               jboss.cache:service=RuntimeTreeCache
        </depends>
  </mbean>
  
  <mbean code="org.mobicents.slee.test.suite.tckwrapper.SleeTCKPluginWrapper" 
      name="slee:service=SleeTCKWrapper">
    <depends>slee:service=SleeManagement</depends>
    <depends>jboss:service=invoker,type=jrmp</depends>
    <depends>jboss:service=Naming</depends>
    <attribute name="TCKPluginClassName">com.opencloud.sleetck.lib.infra.sleeplugin.SleeTCKPlugin</attribute>
    <attribute name="TCKPluginMBeanObjectName">:name=SleeTCKPlugin</attribute>
    <attribute name="RMIRegistryPort">4099</attribute>
    <attribute name="SleeProviderImpl">org.mobicents.slee.container.management.jmx.SleeProviderImpl</attribute>
  </mbean>
  
  
  <!--
    |
    | Run SLEE deployment scripts on the singleton node after SLEE starts.
    | Respectively run the undeployment methods of the scripts when SLEE stops.  
    |
    | Note that the TargetName attribute points to an mbean that is defined
    | in server/*/conf/jboss-service.xml under the jboss deployment directory.
    |
    -->
       <mbean code="org.mobicents.slee.container.management.jmx.SleeAutoDeployer" 
              name="slee:service=SleeAutoDeployer">
              <depends>jboss:service=DefaultPartition</depends>   
              <depends>slee:service=SleeManagement</depends>        
              <depends optional-attribute-name="BaseDeployer" proxy-type="org.jboss.deployment.scanner.URLDeploymentScannerMBean">jboss.deployment:type=DeploymentScanner,flavor=URL</depends>
              <attribute name="DeploymentDirectory">${jboss.server.home.url}/deploy-mobicents/scripts/</attribute>
       </mbean>
       

       
  <!--
       The timer restart service which automatically restarts timers etc. on failover
  
  <mbean code="org.mobicents.slee.runtime.jboss.RuntimeRestoreMBeanImpl"
         name="slee:service=MobicentsRuntimeRestore"> 
     <depends>slee:service=SleeManagement</depends>
  </mbean>
     -->
      
   <!--
    |
    | Enable the service which restarts all persistent timers on failover.
    | Note that The Mbean on which the operation is invoked is the
    | service slee:service=RuntimeRestore,platform=jboss which is
    | defined above. Note that the operations are defined in that MBean.
    |
    
   <mbean code="org.jboss.ha.singleton.HASingletonController" 
          name="slee:service=MobicentsRuntimeRestoreController">
      <depends>jboss:service=DefaultPartition</depends>   
      <depends>slee:service=SleeManagement</depends>        
      <depends optional-attribute-name="TargetName">slee:service=MobicentsRuntimeRestore</depends>
      <attribute name="PartitionName">DefaultPartition</attribute>
      <attribute name="TargetStartMethod">restoreRuntimeState</attribute>
      <attribute name="TargetStopMethod">saveRuntimeState</attribute>
   </mbean>
       -->

</server>

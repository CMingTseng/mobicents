<?xml version="1.0" encoding="UTF-8"?>

<project name="Project JCC Resource Adaptor 1.1" default="deploy" basedir="."> 

	<property name="dir.root" value="./" />
	<property name="dir.lib" value="${dir.root}/lib" />
	<property name="dir.desc" value="${dir.root}/descriptors" />
	<property name="dir.desc.ra" value="${dir.desc}/ra" />
	<property name="dir.desc.ratype" value="${dir.desc}/ratype" />
	<property name="dir.classes" value="${dir.root}/build" />
	<property name="dir.dist" value="${dir.root}/dist" />	
	<property name="dir.src" value="${dir.root}/src" />
	<property name="dir.stage" value="${dir.root}/dist" />
	<property name="dir.stage.events" value="${dir.stage}/events" />
	<property name="dir.stage.ratype" value="${dir.stage}/ratype" />
	<property name="dir.stage.ra" value="${dir.stage}/ra" />
	<property name="dir.stage.ratype-unit" value="${dir.stage}/ratype-unit" />
	<property name="dir.stage.ra-unit" value="${dir.stage}/ra-unit" />		

	<!-- JAR files -->
	<property name="jar.lib" value="jcc-1.1.jar" />
	<property name="jar.events" value="jcc-1.1-events.jar" />
	<property name="jar.ratype" value="jcc-1.1-resource-adaptor-type.jar" />
	<property name="jar.ra" value="jcc-1.1-resource-adaptor.jar" />
	<property name="jar.ra-unit" value="jcc-1.1-local-ra.jar" />
	<property name="jar.ratype-unit" value="jcc-1.1-ra-type.jar" />

     <path id="path.compile">
		<fileset dir="${dir.lib}">
			<include name="*.jar" />
		</fileset>
    </path>
  
    <patternset id="src.ratype">
	  <include name="**/ratype/**/*.class"/>
    </patternset>

	<target name="clean">
		<delete dir="${dir.classes}/" />
		<delete dir="${dir.dist}" />
		<delete dir="${dir.stage}" />		
	</target>
	
	<target name="init"> 
		<mkdir dir="${dir.classes}" />
		<mkdir dir="${dir.dist}" />
		<mkdir dir="${dir.stage}" />		
	</target>
	
	<target name="deploy" depends="package-unit-ra, package-unit-type" />
	
	<target name="compile" depends="init"> 	  
		<javac srcdir="${dir.src}" destdir="${dir.classes}" debug="on">
			<classpath>
			  <path refid="path.compile" />
			</classpath>
		</javac>		
	</target>	
	



	<target name="package-events" depends="compile">
		<copy file="${dir.desc.ratype}/event-jar.xml" todir="${dir.stage.events}/META-INF" />
		<jar destfile="${dir.stage}/${jar.events}">
			<fileset dir="${dir.stage.events}" />
		</jar>
		 <delete dir="${dir.stage.events}" />
	</target>

	<target name="package-ratype" depends="compile">
		<copy file="${dir.desc.ratype}/resource-adaptor-type-jar.xml" todir="${dir.stage.ratype}/META-INF" />
		<copy todir="${dir.stage.ratype}">
			<fileset dir="${dir.classes}">
				<patternset refid="src.ratype"/>				
			</fileset>
		</copy>
		<jar destfile="${dir.stage}/${jar.ratype}">
			<fileset dir="${dir.stage.ratype}" />
		</jar>
		<delete dir="${dir.stage.ratype}" />
	</target>

	<target name="package-ra" depends="compile">
		<copy file="${dir.desc.ra}/resource-adaptor-jar.xml" todir="${dir.stage.ra}/META-INF" />
		<copy file="config/jcc-ra.properties" todir="${dir.stage.ra}"/>
		<copy todir="${dir.stage.ra}">
			<fileset dir="${dir.classes}" />
		</copy>
		<jar destfile="${dir.stage}/${jar.ra}">
			<fileset dir="${dir.stage.ra}"/>
		</jar>
	       <delete dir="${dir.stage.ra}" />
	</target>

	<target name="package-unit-type" depends="package-ratype, package-events">
		<copy file="${dir.desc.ratype}/deployable-unit.xml" todir="${dir.stage.ratype-unit}/META-INF" />
		<copy todir="${dir.stage.ratype-unit}">
			<fileset dir="${dir.stage}">
				<include name="${jar.events}" />
				<include name="${jar.ratype}" />
			</fileset>
		</copy>
		<jar destfile="${dir.stage}/${jar.ratype-unit}">
			<fileset dir="${dir.stage.ratype-unit}" />
		</jar>
		<delete dir="${stage-ratype-unit}" />
	</target>

	<target name="package-unit-ra" depends="package-ra">
		<copy file="${dir.desc.ra}/deployable-unit.xml" todir="${dir.stage.ra-unit}/META-INF" />
		<copy todir="${dir.stage.ra-unit}">
			<fileset dir="${dir.stage}">
				<include name="${jar.ra}" />
			</fileset>
		</copy>
		<jar destfile="${dir.stage}/${jar.ra-unit}">
			<fileset dir="${dir.stage.ra-unit}" />
		</jar>
		<delete dir="${dir.stage.ra-unit}" />
	</target>

</project>


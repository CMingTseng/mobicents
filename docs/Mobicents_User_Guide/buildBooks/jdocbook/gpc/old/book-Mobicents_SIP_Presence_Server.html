<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <title/>
      <link rel="stylesheet" href="css/jbossorg.css" type="text/css"/>
      <meta name="generator" content="DocBook XSL Stylesheets V1.72.0"/>
   </head>
   <body>
      <div class="book" lang="en-US">
         <div class="titlepage">
            <div>
               <p id="title">
                  <a href="http://www.jboss.org" class="jbossOrg_href">
                     <strong>
						        JBoss.org	
						</strong>
                  </a>
                  <a href="http://labs.jboss.com/projects/docs" class="commDoc_href">
                     <strong>
						        Community Documentation	
						</strong>
                  </a>
               </p>
            </div>
            <hr/>
         </div>
         <div class="toc">
            <dl>
               <dt>
                  <span class="chapter">
                     <a href="#d0e3">1. Mobicents SIP Presence Server</a>
                  </span>
               </dt>
               <dd>
                  <dl>
                     <dt>
                        <span class="section">
                           <a href="#section-Mobicents_SIP_Presence_Server">1.1. Mobicents SIP Presence Server</a>
                        </span>
                     </dt>
                     <dd>
                        <dl>
                           <dt>
                              <span class="section">
                                 <a href="#section-Introduction_to_the_SIP_Presence_Server">1.1.1. Introduction to the SIP Presence Server</a>
                              </span>
                           </dt>
                           <dt>
                              <span class="section">
                                 <a href="#section-Configuring_Installing_and_Testing_the_SIP_Presence_Server">1.1.2. Configuring, Installing and Testing the SIP Presence Server</a>
                              </span>
                           </dt>
                           <dt>
                              <span class="section">
                                 <a href="#section-Functional_Architecture_of_the_SIP_Presence_Server">1.1.3. Functional Architecture of the SIP Presence Server</a>
                              </span>
                           </dt>
                           <dt>
                              <span class="section">
                                 <a href="#section-Resources_and_Further_Information_about_the_SIP_Presence_Server">1.1.4. Resources and Further Information about the SIP Presence Server</a>
                              </span>
                           </dt>
                        </dl>
                     </dd>
                  </dl>
               </dd>
            </dl>
         </div>
         <div class="chapter" lang="en-US">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title">
                        <a name="d0e3"/>Chapter 1. Mobicents SIP Presence Server</h2>
                  </div>
               </div>
            </div>
            <div class="toc">
               <dl>
                  <dt>
                     <span class="section">
                        <a href="#section-Mobicents_SIP_Presence_Server">1.1. Mobicents SIP Presence Server</a>
                     </span>
                  </dt>
                  <dd>
                     <dl>
                        <dt>
                           <span class="section">
                              <a href="#section-Introduction_to_the_SIP_Presence_Server">1.1.1. Introduction to the SIP Presence Server</a>
                           </span>
                        </dt>
                        <dt>
                           <span class="section">
                              <a href="#section-Configuring_Installing_and_Testing_the_SIP_Presence_Server">1.1.2. Configuring, Installing and Testing the SIP Presence Server</a>
                           </span>
                        </dt>
                        <dt>
                           <span class="section">
                              <a href="#section-Functional_Architecture_of_the_SIP_Presence_Server">1.1.3. Functional Architecture of the SIP Presence Server</a>
                           </span>
                        </dt>
                        <dt>
                           <span class="section">
                              <a href="#section-Resources_and_Further_Information_about_the_SIP_Presence_Server">1.1.4. Resources and Further Information about the SIP Presence Server</a>
                           </span>
                        </dt>
                     </dl>
                  </dd>
               </dl>
            </div>
            <div class="section" lang="en-US">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title">
                           <a name="section-Mobicents_SIP_Presence_Server"/>1.1. Mobicents SIP Presence Server</h2>
                     </div>
                  </div>
               </div>
               <div class="section" lang="en-US">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title">
                              <a name="section-Introduction_to_the_SIP_Presence_Server"/>1.1.1. Introduction to the SIP Presence Server</h3>
                        </div>
                     </div>
                  </div>
                  <p>The Mobicents SIP Presence Server is a free and open source implementation of a SIP Presence Server, as defined by the Internet Engineering Task Force (IETF), the Open Mobile Alliance (OMA), the 3rd Generation Partnership Project (3GPP) and the European Telecommunications Standards Institute (ETSI).</p>
                  <p>The SIP Presence Server is an entity that accepts, stores and distributes SIP Presence Information.</p>
               </div>
               <div class="section" lang="en-US">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title">
                              <a name="section-Configuring_Installing_and_Testing_the_SIP_Presence_Server"/>1.1.2. Configuring, Installing and Testing the SIP Presence Server</h3>
                        </div>
                     </div>
                  </div>
                  <h5 class="formalpara">Requirements</h5>
                  <p class="formalpara">The Mobicents SIP Presence Server depends on the Mobicents Converged Application Server and the Mobicents SIP resource adapter, which should be deloyed before starting the SIP Presence Server.</p>
                  <h5 class="formalpara">Configuration</h5>
                  <p class="formalpara">The Mobicents SIP Presence Server can be customized in the following aspects before being built.</p>
                  <div class="variablelist">
                     <a name="varlist-Customizing_the_Presence_Server"/>
                     <p class="title">
                        <b>Customizing the SIP Presence Server</b>
                     </p>
                     <dl>
                        <dt>
                           <span class="term">XCAP Aware User Agent</span>
                        </dt>
                        <dd>
                           <p>The SIP Presence Server calculates the presence-rules XCAP URIs of users in a non-standard way by default, but one which is compatible with CounterPath eyeBeam. You can change this behavior to conform with standards by changing the contents of the <code class="literal">clientUAIsEyebeam</code> field of <code class="literal">PresenceSubscriptionControlSbb</code>, which is in <code class="filename">ps-core/subscription-sbb/src/main/java/..</code>.<sup>[<a name="footnote-temp_solution" href="#ftn.footnote-temp_solution">1</a>]</sup>
					
                           </p>
                           <p>Note that you do not need to touch or configure anything in order to deploy the server.</p>
                        </dd>
                     </dl>
                  </div>
                  <h5 class="formalpara">Installing the Mobicents SIP Presence Server</h5>
                  <p class="formalpara">TBD (Fix this with proper instructions): Currently, the Mobicents SIP Presence Server can only be installed as integrated with the Mobicents XML Document Management Server, i.e. in an all-in-one SIP Presence Server architecture<sup>[<a name="footnote-integrated_presence_server" href="#ftn.footnote-integrated_presence_server">2</a>]</sup>.</p>
                  <div class="important">
                     <a name="important-Installing_the_Presence_Server_Also_Installs_the_XDM_Server"/>
                     <h2>Installing the SIP Presence Server Also Installs the XDM Server</h2>
                     <p>You should also make sure that all the install requirements of the Mobicents XDM Server are met before attempting to install the Mobicents SIP Presence Server. See <a href="#">???</a>.</p>
                  </div>
                  <h5 class="formalpara">Installing the Mobicents XML Document Management Server</h5>
                  <p class="formalpara">How you install the XDM Server depends on whether you are using the Mobicents binary distribution, or running the source distribution.</p>
                  <div class="itemizedlist">
                     <ul>
                        <li>
                           <h5 class="formalpara">Installing the XDM Server using the Mobicents Binary Distribution</h5>
                           <p class="formalpara">TBD: (Fix this with proper instructions): Using the binary release, you can install the XDM Server by doing an ant deploy on the <code class="filename">servers/sip-presence/integrated</code> directory.</p>
                        </li>
                        <li>
                           <h5 class="formalpara">Installing the XDM Server after Building Mobicents from Source</h5>
                           <p class="formalpara">TBD: (Fix this with proper instructions): From the source code repository, you can install the XDM Server by doing a mvn install on the <code class="filename">/trunk/servers/sip-presence/integrated</code> directory.</p>
                        </li>
                     </ul>
                  </div>
                  <h5 class="formalpara">Uninstalling the Mobicents XML Document Management Server</h5>
                  <p class="formalpara">How you uninstall the XDM Server depends on whether you are using the Mobicents binary distribution, or running the source distribution.</p>
                  <div class="itemizedlist">
                     <ul>
                        <li>
                           <h5 class="formalpara">Uninstalling the XDM Server using the Mobicents Binary Distribution</h5>
                           <p class="formalpara">TBD: (Fix this with proper instructions): Using the binary release, you can uninstall the XDM Server by doing an ant undeploy on the <code class="filename">servers/sip-presence/integrated</code> directory.</p>
                        </li>
                        <li>
                           <h5 class="formalpara">Uninstalling the XDM Server after Building Mobicents from Source</h5>
                           <p class="formalpara">TBD: (Fix this with proper instructions): From the source code repository, you can uninstall the XDM Server by doing a mvn clean on the <code class="filename">/trunk/servers/sip-presence/integrated</code> directory.</p>
                        </li>
                     </ul>
                  </div>
                  <h5 class="formalpara">Testing the Mobicents SIP Presence Server</h5>
                  <p class="formalpara">A test framework for the Mobicents SIP Presence Server is forthcoming but not available yet.</p>
               </div>
               <div class="section" lang="en-US">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title">
                              <a name="section-Functional_Architecture_of_the_SIP_Presence_Server"/>1.1.3. Functional Architecture of the SIP Presence Server</h3>
                        </div>
                     </div>
                  </div>
                  <h5 class="formalpara">Functional Architecture of the Mobicents SIP Presence Server</h5>
                  <div class="figure">
                     <a name="figure-sas-orig-dia-PS_Functional_Architecture.jpg"/>
                     <div class="figure-contents">
                        <div class="mediaobject" align="center">
                           <a name="mediaobj-sas-orig-dia-PS_Functional_Architecture.jpg"/>
                           <img src="images/sas-orig-dia-PS_Functional_Architecture.jpg" align="middle" alt="The Mobicents SIP Presence Server"/>
                           <div class="caption">
                              <p>Functional Diagram of the Mobicents SIP Presence Server</p>
                           </div>
                        </div>
                     </div>
                     <p class="title">
                        <b>Figure 1.1. The Mobicents SIP Presence Server</b>
                     </p>
                  </div>
                  <br class="figure-break"/>
                  <p>The SIP Presence Server comprises the following functional elements:</p>
                  <div class="variablelist">
                     <a name="varlist-The_Functional_Elements_Which_Compose_the_Presence_Server"/>
                     <p class="title">
                        <b>The Functional Elements Which Compose the SIP Presence Server</b>
                     </p>
                     <dl>
                        <dt>
                           <span class="term">Presence Publication Control</span>
                        </dt>
                        <dd>
                           <p>This functional element manages the publication of presence events, which includes not only the handling of new publications, but also the refreshing, modification or removal of, already-published information.</p>
                           <p>Because the presence resource, which is also called a “<span class="quote">presentity</span>”, can have multiple publications simultaneously, such as some state published by a user agent or device, and some location data published by a Presence Network Agent (on behalf of the presentity), this element is also responsible for composing all of the different publications for the same resource.</p>
                           <p>In some presence networks, it may be of interest to allow resources to have a static presence state, which is stored in the XDM Server. In cases like these, Presence Publication Control may need to interface with the XDM Server to retrieve and subscribe to (learn about changes to) that information, and use it when composing the final presence information document.</p>
                        </dd>
                        <dt>
                           <span class="term">Presence Subscription Control</span>
                        </dt>
                        <dd>
                           <p>This functional element handles subscriptions to presence events or to the list of subscribers (watchers), for any specific resource. It is, of course, responsible for emitting notifications related to those subscriptions.</p>
                           <p>Presence authorization rules, which define if a subscription is allowed or rejected and, if allowed, define which transformations to the original presence events are needed, are stored on the XDM Server by the user. Thus, Presence Subscription Control needs to retrieve and subscribe to (learn about changes to) that information.</p>
                        </dd>
                        <dt>
                           <span class="term">XDM Client Control</span>
                        </dt>
                        <dd>
                           <p>This last element is responsible for interfacing with the XDM Server that manages the user's XML documents, and is related to the main functions of the presence server. It's capable not only of retrieving a document (or part of one), but also of subscribing to either updates of a single, specific document, or to a full collection of documents of a specific type or application.</p>
                        </dd>
                     </dl>
                  </div>
                  <h5 class="formalpara">Implementation Architecture of the Mobicents SIP Presence Server</h5>
                  <div class="figure">
                     <a name="figure-sas-orig-dia-PS_Implementation.jpg"/>
                     <div class="figure-contents">
                        <div class="mediaobject" align="center">
                           <a name="mediaobj-sas-orig-dia-PS_Implementation.jpg"/>
                           <table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="700">
                              <tr>
                                 <td align="center">
                                    <img src="images/sas-orig-dia-PS_Implementation.jpg" align="middle" width="700" alt="Implementation Architecture of the Mobicents SIP Presence Server"/>
                                 </td>
                              </tr>
                           </table>
                           <div class="caption">
                              <p>The Mobicents SIP Presence Server</p>
                           </div>
                        </div>
                     </div>
                     <p class="title">
                        <b>Figure 1.2. Implementation Architecture of the Mobicents SIP Presence Server</b>
                     </p>
                  </div>
                  <br class="figure-break"/>
                  <p>The implementation of the Mobicents SIP Presence Server comprises the following functional elements:</p>
                  <div class="variablelist">
                     <a name="varlist-The_Two_Services_Which_Compose_the_Presence_Server"/>
                     <p class="title">
                        <b>The Two Services Which Compose the SIP Presence Server</b>
                     </p>
                     <dl>
                        <dt>
                           <span class="term">Presence Publication Control Service</span>
                        </dt>
                        <dd>
                           <p>This JAIN SLEE service includes the root Service Building Block (SBB), <code class="literal">PresencePublicationControlSbb</code>, which is the implementation of the abstract SIP event <code class="literal">PublicationControlSbb</code>. It handles publications on the "presence" event package.</p>
                           <p>The <code class="literal">PresencePublicationControlSbb</code> provides the following capabilities:</p>
                           <div class="itemizedlist">
                              <ul>
                                 <li>
                                    <p>It provides the logic to authorize a publication; however, it only authorizes <code class="literal">PUBLISH</code> requests when the request URI matches the PIDF document “<span class="quote">entity</span>” attribute.</p>
                                 </li>
                                 <li>
                                    <p>It provides JAXB unmarshellers to validate and parse the PIDF document for the abstract <code class="literal">PublicationControlSbb</code>.</p>
                                 </li>
                                 <li>
                                    <p>It demands that notifying subscribers occur through a child relation to the root SBB of the Presence Subscription Control Service.</p>
                                 </li>
                                 <li>
                                    <p>Finally, it also provides an <code class="literal">SbbLocalObject</code> interface that can be used, in JAIN SLEE child relations, to obtain the composed presence information for a specific resource.</p>
                                 </li>
                              </ul>
                           </div>
                        </dd>
                        <dt>
                           <span class="term">Presence Subscription Control Service.</span>
                        </dt>
                        <dd>
                           <p>This JAIN SLEE service includes the root SBB <code class="literal">PresenceSubscriptionControlSbb</code>, which is the implementation of the abstract SIP Event <code class="literal">SubscriptionControlSbb</code>. It handles subscriptions on the "presence" event package.</p>
                           <p>The standout SBB logic item is the usage of presence-rules documents, obtained through the XDM Client SBB child relation, in order to authorize subscriptions and transform the content notified (TBD: feature not used yet). It also defines a child relation to the root SBB of <code class="literal">PresencePublicationService</code> to retrieve the composed PIDF document for the subscription's notifier.</p>
                           <p>The SBB also provides an <code class="literal">SbbLocalObject</code> interface that can be used, in JAIN SLEE child relations, to make the presence event known to the subscribers of a specific resource.</p>
                        </dd>
                     </dl>
                  </div>
                  <p>The implementation architecture of the SIP Presence Server also contains client-side components:</p>
                  <div class="variablelist">
                     <dl>
                        <dt>
                           <span class="term">Presence Client SBB (TBD: not yet available)</span>
                        </dt>
                        <dd>
                           <p>The <code class="literal">PresenceClientSBB</code> is the interface to a JAIN SLEE SBB intended to be used as a client for the Mobicents SIP Presence Server (and other servers compliant with same standards), in JAIN SLEE child relations.</p>
                           <p>Two implementations of this interface are provided: the <code class="literal">InternalPresenceClientSBB</code> that is used with applications running in the Mobicents SIP Presence Server JAIN SLEE container, and the <code class="literal">ExternalPresenceClientSBB</code>, used with applications running in a different JAIN SLEE container than the Mobicents SIP Presence Server.</p>
                        </dd>
                     </dl>
                  </div>
                  <p>TBD: This documentation is originally from http://groups.google.com/group/mobicents-public/web/mobicents-sip-presence-server by Eduardo Martins, JBoss R&amp;D.</p>
               </div>
               <div class="section" lang="en-US">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title">
                              <a name="section-Resources_and_Further_Information_about_the_SIP_Presence_Server"/>1.1.4. Resources and Further Information about the SIP Presence Server</h3>
                        </div>
                     </div>
                  </div>
                  <p>For further information on the Mobicents SIP Presence Server, see the following list of additional resources:</p>
                  <div class="itemizedlist">
                     <a name="itemlist-Further_Information_on_the_Mobicents_SIP_Presence_Server"/>
                     <ul>
                        <li>
                           <p>How to Manage the Mobicents SIP Presence Server</p>
                        </li>
                        <li>
                           <p>Integrating the Mobicents SIP Presence Server into Your JAIN SLEE Applications: Code Snippets for Internal Presence Client SBB Usage.</p>
                        </li>
                        <li>
                           <p>Integrating the Mobicents SIP Presence Server into Your JAIN SLEE Applications: Code Snippets for External Presence Client SBB Usage.</p>
                        </li>
                        <li>
                           <p>
					
                              <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://groups.google.com/group/mobicents-public/web/mobicents-sip-event-components">Mobicents Sip Event Publication and Subscription Control Components</a>
				
                           </p>
                        </li>
                     </ul>
                  </div>
               </div>
            </div>
            <div class="footnotes">
               <br/>
               <hr width="100" align="left"/>
               <div class="footnote">
                  <p>
                     <sup>[<a name="ftn.footnote-temp_solution" href="#footnote-temp_solution">1</a>] </sup>This is a temporary solution due to a feature in the current JAIN SIP stack that removes invalid User Agent hedaers of SIP requests. In the future, this configuration is exected to be deprecated or removed.</p>
               </div>
               <div class="footnote">
                  <p>
                     <sup>[<a name="ftn.footnote-integrated_presence_server" href="#footnote-integrated_presence_server">2</a>] </sup>This limitation is due to the current lack of an external XDM Client SBB component.</p>
               </div>
            </div>
         </div>
      </div>
   </body>
</html>